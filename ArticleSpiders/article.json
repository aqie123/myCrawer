{"url_object_id": "1118eeda71990c18b1a0e9492a82d95e", "title": "Linux 26 周年，来一场怀旧之旅", "url": "http://blog.jobbole.com/112494/", "create_date": "2017/09/15", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/04/e260ae4f5d153b25be87819b25ff0577.jpg"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": "1", "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/8/linux-anniversary\">Jim Hall</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8836-1.html\">Linux中国/softpaopao</a>   </div><blockquote><p>通过安装 SLS 1.05 展示了 Linux 内核在这 26 年间走过了多远。</p></blockquote>\n<p>我第一次安装 Linux 是在 1993 年。那时我跑的是 MS-DOS，但我真的很喜欢学校机房电脑的 Unix 系统，就在那里度过了我大学本科时光。 当我听说了 Linux，一个 Unix 的免费版本，可以在我家的 386 电脑上运行的时候，我立刻就想要试试。我的第一个 Linux 发行版是 <a href=\"https://en.wikipedia.org/wiki/Softlanding_Linux_System\">Softlanding Linux System</a> (SLS) 1.03，带有 11 级补丁的 0.99 alpha 版本的 Linux 内核。它要求高达 2 MB 的内存，如果你想要编译项目需要 4 MB，运行 X windows 则需要 8 MB。</p>\n<p>我认为 Linux 相较于 MS-DOS 世界是一个巨大的进步。 尽管 Linux 缺乏运行在 MS-DOS 上的广泛的应用及游戏，但我发现 Linux 带给我的是巨大的灵活性。不像 MS-DOS ，现在我可以进行真正的多任务，同时运行不止一个程序。并且 Linux 提供了丰富的工具，包括一个 C 语言编译器，让我可以构建自己的项目。</p>\n<p>一年后，我升级到了 SLS 1.05，它支持全新的 Linux 内核 1.0。 更重要的，Linux 引入了内核模块。通过内核模块，你不再需要为支持新硬件而编译整个内核；取而代之，只需要从包含 Linux 内核之内的 63 个模块里加载一个就行。在 SLS 1.05 的发行自述文件中包含这些关于模块的注释：</p>\n<blockquote><p>内核的模块化旨在正视减少并最终消除重新编译内核的要求，无论是变更、修改设备驱动或者为了动态访问不常用的驱动。也许更为重要的是，个别工作小组的工作不再影响到内核的正确开发。事实上，这让以二进制发布官方内核现在成为了可能。</p></blockquote>\n<p>在 8 月 25 日，Linux 内核将迎来它的第 26 周年（LCTT 译注：已经过去了 =.= ）。为了庆祝，我重新安装了 SLS 1.05 来提醒自己 Linux 1.0 内核是什么样子，去认识 Linux 自二十世纪 90 年代以来走了多远。和我一起踏上 Linux 的怀旧之旅吧！</p>\n<h3 id=\"toc_1\">安装</h3>\n<p>SLS 是第一个真正的 “发行版”，因为它包含一个安装程序。 尽管安装过程并不像现代发行版一样顺畅。 不能从 CD-ROM 启动安装，我需要从安装软盘启动我的系统，然后从 <strong>login</strong> 提示中运行安装程序。</p>\n<p><img title=\"Installing SLS 1.05 from the login prompt\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5c45499b688747f0526bf130c0154587.png\" alt=\"Installing SLS 1.05 from the login prompt\"></p>\n<p>在 SLS 1.05 中引入的一个漂亮的功能是支持彩色的文本模式安装器。当我选择彩色模式时，安装器切换到一个带有黑色文字的亮蓝色背景，不再是我们祖祖辈辈们使用的原始的普通黑白文本。</p>\n<p><img title=\"Color-enabled text-mode installer in SLS 1.05\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a6012be8a0eee0df8f3e26191734cd8a.png\" alt=\"Color-enabled text-mode installer in SLS 1.05\"></p>\n<p>SLS 安装器是个简单的东西，文本从屏幕底部滚动而上，显示其做的工作。通过对一些简单的提示的响应，我能够创建一个 Linux 分区，挂载上 ext2 文件系统，并安装 Linux 。 安装包含了 X windows 和开发工具的 SLS 1.05，需要大约 85 MB 的磁盘空间。依照今天的标准这听起来可能不是很多，但在 Linux 1.0 出来的时候，120 MB 的硬件设备才是主流设备。</p>\n<p><img title=\"Creating a partition for Linux, putting an ext2 filesystem on it, and installing Linux\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ec187c4e241e9271150072dbe7d4cdfe.png\" alt=\"Creating a partition for Linux, putting an ext2 filesystem on it, and installing Linux\"></p>\n<p><img title=\"First boot\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/387f178eb53fc2ac018d8054a21e7071.png\" alt=\"First boot\"></p>\n<h3 id=\"toc_2\">系统级别</h3>\n<p>当我第一次启动到 Linux 时，让我想起来了一些关于这个早期版本 Linux 系统的事情。首先，Linux 没有占据很多的空间。在启动系统之后运行一些程序来检查的时候，Linux 占用了不到 4 MB 的内存。在一个拥有 16MB 内存的系统中，这就意味着节省了很多内存用来运行程序。</p>\n<p><img title=\"Checking out the filesystem and available disk space\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f4a217e99547a2749af4bb5c658d56df.png\" alt=\"Checking out the filesystem and available disk space\"></p>\n<p>熟悉的 <code>/proc</code> 元文件系统在 Linux 1.0 就存在了，尽管对比我们今天在现代系统上看到的，它并不能提供许多信息。在 Linux 1.0， <code>/proc</code> 包含一些接口来探测类似 <code>meminfo</code> 和 <code>stat</code> 之类的基本系统状态。</p>\n<p><img title=\"The familiar /proc meta filesystem\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8419659167d2ca26f0182224283a317d.png\" alt=\"The familiar /proc meta filesystem\"></p>\n<p>在这个系统上的 <code>/etc</code> 文件目录非常简单。值得一提的是，SLS 1.05 借用了来自 <a href=\"https://en.wikipedia.org/wiki/Berkeley_Software_Distribution\">BSD Unix</a> 的 <strong>rc</strong> 脚本来控制系统启动。 初始化是通过 <strong>rc</strong> 脚本进行的，由 <code>rc.local</code> 文件来定义本地系统的调整。后来，许多 Linux 发行版采用了来自 <a href=\"https://en.wikipedia.org/wiki/UNIX_System_V\">Unix System V</a> 的很相似的 <strong>init</strong> 脚本，后来又是 <a href=\"https://en.wikipedia.org/wiki/Systemd\">systemd</a> 初始化系统。</p>\n<p><img title=\"The /etc directory\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/237938a3c980e846b2d65d67899e6ddb.png\" alt=\"The /etc directory\"></p>\n<h3 id=\"toc_3\">你能做些什么</h3>\n<p>随着我的系统的启动运行，接下来就可以使用了了。那么，在这样的早期 Linux 系统上你能做些什么？</p>\n<p>让我们从基本的文件管理开始。 每次在你登录的时候，SLS 会让你使用 Softlanding 菜单界面（MESH），这是一个文件管理程序，现代的用户们可能觉得它和 <a href=\"https://midnight-commander.org/\">Midnight Commander</a> 很相似。 而二十世纪 90 年代的用户们可能会拿 MESH 与更为接近的 <a href=\"https://en.wikipedia.org/wiki/Norton_Commander\">Norton Commander</a> 相比，这个可以说是在 MS-DOS 上最流行的第三方文件管理程序。</p>\n<p><img title=\"The Softlanding menu shell (MESH)\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b7f623257b1323375b9a13f652b57a2d.png\" alt=\"The Softlanding menu shell (MESH)\"></p>\n<p>除了 MESH 之外，在 SLS 1.05 中还少量包含了一些全屏应用程序。你可以找到熟悉的用户工具，包括 Elm 邮件阅读器、GNU Emacs 可编程编辑器，以及古老的 Vim 编辑器。</p>\n<p><img title=\"Elm mail reader\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/91dd27186da1961d4ca3e93928ff0956.png\" alt=\"Elm mail reader\"></p>\n<p><img title=\"GNU Emacs programmable editor\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f752eaf2abf8ea574b328c61f914cc33.png\" alt=\"GNU Emacs programmable editor\"></p>\n<p>SLS 1.05 甚至包含了一个可以让你在终端玩的俄罗斯方块版本。</p>\n<p><img title=\"Tetris for terminals\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/7f441201064939f5d49061a65a0fcdf0.png\" alt=\"Tetris for terminals\"></p>\n<p>在二十世纪 90 年代，多数住宅的网络接入是通过拨号连接的，所以 SLS 1.05 包含了 Minicom 调制解调器拨号程序。Minicom 提供一个与调制解调器的直接连接，并需要用户通过贺氏调制解调器的 <strong>AT</strong> 命令来完成一些像是拨号或挂电话这样的基础功能。Minicom 同样支持宏和其他简单功能来使连接你的本地调制解调器池更容易。</p>\n<p><img title=\"Minicom modem-dialer application\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/13b052925335f4bf15a61e2a2f73352b.png\" alt=\"Minicom modem-dialer application\"></p>\n<p>但如果你想要写一篇文档时怎么办？ SLS 1.05 的存在要比 LibreOffice 或者 OpenOffice 早很长时间。在二十世纪 90 年代，Linux 还没有这些应用。相反，如果你想要使用一个文字处理器，可能需要引导你的系统进入 MS-DOS，然后运行你喜欢的文字处理器程序，如 WordPerfect 或者共享软件 GalaxyWrite。</p>\n<p>但是所有的 Unix 系统都包含一套简单的文本格式化程序，叫做 nroff 和 troff。在 Linux 系统中，他们被合并成 GNU groff 包，而 SLS 1.05 包含了 groff 的一个版本。我在 SLS 1.05 上的一项测试就是用 nroff 生成一个简单的文本文档。</p>\n<p><img title=\"A simple nroff text document\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ec200b92a91cd1e94945295a30d3eb8c.png\" alt=\"A simple nroff text document\"></p>\n<p><img title=\"nroff text document output\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f217fcd68ed4087077ecc9c0214f0fe4.png\" alt=\"nroff text document output\"></p>\n<h3 id=\"toc_4\">运行 X windows</h3>\n<p>获取安装 X windows 并不特别容易，如 SLS 安装文件承诺的那样：</p>\n<blockquote><p>在你的 PC 上获取安装 X windows 可能会有一些发人深省的体验，主要是因为 PC 的显示卡类型太多。Linux X11 仅支持 VGA 类型的显示卡，但在许多类型的 VGA 中仅有个别的某些类型是完全支持的。SLS 存在两种 X windows 服务器。全彩的 XFree86，支持一些或所有 ET3000、ET400、PVGA1、GVGA、Trident、S3、8514、Accelerated cards、ATI plus 等。</p>\n<p>另一个服务器 XF86_Mono，能够工作在几乎所有的 VGA 卡上，但只提供单色模式。因此，相比于彩色服务器，它会占用更少的内存并拥有更快的速度。当然就是看起来不怎么漂亮。</p>\n<p>X windows 的配置信息都堆放在目录 “/usr/X386/lib/X11/”。需要注意的是，“Xconfig” 文件为监视器和显示卡定义了时序。默认情况下，X windows 设置使用彩色服务器，如果彩色服务器出现问题，你可以切换到单色服务器 x386mono，因为它已经支持各种标准的 VGA。本质上，这只是将 /usr/X386/bin/X 链接到它。</p>\n<p>只需要编辑 Xconfig 来设置鼠标驱动类型和时序，然后键入 “startx” 即可。</p></blockquote>\n<p>这些听起来令人困惑，但它就是这样。手工配置 X windows 真的可以是一个发人深省的体验。幸好，SLS 1.05 包含了 syssetup 程序来帮你确定系统组件的种类，包括了 X windows 的显示设置。在一些提示过后，经过一些实验和调整，最终我成功启动了 X windows！</p>\n<p><img title=\"The syssetup program\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bcaea8d4616c94e53487a762f0b7eaf0.png\" alt=\"The syssetup program\"></p>\n<p>但这是来自于 1994 年的 X windows，它仍然并没有桌面的概念。我可以从 FVWM （一个虚拟窗口管理器）或 TWM （选项卡式的窗口管理器）中选择。TWM 直观地设置提供一个功能简单的图形环境。</p>\n<p><img title=\"TWM\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/97c8eadaf2ce93c38995b0a92e839fc5.png\" alt=\"TWM\"></p>\n<h3 id=\"toc_5\">关机</h3>\n<p>我已经在我的 Linux 寻根之旅沉浸许久，是时候最终回到我的现代桌面上了。最初我跑 Linux 的是一台仅有 8MB 内存和 一个 120MB 硬盘驱动器的 32 位 386 电脑，而我现在的系统已经足够强大了。拥有双核 64 位 Intel Core i5 处理器，4 GB 内存和一个 128 GB 的固态硬盘，我可以在我的运行着 Linux 内核 4.11.11 的系统上做更多事情。那么，在我的 SLS 1.05 的实验结束之后，是时候离开了。</p>\n<p><img title=\"Shutting down\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6254ead7170bd2dbacf864457006fdc.png\" alt=\"Shutting down\"></p>\n<p>再见，Linux 1.0。很高兴看到你的茁壮成长。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112494\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112494votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112494\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/6085acc0af4696f5d49164561c6bc4f9b590fc26.jpg"}
{"url_object_id": "e46f82608b69c33c31063358c6a14cf5", "title": "数据异构的武器-BINLOG+MQ", "url": "http://blog.jobbole.com/112466/", "create_date": "2017/09/12", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": 0, "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/wangxindong/blog/1531596\">新栋BOOK</a>   </div><h3>1、定义</h3>\n<p>何谓数据异构，上周交易部门商品的同事过来做分享，又看到这个词，他的PPT里面是 数据库异构。其实我们以前做的事情，也是可以成为数据异构。比如我们将DB里面的数据持久化到REDIS里面去，就是一种数据异构的方式。如果要下个定义的话：<strong>把数据按需（数据结构、存取方式、存取形式）异地构建存储。</strong></p>\n<h3>2、常见应用场景</h3>\n<p>分库分表中有一个最为常见的场景，为了提升数据库的查询能力，我们都会对数据库做分库分表操作。比如订单库，开始的时候我们是按照订单ID维度去分库分表，那么后来的业务需求想按照商家维度去查询，比如我想查询某一个商家下的所有订单，就非常麻烦。这个时候通过数据异构就能很好的解决此问题，比如下图</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fa46be3f45850ad48951742bb9ec51df.png\" alt=\"异构维度.png\"></p>\n<p style=\"text-align: center\">异构维度</p>\n<p style=\"text-align: left\"><strong>总结起来大概有以下几种场景</strong></p>\n<ol>\n<li>数据库镜像</li>\n<li>数据库实时备份</li>\n<li>多级索引</li>\n<li>search build（比如分库分表后的多维度数据查询）</li>\n<li>业务cache刷新</li>\n<li>价格、库存变化等重要业务消息</li>\n</ol>\n<h3>3、数据异构方向</h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/939f4abdb92c7c0ce9a8ba0918d85180.png\" alt=\"异构的几种方向.png\"></p>\n<p style=\"text-align: center\">几种异构方式</p>\n<p>在日常业务开发中大致可以分为以上几种数据去向，DB-DB这种方式，一般常见于分库分表后，聚合查询的时候，比如我们按照订单ID去分库分表，那么这个时候我们要按照用户ID去查询，查询这个用户下面的订单就非常不方便了，当然可以使用统一加到内存中去，但这样不太好。所以我们就可以用数据库异构的方式，重新按照用户ID的维度来分一个表，像在上面常见应用场景中介绍的那样。把数据异构到redis、elasticserach、slor中去要解决的问题跟按照多维度来查询的需求差不多。这些存储天生都有聚合的功能。当然同时也可以提高查询性能，应对大访问量，比如redis这种抗量银弹。</p>\n<h3>4、数据异构的常用方法</h3>\n<h4>3.1、完整克隆</h4>\n<p>这个很简单就是将数据库A，全部拷贝一份到数据库B，这样的使用场景是离线统计跑任务脚本的时候可以。缺点也很突出，不适用于持续增长的数据。</p>\n<h4>3.2、标记同步</h4>\n<p>这个是业务场景比较简单的时候，理想情况下数据不会发生改变，比如日志数据，这个时候可以去标记，比如时间戳，这样当发生故障的时候还可以回溯到上一次同步点，开始重新同步数据。</p>\n<h4>3.3、BINLOG方式</h4>\n<p>通过实时的订阅mysql的binlog日志，消费到这些日志后，重新构建数据结构插入一个新的数据库或者是其他存储比如es、slor等等。订阅binlog日志可以比较好的能保证数据的一致性。</p>\n<h4>3.4、MQ方式</h4>\n<p>业务数据写入DB的同时，也发送MQ一份，也就是业务里面实现双写。这种方式比较简单，但也很难保证数据一致性，对简单的业务场景可以采用这种方式。</p>\n<h3>5、binlog和mq方式重点介绍</h3>\n<h4>5.1、binlog</h4>\n<h5>5.1.1、订阅binglog日志异构流程图</h5>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a8369973e6880af9e85c3c0477430595.png\" alt=\"canal异构方式.png\"></p>\n<p style=\"text-align: center\">canal异构方式</p>\n<h5>5.1.2、使用说明</h5>\n<p>binglog是数据的日志记录方式，每次对数据的操作都会有binlog日志。现在开源的订阅binlog日志的组件，比如使用比较广泛的canal，它是阿里开源的基于mysql数据库binlog的增量订阅和消费组件。由于cannal服务器目前读取的binlog事件只保存在内存中，并且只有一个canal客户端可以进行消费。所以如果需要多个消费客户端，可以引入activemq或者kafka。如上图绿色虚线框部分。我们还需要确保全量对比来保证数据的一致性（canal+mq的重试机制基本可以保证写入异构库之后的数据一致性），这个时候可以有一个全量同步WORKER程序来保证，如上图深绿色部分。</p>\n<h5>5.1.3、canal的工作原理</h5>\n<p>先来看下mysql主备（主从）复制原理如下图，在此原理基础之上我们再来理解canal的实现原理就一眼能明白了。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/daadf7db68a30d1e844ebee84d7f854c.jpg\" alt=\"mysql主备复制实现原理.jpg\"></p>\n<p style=\"text-align: center\">mysql主备复制实现原理</p>\n<p style=\"text-align: left\"><strong>mysql主备（主从）复制原理，从上层来看，复制分成三步：</strong></p>\n<ol>\n<li>master将改变记录到二进制日志(binary log)中（这些记录叫做二进制日志事件，binary log events，可以通过show binlog events进行查看）；</li>\n<li>slave将master的binary log events拷贝到它的中继日志(relay log)；</li>\n<li>slave重做中继日志中的事件，将改变反映它自己的数据。<br>\n再来看下canal的原理，如下图：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a82380169db0d36662aaefb8c910003a.jpg\" alt=\"canal工作原理.jpg\"><br>\n<strong>cannal实现原理相对比较简单（参照上面的mysql主备复制实现原理）：</strong></li>\n<li>canal模拟mysql slave的交互协议，伪装自己为mysql slave，向mysql master发送dump协议</li>\n<li>mysql master收到dump请求，开始推送binary log给slave(也就是canal)</li>\n<li>canal解析binary log对象(原始为byte流)<br>\n我们在部署canal server的时候要部署多台，来保证高可用。但是canal的原理，是只有一台服务器在跑处理，其它的服务器作为热备。canal server的高可用是通过zookeeper来维护的。<br>\n<strong>有关canal更具体的使用和详细原理请参照：<a href=\"https://github.com/alibaba/canal\" target=\"_blank\" rel=\"nofollow\">https://github.com/alibaba/canal</a></strong></li>\n</ol>\n<h5>5.1.4、注意点</h5>\n<ul>\n<li>1、确认MySQL开启binlog，使用<strong>show variables like ‘log_bin’;</strong> 查看ON为已开启</li>\n<li>2、确认目标库可以产生binlog，<strong>show master status</strong> 注意Binlog_Do_DB，Binlog_Ignore_DB参数</li>\n<li>3、确认binlog格式为ROW，使用<strong>show variables like ‘binlog_format’;</strong> 非ROW模式登录MySQL执行 <strong>set global binlog_format=ROW; flush logs;</strong> 或者通过更改MySQL配置文件并重启MySQL生效。</li>\n<li>4、为保证binlake服务可以获取Binlog，需添加授权，执行 <strong>GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON <em>.</em> TO ‘admin’@’%’ identified by ‘admin’; FLUSH PRIVILEGES;</strong></li>\n</ul>\n<h4>5.2、mq方式</h4>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fd773d9eb65abb904785d4dbd31196d3.png\" alt=\"MQ异构方式.png\"></p>\n<p style=\"text-align: center\">MQ异构方式</p>\n<p>mq的方式，就相对简单，实际上是在业务逻辑中写DB的同时去写一次MQ，但是这种方式不能够保证数据一致性，就是不能保证跨资源的事务。<strong>注：调用第三方远程RPC的操作一定不要放到事务中。</strong></p>\n<h3>6、总结</h3>\n<p>本文主要叙述了数据异构的使用场景，方法。这里面涉及到的activemq以及canal并没有深入分析，关于这块的内容可以直接参考相关具体文档，文中已给了链接地址。根据数据异构的定义，将数据异地构建存储，我们可以应用的地方就非常多，文中说的分库分表之后按照其它维度来查询的时候，我们想脱离DB直接用缓存比如redis来抗量的时候。数据异构这种方式都能够很好的帮助我们来解决诸如此类的问题。<br>\n<strong>转载请注明出处，并附上链接 https://my.oschina.net/wangxindong/blog/1531596</strong><br>\n参考资料：<a href=\"https://github.com/alibaba/canal\" target=\"_blank\" rel=\"nofollow\">https://github.com/alibaba/canal</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112466\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112466votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112466\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}
{"url_object_id": "44b1416999d77262f2e24ed9de2c5763", "title": "为什么 Python 增长如此之快？", "url": "http://blog.jobbole.com/112499/", "create_date": "2017/09/16", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "praise_nums": "4", "comment_nums": "1", "fav_nums": "3", "tags": "开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://stackoverflow.blog/2017/09/14/python-growing-quickly/?cb=1\">stackoverflow</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：根据 Stack Overflow 最近公布的报告，基于 SO 上不同问题帖的访问量统计，Python 可以说是增长最快的主流编程语言。Python 也是高收入国家访客最爱浏览的标签。一起看看 SO 数据科学家 David Robinson 的分析。</p>\n<p>为什么 Python 增长的这么快？它有很多的用途，从 Web 开发到数据科学，再到 DevOps，而且你要知道，现在有越来越多的应用是使用 Python 开发的。我是一个用 R 语言的数据科学家，所以我自然很想知道，在我这个领域，Python 已经增长到了什么程度。还有哪些公司和组织最喜欢用 Python。</p>\n<p>我们分析得出了以下两个结论。首先，快速增长的 Python 主要是因为数据科学、机器学习以及学术研究。这一点可以从 pandas 软件包的增长上看出，pandas 已经成为增长最快的与 Python 相关的标签了。至于哪些行业在使用Python，我们发现如下行业对其最为关注，比如电子、制造业、软件、政务，尤其是高校。但是，Python 在各个行业的增长几乎是差不多的。这也恰好说明了，数据科学和机器学习对于各行各业来说，变得越来越常见，而且 Python 在这两个领域已经成为了最为普遍的选择。</p>\n<p>与之前一样，本文的分析也只针对世界银行所公布的高收入国家进行。</p>\n<h1>Python能够做哪些工作？</h1>\n<p>Python 是一个用途广泛的语言，比如说web开发和数据科学。我们是如何理清Python在这些领域的增长的呢？</p>\n<p>每个领域都有一些比较著名的库，我们可以研究一下这些库所对应标签的访问量。我们可以比较 web 开发框架 Django 和 Flask 以及数据科学领域的 NumPy，matplotlib 和 pandas （你可以使用 Stack Overflow Trends 来比较某个问题被问到的比率，而不是仅仅是访问量）</p>\n<p><img class=\"alignnone size-large wp-image-7814\" src=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-1024x1024.png\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-1024x1024.png 1024w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-150x150.png 150w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-300x300.png 300w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-768x768.png 768w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-200x200.png 200w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-400x400.png 400w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-600x600.png 600w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-800x800.png 800w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-1000x1000.png 1000w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/related_tags_over_time-1-1200x1200.png 1200w \" alt=\"\" width=\"1024\" height=\"1024\"></p>\n<p>对于来自高收入国家的访问量，padnas 是增长最快的Python软件包：它于2011年问世，而现在，Stack Overflow 中有 1％ 的问题都是关于它的。关于 numpy 和 matplotlib 的问题也在不断增长。与之相对的是，与 Django 相关问题的增长比较平缓，Flask 虽然有所增长，但仍旧比较小众。这表明，大多数 Python 问题的的增长主要还得归功于数据科学，而不是 Web 开发。</p>\n<p>但是，这只是一方面，因为它只能测量常用的 Python 库。Python 在系统管理员和 DevOps 工程师中也非常的流行，他们会同时访问Linux，Bash 和 Docker 等领域的问题。同样，很多 Python web 应用并不是基于 Django 或者 Flask 的，这些开发者很可能去访问 JavaScript、HTML 和 CSS ，而我们不能简单的计算 Linux、bash、javascript 这些标签的增长并且假定它们和Python相关。因此，我们想要计算一下，与 Python 标签一起访问的标签有哪些。</p>\n<p>我们仅考虑今夏（2017年 6-8 月期间）的访问量，这样做可以减小学生们带来的流量影响，专注于最近的流量数据，同时还可以减少计算量。此外，我们仅考虑注册用户，且该用户在这段时间内应该至少访问过50个问题。我们基于两点判断一个用户是Python使用者：第一，他最多访问的标签是Python，第二，Python问题在他浏览的所有问题中，占比至少要达到20%。</p>\n<p><strong>浏览Python标签的人，通常还会浏览什么标签呢？</strong></p>\n<p><img class=\"alignnone size-large wp-image-7815\" src=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-1024x1024.png\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-1024x1024.png 1024w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-150x150.png 150w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-300x300.png 300w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-768x768.png 768w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-200x200.png 200w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-400x400.png 400w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-600x600.png 600w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-800x800.png 800w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-1000x1000.png 1000w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/common_other_tags-1-1200x1200.png 1200w \" alt=\"\" width=\"1024\" height=\"1024\"></p>\n<p>对于一个 Python 开发者来说，访问最多的标签是 Pandas（优势非常明显），这点我们丝毫不感到意外。访问量第二多的标签是JavaScript，这些流量代表了使用 Python 做 Web 开发的程序员。这证实了我们的猜想：我们应该考虑的是与Python标签一起访问的那些标签，而不仅仅是与 Python 相关的标签的增长（这两者是有区别的）。</p>\n<p>我们还能看到其他的一些“技术簇”（“clusters” of technologies）。这些聚在一起的标签，表现出了一定的相关性，借此我们可以分析出它们之间的关系：比如说Python程序员是不是更加倾向于访问某些特定的标签。通过过滤出一组具有较高的皮尔森相关系数（ Pearson correlation）的标签，我们可以在图表中看到三组关系：</p>\n<p><img class=\"alignnone size-large wp-image-7816\" src=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-1024x1024.png\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-1024x1024.png 1024w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-150x150.png 150w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-300x300.png 300w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-768x768.png 768w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-200x200.png 200w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-400x400.png 400w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-600x600.png 600w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-800x800.png 800w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-1000x1000.png 1000w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph-1-1200x1200.png 1200w \" alt=\"\" width=\"1024\" height=\"1024\"></p>\n<p>我们可以看到一些较大的“技术簇”，它表明了Python可以解决的一类问题。在图片的中上部分我们可以看到有关数据科学和机器学习相关的内容：有pandas，NumPy和Matplotlib，并且你可以发现它们和R语言，Keras以及TensorFlow息息相关。它下面的一个“技术簇”表现了有关web开发领域的一些关系，这里有JavaScript, HTML, CSS, Django, Flask 和 JQuery。另外还有两个“技术簇”，左边是与系统管理／DevOps相关的（以linux和bash为中心），右边是与数据工程相关的（包括Spark, Hadoop, 和 Scala）</p>\n<h2>话题的增长</h2>\n<p>我们发现，Python相关的访问流量可以被归纳为一些特定的话题。这使得我们可以获知，Python访问量的增长，与哪些话题息息相关。</p>\n<p>想象一下，我们正在研究一个用户的历史纪录并发现Python是他最常访问的标签。我们怎么才能进一步判断出这个用户的细分属性呢？是web开发者？数据科学家？系统管理员？还是其他角色？为了达成这一目标，我们还需要去研究他访问量第二多的标签，第三多的标签，以此类推。沿着这条路走下去，最终我们会在上述“技术簇”模型中，找到属于这位程序员的位置。</p>\n<p>因此，我们提出了一种简单的方法，通过对以下九个标签的访问统计 ，我们将某个用户归类到某个话题中。</p>\n<ul>\n<li><strong>数据科学</strong>：Pandas, NumPy 或 Matplotlib</li>\n<li><strong>Web 开发者</strong>：JavaScript, Django, HTML</li>\n<li><strong>系统管理员／DevOps</strong>：Linux, Bash 或 Windows.</li>\n<li><strong>无法归类</strong>：上述 9 个标签的访问量，没有任何一个能够占据该用户5%以上的流量。</li>\n</ul>\n<p>虽说并不是特别精确，但是该方法可以让我们快速的估计出每个领域对Python增长的影响力。我们也尝试使用了更加严谨的计算手段，比如说潜在狄利克雷分布（Latent Dirichlet Allocation），得到的结果是相似的。</p>\n<p><strong>上述哪种类别的Python开发者越来越常见了呢？</strong></p>\n<p>考虑到我们现在主要研究的是用户而不是问题，我们首先为您展示Stack Overflow全体注册用户访问上述话题的比例变化趋势（不论其是否访问了Python话题）</p>\n<p><img class=\"alignnone size-large wp-image-7817\" src=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-1024x731.png\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-1024x731.png 1024w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-300x214.png 300w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-768x549.png 768w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-280x200.png 280w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-560x400.png 560w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-840x600.png 840w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-1120x800.png 1120w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/user_categories_plot-1-1400x1000.png 1400w \" alt=\"\" width=\"1024\" height=\"731\"></p>\n<p>我们可以看到，Web开发和系统管理员这两大类在过去的三年中增长平缓，但是Python程序员访问数据科学相关技术的占比却飞速增长。这就说明，Python的流行主要还是由数据科学以及机器学习驱动的。</p>\n<p>通过计算Python程序员在2016和2017两年中访问某个标签点流量，我们还可以研究一下每个单独标签的增长水平。比方说，可能出现的情况是：Javascript标签的流量总体平稳，但若仅考虑Python程序员对此标签的访问，Javascript标签的访问占比可能会下降。当我们计算出每个标签的增长速率后，我们可以在网络图表中展现出某个话题的增长或萎缩。</p>\n<p><img class=\"alignnone size-large wp-image-7818\" src=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-1024x1024.png\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-1024x1024.png 1024w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-150x150.png 150w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-300x300.png 300w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-768x768.png 768w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-200x200.png 200w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-400x400.png 400w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-600x600.png 600w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-800x800.png 800w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-1000x1000.png 1000w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/tag_network_graph_color-1-1200x1200.png 1200w \" alt=\"\" width=\"1024\" height=\"1024\"></p>\n<p>这些工作有利于证明我们的猜想：Python的增长主要和数据科学以及机器学习相关，图表中大多数的技术簇都在向橙色演变，这说明这些标签开始成为Python生态系统的主角了。</p>\n<h2>来自工业界的数据</h2>\n<p>理解Python的增长还有一个途径，那就是考察一下访问它的流量都来自哪些类型的公司。</p>\n<p>我们仅关注Python增长速度最为显著的两个国家：美国和英国。在这俩国家中，我们可以将流量按照行业归类（就像我们对比AWS和Azure一样）</p>\n<p><img class=\"alignnone size-large wp-image-7819\" src=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-1024x1024.png\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-1024x1024.png 1024w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-150x150.png 150w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-300x300.png 300w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-768x768.png 768w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-200x200.png 200w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-400x400.png 400w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-600x600.png 600w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-800x800.png 800w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-1000x1000.png 1000w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/by_industry_graph-1-1200x1200.png 1200w \" alt=\"\" width=\"1024\" height=\"1024\"></p>\n<p>访问Python最多的是学术界（优势明显），包括各类科研院校。是因为为本科生开了Python课么？</p>\n<p>可能有这方面的原因，但绝不是全部的原因。在上一篇文章中我们看到，Python的流量在夏季的时候也很多，不仅仅是春秋两季。比如，Python和Java是高校最常访问的标签，我们可以看出两者的季节性变化是不同的。</p>\n<p><img class=\"alignnone size-large wp-image-7820\" src=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-1024x1024.png\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-1024x1024.png 1024w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-150x150.png 150w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-300x300.png 300w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-768x768.png 768w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-200x200.png 200w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-400x400.png 400w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-600x600.png 600w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-800x800.png 800w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-1000x1000.png 1000w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/percent_academic_by_month_plot-1-1200x1200.png 1200w \" alt=\"\" width=\"1024\" height=\"1024\"></p>\n<p>我们可以看到，Java在夏季访问量下降的非常多，因为Java是最常见的本科课程。与之相对的是，Python在夏季流量的占比非常高。来自高校的Python的高访问量主要是来自科研人员，他们整年都在工作。这也为我们的猜想提供了更多的证据，Python的增长主要是因为它强大的科学计算能力和数据分析能力。</p>\n<p>至于其他行业，我们发现Python在政府部门非常流行，增长迅速。同时，Python在电子和制造业也被广泛使用。我对这些行业不太了解，很想了解它们是如何使用Python的。在零售业和保险业，Python还不是主流，一些研究表明，Java在这些行业仍然占据统治地位。</p>\n<p><strong>本文主要研究的是Python的增长。那么，Python在某个行业的增长速度，是否明显高于其他行业呢？</strong></p>\n<p><img class=\"alignnone size-large wp-image-7821\" src=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-1024x1024.png\" sizes=\"(max-width: 1024px) 100vw, 1024px\" srcset=\"https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-1024x1024.png 1024w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-150x150.png 150w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-300x300.png 300w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-768x768.png 768w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-200x200.png 200w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-400x400.png 400w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-600x600.png 600w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-800x800.png 800w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-1000x1000.png 1000w , https://zgab33vy595fw5zq-zippykid.netdna-ssl.com/wp-content/uploads/2017/09/industry_growth_plot-1-1200x1200.png 1200w \" alt=\"\" width=\"1024\" height=\"1024\"></p>\n<p>过去一年里，Python在各行业的增长几乎是差不多的，至少在英美两国是这样。各个行业访问Python的流量增长了2-3个百分点（对于原本使用Python不多的行业，这样的增长是非常显著的，比如之前提到的保险和零售业）</p>\n<p>在大部分行业中，Java仍然是最多访问的标签（2017年截止到目前的最新数据），但是Python进步明显。比如，在金融领域（该领域是SO站点访问量占比较大的行业之一），Python的访问量从2016年排名第四升至2017年的排名第二。</p>\n<h2>结论</h2>\n<p>作为一个数据科学家，我以前使用 Python 但是现在用 R 语言工作，这些研究是否会让我重回 Python 的怀抱？</p>\n<p>我并不这样认为，一方面，R 语言增长的同样很快；在上一篇文章里面我们可以看到，R 语言是增长速度第二快的编程语言，仅次于Python。我更倾向于使用 R 语言进行数据分析，这和它的流行度并没有关系。（我准备写一篇个人博客，讲讲我为何从 Python 迁移到R，为何两种语言我都喜欢但却不愿意重回 Python 的怀抱）</p>\n<p>不论如何，数据科学是一个令人激动，增长迅速的领域，这一领域空间很大，还能容得下很多语言，我鼓励开发者们在他们职业生涯的早期应该考虑去学习一些数据科学的技能。数据科学是软件开发生态系统中增长最为迅速的领域，并且越来越多的渗透到各行各业中。</p>\n<h3>SO 原文的读者评论精选：</h3>\n<p>onemerlin ： 作者对Python在电子和制造业的增长有兴趣，我是一个嵌入式老兵，我来给大家介绍一下。在电子行业，以前测试工具都是C/C++/Java写的，和脚本语言比起来，维护它们代价太大，有了Python，我们的硬件工程师只需要借助一些 I/O库就可以快速的编写一些脚本了。此外，以前用于布线和仿真的CAD软件都适用 TCL 编程，和 Python 语言相比，TCL太反人类了。</p>\n<p>Robert Mennell： 我很好奇，如果说一个人使用Python是为了它和C语言交互的能力，为什么不用NodeJs呢（不知道还可以用NodeJs来封装么？）我见过很多优秀的NodeJs程序员，和C++程序员合作，使用javascrip进行硬件交互。这些人都晋升的比较快，没时间访问stack overflow，相反，那些不知道Nodejs可以做这些事情的科研人员才老喜欢到Stack Overflow搜搜搜。</p>\n<p>jdenvir ： 我是一个数学家、程序员，工作是一个生物医学家。生物和生物医学最近一二十年向着计算方向发展，我必须要教那些20几岁的博士去学习编程，我是一个Java程序员，但是Java不适合这些初学者，R语言感觉有点怪，除非你是个统计学家。Python正好弥补了这些，容易上手，足够强大可以去帮助我们研究真正的科学。</p>\n<p>Mike ： “为什么Python（蟒蛇）增长的这么快？”“我不晓得，不过我建议你打电话给虫害管理机构，等它们把你吞掉了就来不及了”</p>\n<p>（Mike，你是Reddit派来的逗比么？）</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/d3704dca07a3c6ce19c14a9762a0d776.jpg\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/d8aa159efcd108a908cd3d6ab74b8f5f.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112499\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112499votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112499\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/10/bb74ca97c7e8b5a21a24f0b5bbc519c3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            初入职场小码农;翻译组的勤务员;C/Python/在线教育/英文翻译        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hanxiaomax\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hanxiaomax/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 75</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://hanxiaomax.github.io\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://www.weibo.com/smilingly1989\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/hanxiaomax\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/a6d031713da6a85b0c6d6390db2c13c7de0b75fd.jpg"}
{"url_object_id": "b09b05cadf7a3aaeb82a891746bd449d", "title": "每周 70+ 小时，吴恩达的招人要求之一", "url": "http://blog.jobbole.com/112218/", "create_date": "2017/09/20", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fjq718j3rvj20g00bf0zp.jpg"], "praise_nums": "1", "comment_nums": "1", "fav_nums": 0, "tags": "职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/aoi\">伯小乐</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p data-incom=\"P0\"><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fjq718j3rvj20g00bf0zp.jpg\"></p>\n<p data-incom=\"P0\">离开百度后的吴恩达，新成立了 DeepLearning.ai 公司。9 月 13 日，吴恩达在 Twitter 发推招兵买马。有人发现其官网的招软件工程师要求中有这样的措词：</p>\n<p data-incom=\"P1\"><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fjq2u4zj6oj20r607kgo0.jpg\"></p>\n<blockquote>\n<p data-incom=\"P2\">我们希望你能很好适应我们的团队文化：</p>\n<ul>\n<li>工作道德强。我们所有人都相信我们的工作能够改变人类的生活，因此不仅聪明地工作，而且努力地工作。在办公室里看到一些团队成员工作到深夜，是很平常的事；我们中的许多人，每周工作和学习 70 个小时以上。</li>\n</ul>\n</blockquote>\n<p data-incom=\"P3\">目前招人文案中是「每周工作和学习 70 小时以上」，但有网友指出之前是「70 ~ 90 小时」。虽然这样的措词并没有直接明确要求应聘者每周工作和学习至少 70 小时，综合开头的「我们希望你能很好地适应我们的团队文化」，意思很明确了。</p>\n<p data-incom=\"P4\">每周至少是 70 小时，</p>\n<ul>\n<li>如果每周 5 天，每天至少 14 小时；</li>\n<li>如果每周 6 天，每天至少 11.6 小时；（这基本就是国内的「996」工作制了。）</li>\n<li>如果每周 7 天，每天至少 10 小时；</li>\n</ul>\n<p data-incom=\"P5\">所以这就引发广大开发圈的激烈讨论了。</p>\n<p data-incom=\"P6\">BestUsernameLeft：</p>\n<blockquote>\n<p data-incom=\"P7\">对这种工作环境，我有直接体会。我自己做过两次（一次是自愿的，一次是要求的）；我已经两次看着同事们这样做了。</p>\n<p data-incom=\"P8\">在精神上，你变得不可能集中精力，也就不能有高质量的工作。你的推理能力和做出好决定的能力受到影响。在心理上，你慢慢变得易怒和急躁，随着时间的推移，压力也会导致身体问题。</p>\n<p data-incom=\"P9\">我不会说那是“永远不值得”。但如果每周做 60 小时以上的工作生活，请你在要做出决定前了解代价。</p>\n</blockquote>\n<p data-incom=\"P10\">Susan J. Fowler：</p>\n<blockquote>\n<p data-incom=\"P11\">每周工作 90 小时的人，写不出良好的代码。不知道你们为啥会想招那样的！</p>\n</blockquote>\n<p data-incom=\"P12\">Farhad Manjoo：</p>\n<blockquote>\n<p data-incom=\"P13\">我也搞不懂。虽然你们把要求公开透明是挺好的，但你们失去了很多有家室的潜在求职者。</p>\n</blockquote>\n<p data-incom=\"P14\">cuminme69420：</p>\n<blockquote>\n<p data-incom=\"P15\">我是 99% 支持的，像吴恩达这样的人每周想工作这么长，这的确没问题。毕竟有些人是真的对工作着迷。但是，我搞不明白的是，要求公司其他成员也是同样的工作时间。这种行为挺愚蠢。</p>\n<p data-incom=\"P16\">我想了想「如果你想在我公司工作就要遵循我的理念和热情」背后的逻辑。或许他们就是在过滤掉那些看重心理稳定性的人吧。在软件工程中，往往有一种特定人格的吸引，补充到那个角色中没有任何问题。</p>\n</blockquote>\n<p data-incom=\"P17\">KneeDeepClunge：</p>\n<blockquote>\n<p data-incom=\"P18\">就我个人来讲，我几乎从来没有每周工作达到 40 小时。因为这包括了每天午餐后的 1 小时休息。这样算来了，我每周实际上大约工作 35 小时。</p>\n</blockquote>\n<p data-incom=\"P19\">qelsin：</p>\n<blockquote>\n<p data-incom=\"P20\">在努力工作 8 小时候，我脑子就一团糟了。即便我真想做完某些事，我几乎不能集中精力，如果遇到这种情况，我也不得不强迫自己辞职了。我无法想象工作 12 – 16 小时后的，你脑子是什么样的状态了 。</p>\n</blockquote>\n<p data-incom=\"P21\">icode2skrillex:</p>\n<blockquote>\n<p data-incom=\"P22\">大约两年前，我每天工作约 16 小时，并且全年每天 24 小时（24 / 7 / 365）都随时手机/电话待命。我变得非常不快乐，非常胖，我和朋友和家人的关系正在衰退。我也和女朋友（现在的妻子）经常争吵，因为我们从来没有见过面或者有任何有意义的联系。</p>\n<p data-incom=\"P23\">我辞掉了那份工作，我现在每周工作 40 个小时。如果我们落后于项目，管理层并没有逼迫使我们加班，他们鼓励我们准时离开并与家人在一起，因为他们意识到工作质量下降了。自从接受了这份工作，我已经减肥 65 磅，和女朋友结婚了，有时间去寻找和买房子。更重要的是（也许是不全面的，但在我们软件工程师这种职业），我能够集中精力发展自己和我的能力，来获得提升。</p>\n<p data-incom=\"P24\">当我去面试时，我总是会问关于工作与生活的平衡，是不是要随叫随到，通常工作多少小时。因为我知道，如果我要持续工作超过 45-50 小时（或者比这更多的时间），我知道我的个人风险。</p>\n</blockquote>\n<p data-incom=\"P25\">sensitiveinfomax:</p>\n<blockquote>\n<p data-incom=\"P26\">不仅仅是心理健康的问题了。</p>\n<p data-incom=\"P27\">花这么多时间在工作上，意味着你没有别的活动了。你将无法发展有意义的人际关系，不会有健康的饮食习惯，也不会像你应该做的那样锻炼身体，也不会给你的家人提供帮助。</p>\n<p data-incom=\"P28\">这将是一个被阻碍的发展状态，除非你换工作。</p>\n<p data-incom=\"P29\">这样累是求啥呢？你很可能不会直接与 Andrew Ng 的工作。他很可能不知道你的名字。如果你有足够的资格在那里被聘了，你就可以得到一份工作时间少、薪水高、有声望的工作。</p>\n</blockquote>\n<p class=\"tagline\" data-incom=\"P30\">xian0：</p>\n<blockquote>\n<p data-incom=\"P31\">每天工作 70 小时，他们是怎样安排的呢？。每天早八点到晚七点（午餐 1 小时），没有周末么？还是早七点到晚十点，周末双休？没有周末，似乎看起来更正常，但美国人通常也没有很多假期，所以总体上可能更糟。</p>\n<p data-incom=\"P32\">我记得，当人们坐在电脑一天要 9-12 小时，结果最后就是在玩 WOW 之类的游戏。</p>\n</blockquote>\n<p data-incom=\"P33\">CSStudent15：</p>\n<blockquote>\n<p data-incom=\"P34\">我老板每周工作 60 小时。这家伙没有什么爱好，他只是为了公司而活。挺可悲的，我想他除了公司，并不关心其他事。</p>\n<p data-incom=\"P35\">我永远不会在没有工作和生活平衡的公司工作。</p>\n</blockquote>\n<form id=\"form-t1_dn3ztcwnhm\" class=\"usertext warn-on-unload\" action=\"https://www.reddit.com/r/cscareerquestions/comments/70iedc/a_friendly_reminder_that_regularly_working_7090/?limit=500#\">\n<div class=\"usertext-body may-blank-within md-container \">\n<div class=\"md\">\n<p>mjcov：</p>\n<blockquote><p>让你每周工作超过 40 小时的唯一原因，那是你对公司的成长发展有着重大的兴趣。你可能是公司创办人或者合伙人。就我来说，我只是一个员工，我能换其他工作，我不必关心是不是因为我们做事不够快而导致公司在流失客户。招足够多的人去完成他们想做的事，这是某人的工作。我的意思是，我有时候会工作到很晚来救火，但我做的工作并不是那么重要，并不会因为我工作完成的晚了，就有人会受到严重伤害。</p>\n<p>在面试时，我也常常会问工作/生活平衡，向现在的员工去打听了解。我考虑过每周工作 40 小时的弹性（比如：因为我要去的 DMV 是 5 点关门，我能否早点下班），还有每周超过 40 小时的频率。即便是每周工作 40 小时，我感觉自己没有足够多的时间做完所有的事。作为一只单身狗，情况就更惨了。因为所有的家务、购物这些都得自己做了。除了全职工作和睡眠，每天大概有 2-4 小时留给自己支配，可以是学习和我工作相关的东西，或者做个人项目。我不知道其他人是什么情况，尤其是那些家务没人帮的，每周工作 50+ 小时，并且还没有很快就职业疲倦的单身程序员，他们是怎么样做到的。</p></blockquote>\n</div>\n</div>\n</form>\n<p data-incom=\"P36\">当然了，既然有不认同这种工作时长的，就有认同的人。😂😂😂  这不，吴恩达在 9 月 16 日有发一条推：</p>\n<blockquote>\n<p data-incom=\"P37\">自从宣布了 deeplearning.ai 的新岗位，我们在 24 小时内收到大约 120 份的申请，48 小时内大约收到了 270 份。哇！</p>\n</blockquote>\n<p data-incom=\"P38\">噢，对了，吴恩达他们官网招人说明中并没有说明薪资。在没有说明薪资的情况下，并且是高强度工作时间，还有这么多人申请，挺疯狂的。这或许也说明了吴恩达的吸引力吧。</p>\n<p data-incom=\"P38\"><span style=\"color: #ff0000;\">对于这种类似国内 996 的，每周工作/学习 70+ 小时，你怎么看呢？</span></p>\n<p data-incom=\"P39\">参考：</p>\n<p data-incom=\"P40\">Twitter、Reddit、DeepLearning.ai</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112218\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112218votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112218\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">伯小乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/11/f2bb4f6f428a49476a2e91c355c8d150.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            伯乐在线小编一枚~~~~PS：我不是@小编辑，不要问我了        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/aoi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/aoi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/aoi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 253</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e7d8941c8e19478127fbb56b8843766501cf843d.jpg"}
{"url_object_id": "eb3b137648fe2b84ea99ef352615cc1a", "title": "MySQL 索引设计概要", "url": "http://blog.jobbole.com/112487/", "create_date": "2017/09/14", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": "7", "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://draveness.me/sql-index-intro.html\">Draveness</a>   </div><p>在关系型数据库中设计索引其实并不是复杂的事情，很多开发者都觉得设计索引能够提升数据库的性能，相关的知识一定非常复杂。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e53f2b2cf119db0c59de9f83caa31f5e.jpg\" alt=\"Index-and-Performance\"></p>\n<p>然而这种想法是不正确的，索引其实并不是一个多么高深莫测的东西，只要我们掌握一定的方法，理解索引的实现就能在不需要 DBA 的情况下设计出高效的索引。</p>\n<p>本文会介绍 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 中设计索引的一些方法，让各位读者能够快速的在现有的工程中设计出合适的索引。</p>\n<h3 id=\"io\">磁盘 IO</h3>\n<p>一个数据库必须保证其中存储的所有数据都是可以随时读写的，同时因为 MySQL 中所有的数据其实都是以文件的形式存储在磁盘上的，而从磁盘上<strong>随机访问</strong>对应的数据非常耗时，所以数据库程序和操作系统提供了缓冲池和内存以提高数据的访问速度。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3eef1adc99076fce083d3b1beea313fd.jpg\" alt=\"Disk-IO\"></p>\n<p>除此之外，我们还需要知道数据库对数据的读取并不是以行为单位进行的，无论是读取一行还是多行，都会将该行或者多行所在的页全部加载进来，然后再读取对应的数据记录；也就是说，读取所耗费的时间与行数无关，只与页数有关。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/61d440834e7684466865619054c05717.jpg\" alt=\"Page-DatabaseBufferPool\"></p>\n<p>在 MySQL 中，页的大小一般为 16KB，不过也可能是 8KB、32KB 或者其他值，这跟 MySQL 的存储引擎对数据的存储方式有很大的关系，文中不会展开介绍，不过<strong>索引或行记录是否在缓存池中极大的影响了访问索引或者数据的成本</strong>。</p>\n<h4 id=\"section\">随机读取</h4>\n<p>数据库等待一个页从磁盘读取到缓存池的所需要的成本巨大的，无论我们是想要读取一个页面上的多条数据还是一条数据，都需要消耗<strong>约</strong> 10ms 左右的时间：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0f07e5811a5dc125cc01482284cd2f3f.jpg\" alt=\"Disk-Random-IO\"></p>\n<p>10ms 的时间在计算领域其实是一个非常巨大的成本，假设我们使用脚本向装了 SSD 的磁盘上顺序写入字节，那么在 10ms 内可以写入大概 3MB 左右的内容，但是数据库程序在 10ms 之内只能将一页的数据加载到数据库缓冲池中，从这里可以看出随机读取的代价是巨大的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bdeb5251f80438e8d19027231912074a.jpg\" alt=\"Disk-IO-Total-Time\"></p>\n<p>这 10ms 的一次随机读取是按照每秒 50 次的读取计算得到的，其中等待时间为 3ms、磁盘的实际繁忙时间约为 6ms，最终数据页从磁盘传输到缓冲池的时间为 1ms 左右，在对查询进行估算时并不需要准确的知道随机读取的时间，只需要知道估算出的 10ms 就可以了。</p>\n<h4 id=\"section-1\">内存读取</h4>\n<p>如果在数据库的<strong>缓存池</strong>中没有找到对应的数据页，那么会去内存中寻找对应的页面：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/249d4599ab96b6adc85b9c01c3682e7e.jpg\" alt=\"Read-from-Memory\"></p>\n<p>当对应的页面存在于内存时，数据库程序就会使用内存中的页，这能够将数据的读取时间降低一个数量级，将 10ms 降低到 1ms；MySQL 在执行读操作时，会先从数据库的缓冲区中读取，如果不存在与缓冲区中就会尝试从内存中加载页面，如果前面的两个步骤都失败了，最后就只能执行随机 IO 从磁盘中获取对应的数据页。</p>\n<h4 id=\"section-2\">顺序读取</h4>\n<p>从磁盘读取数据并不是都要付出很大的代价，当数据库管理程序一次性从磁盘中<strong>顺序</strong>读取大量的数据时，读取的速度会异常的快，大概在 40MB/s 左右。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2312998ad76d8fb341969812487f1de4.jpg\" alt=\"Sequential-Reads-from-Disk\"></p>\n<p>如果一个页面的大小为 4KB，那么 1s 的时间就可以读取 10000 个页，读取一个页面所花费的平均时间就是 0.1ms，相比随机读取的 10ms 已经降低了两个数量级，甚至比内存中读取数据还要快。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9ebb7991b42865054e063cefb1a4347b.jpg\" alt=\"Random-to-Sequentia\"></p>\n<p>数据页面的顺序读取有两个非常重要的优势：</p>\n<ol>\n<li>同时读取多个界面意味着总时间的消耗会大幅度减少，磁盘的吞吐量可以达到 40MB/s；</li>\n<li>数据库管理程序会对一些即将使用的界面进行预读，以减少查询请求的等待和响应时间；</li>\n</ol>\n<h4 id=\"section-3\">小结</h4>\n<p>数据库查询操作的时间大都消耗在从磁盘或者内存中读取数据的过程，由于随机 IO 的代价巨大，如何在一次数据库查询中减少随机 IO 的次数往往能够大幅度的降低查询所耗费的时间提高磁盘的吞吐量。</p>\n<h3 id=\"section-4\">查询过程</h3>\n<p>在上一节中，文章从数据页加载的角度介绍了磁盘 IO 对 MySQL 查询的影响，而在这一节中将介绍 MySQL 查询的执行过程中以及数据库中的数据的特征对最终查询性能的影响。</p>\n<h4 id=\"index-slices\">索引片（Index Slices）</h4>\n<p>索引片其实就是 SQL 查询在执行过程中扫描的一个索引片段，在这个范围中的索引将被顺序扫描，根据索引片包含的列数不同，<a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 书中对将索引分为宽索引和窄索引：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/305453471fa87c6a090eb4f92003e759.jpg\" alt=\"Thin-Index-and-Fat-Index\"></p>\n<blockquote><p>主键列 <code>id</code> 在所有的 MySQL 索引中都是一定会存在的。</p></blockquote>\n<p>对于查询 <code>SELECT id, username, age FROM users WHERE username=\"draven\"</code> 来说，(id, username) 就是一个窄索引，因为该索引没有包含存在于 SQL 查询中的 age 列，而 (id, username, age) 就是该查询的一个宽索引了，它<strong>包含这个查询中所需要的全部数据列</strong>。</p>\n<p>宽索引能够避免二次的随机 IO，而窄索引就需要在对索引进行顺序读取之后再根据主键 id 从主键索引中查找对应的数据：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d30e5ece6b40f3019e207a701d2c50ad.jpg\" alt=\"Thin-Index-and-Clustered-Index\"></p>\n<p>对于窄索引，每一个在索引中匹配到的记录行最终都需要执行另外的随机读取从聚集索引中获得剩余的数据，如果结果集非常大，那么就会导致随机读取的次数过多进而影响性能。</p>\n<h4 id=\"section-5\">过滤因子</h4>\n<p>从上一小节对索引片的介绍，我们可以看到影响 SQL 查询的除了查询本身还与数据库表中的数据特征有关，如果使用的是窄索引那么对表的随机访问就不可避免，在这时如何让索引片变『薄』就是我们需要做的了。</p>\n<p>一个 SQL 查询扫描的索引片大小其实是由过滤因子决定的，也就是满足查询条件的记录行数所占的比例：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f4149e33e1dccc5702864a629b300bf5.jpg\" alt=\"Filter-Facto\"></p>\n<p>对于 users 表来说，sex=”male” 就不是一个好的过滤因子，它会选择整张表中一半的数据，所以<strong>在一般情况下</strong>我们最好不要使用 sex 列作为整个索引的第一列；而 name=”draven” 的使用就可以得到一个比较好的过滤因子了，它的使用能过滤整个数据表中 99.9% 的数据；当然我们也可以将这三个过滤进行组合，创建一个新的索引 (name, age, sex) 并同时使用这三列作为过滤条件：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f0e821466f63037631b10ca9bce799cb.jpg\" alt=\"Combined-Filter-Facto\"></p>\n<blockquote><p>当三个过滤条件都是等值谓词时，几个索引列的顺序其实是无所谓的，索引列的顺序不会影响同一个 SQL 语句对索引的选择，也就是索引 (name, age, sex) 和 (age, sex, name) 对于上图中的条件来说是完全一样的，这两个索引在执行查询时都有着完全相同的效果。</p></blockquote>\n<p>组合条件的过滤因子就可以达到十万分之 6 了，如果整张表中有 10w 行数据，也只需要在扫描薄索引片后进行 6 次随机读取，这种直接使用乘积来计算组合条件的过滤因子其实有一个比较重要的问题：列与列之间不应该有太强的相关性，如果不同的列之间有相关性，那么得到的结果就会比直接乘积得出的结果大一些，比如：所在的城市和邮政编码就有非常强的相关性，两者的过滤因子直接相乘其实与实际的过滤因子会有很大的偏差，不过这在多数情况下都不是太大的问题。</p>\n<p>对于一张表中的同一个列，不同的值也会有不同的过滤因子，这也就造成了同一列的不同值最终的查询性能也会有很大差别：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3a84a867b9d385867fa3e462cda4f376.jpg\" alt=\"Same-Columns-Filter-Facto\"></p>\n<p>当我们评估一个索引是否合适时，需要考虑极端情况下查询语句的性能，比如 0% 或者 50% 等；最差的输入往往意味着最差的性能，在平均情况下表现良好的 SQL 语句在极端的输入下可能就完全无法正常工作，这也是在设计索引时需要注意的问题。</p>\n<p>总而言之，需要扫描的索引片的大小对查询性能的影响至关重要，而扫描的索引记录的数量，就是总行数与组合条件的过滤因子的乘积，索引片的大小最终也决定了从表中读取数据所需要的时间。</p>\n<h4 id=\"section-6\">匹配列与过滤列</h4>\n<p>假设在 users 表中有 name、age 和 (name, sex, age) 三个辅助索引；当 WHERE 条件中存在类似 age = 21 或者 name = “draven” 这种<strong>等值谓词</strong>时，它们都会成为匹配列（Matching Column）用于选择索引树中的数据行，但是当我们使用以下查询时：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9282a122356982832\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM users\r\nWHERE name = \"draven\" AND sex = \"male\" AND age &gt; 20;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9282a122356982832-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9282a122356982832-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9282a122356982832-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9282a122356982832-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">users</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9282a122356982832-2\"><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"draven\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"male\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9282a122356982832-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>虽然我们有 (name, sex, age) 索引包含了上述查询条件中的全部列，但是在这里只有 name 和 sex 两列才是匹配列，MySQL 在执行上述查询时，会选择 name 和 sex 作为匹配列，扫描所有满足条件的数据行，然后将 age 当做过滤列（Filtering Column）：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/98f9cda753228126ca4d454edfe18386.jpg\" alt=\"Match-Columns-Filter-Columns\"></p>\n<p>过滤列虽然不能够减少索引片的大小，但是能够减少从表中随机读取数据的次数，所以在索引中也扮演着非常重要的角色。</p>\n<h3 id=\"section-7\">索引的设计</h3>\n<p>作者相信文章前面的内容已经为索引的设计提供了充足的理论基础和知识，从总体来看如何减少随机读取的次数是设计索引时需要重视的最重要的问题，在这一节中，我们将介绍 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 一书中归纳出的设计最佳索引的方法。</p>\n<h4 id=\"section-8\">三星索引</h4>\n<p>三星索引是对于一个查询语句可能的最好索引，如果一个查询语句的索引是三星索引，那么它只需要进行<strong>一次磁盘的随机读及一个窄索引片的顺序扫描</strong>就可以得到全部的结果集；因此其查询的响应时间比普通的索引会少几个数量级；根据书中对三星索引的定义，我们可以理解为主键索引对于 <code>WHERE id = 1</code> 就是一个特殊的三星索引，我们只需要对主键索引树进行一次索引访问并且顺序读取一条数据记录查询就结束了。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/51b6a983ef0d571b7821f1c88738cf2f.jpg\" alt=\"Three-Star-Index\"></p>\n<p>为了满足三星索引中的三颗星，我们分别需要做以下几件事情：</p>\n<ol>\n<li>第一颗星需要取出所有等值谓词中的列，作为索引开头的最开始的列（任意顺序）；</li>\n<li>第二颗星需要将 ORDER BY 列加入索引中；</li>\n<li>第三颗星需要将查询语句剩余的列全部加入到索引中；</li>\n</ol>\n<blockquote><p>三星索引的概念和星级的给定来源于 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 书中第四章三星索引一节。</p></blockquote>\n<p>如果对于一个查询语句我们依照上述的三个条件进行设计，那么就可以得到该查询的三星索引，这三颗星中的最后一颗星往往都是最容易获得的，满足第三颗星的索引也就是上面提到的宽索引，能够避免大量的随机 IO，如果我们遵循这个顺序为一个 SQL 查询设计索引那么我们就可以得到一个完美的索引了；这三颗星的获得其实也没有表面上这么简单，每一颗星都有自己的意义：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8acc115991e8b8f008f9b0a768092dbd.jpg\" alt=\"Behind-Three-Star-Index\"></p>\n<ol>\n<li>第一颗星不只是将等值谓词的列加入索引，它的作用是减少索引片的大小以减少需要扫描的数据行；</li>\n<li>第二颗星用于避免排序，减少磁盘 IO 和内存的使用；</li>\n<li>第三颗星用于避免每一个索引对应的数据行都需要进行一次随机 IO 从聚集索引中读取剩余的数据；</li>\n</ol>\n<p>在实际场景中，问题往往没有这么简单，我们虽然可以总能够通过宽索引避免大量的随机访问，但是在一些复杂的查询中我们无法同时获得第一颗星和第二颗星。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9282a136922865754\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT id, name, age FROM users\r\nWHERE age BETWEEN 18 AND 21\r\n  AND city = \"Beijing\"\r\nORDER BY name;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9282a136922865754-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9282a136922865754-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9282a136922865754-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9282a136922865754-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9282a136922865754-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9282a136922865754-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">age </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">users</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9282a136922865754-2\"><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">age </span><span class=\"crayon-i\">BETWEEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9282a136922865754-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">city</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Beijing\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9282a136922865754-4\"><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9282a136922865754-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在上述查询中，我们总可以通过增加索引中的列以获得第三颗星，但是如果我们想要获得第一颗星就需要最小化索引片的大小，这时索引的前缀必须为 (city, age)，在这时再想获得第三颗星就不可能了，哪怕在 age 的后面添加索引列 name，也会因为 name 在范围索引列 age 后面必须进行一次排序操作，最终得到的索引就是 (city, age, name, id)：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0623c023856da52e860cca75c59198a4.jpg\" alt=\"Different-Stars-Index\"></p>\n<p>如果我们需要在内存中避免排序的话，就需要交换 age 和 name 的位置了，在这时就可以得到索引 (city, name, age, id)，当一个 SQL 查询中<strong>同时拥有范围谓词和 ORDER BY 时</strong>，无论如何我们都是没有办法获得一个三星索引的，我们能够做的就是在这两者之间做出选择，是牺牲第一颗星还是第二颗星。</p>\n<p>总而言之，在设计单表的索引时，首先把查询中所有的<strong>等值谓词全部取出</strong>以任意顺序放在索引最前面，在这时，如果索引中同时存在范围索引和 ORDER BY 就需要权衡利弊了，希望最小化扫描的索引片厚度时，应该将<strong>过滤因子最小的范围索引列</strong>加入索引，如果希望避免排序就选择 <strong>ORDER BY 中的全部列</strong>，在这之后就只需要将查询中<strong>剩余的全部列</strong>加入索引了，通过这种固定的方法和逻辑就可以最快地获得一个查询语句的二星或者三星索引了。</p>\n<h3 id=\"section-9\">总结</h3>\n<p>在单表上对索引进行设计其实还是非常容易的，只需要遵循固定的套路就能设计出一个理想的三星索引，在这里强烈推荐 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 这本书籍，其中包含了大量与索引设计与优化的相关内容；在之后的文章中读者也会分析介绍书中提供的几种估算方法，来帮助我们通过预估问题设计出更高效的索引。</p>\n<p>如果对文章内容的有疑问，可以在博客下面评论留言（评论系统使用 Disqus，需要翻墙）。</p>\n<blockquote><p>Follow: <a href=\"https://github.com/Draveness\">Draveness · GitHub</a></p></blockquote>\n<h2 id=\"reference\">Reference</h2>\n<ul>\n<li><a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a></li>\n<li><a href=\"https://dev.mysql.com/doc/refman/5.7/en/innodb-file-space.html\">File Space Management</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=9eMWG3fwiEU\">Inside of Hard Drive – YouTube</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=4iaxOUYalJU\">Hard Disk Working – How does a hard disk work – Hard Drive – YouTube</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112487\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112487votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112487\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"}
{"url_object_id": "0f20efaab05e871972b90f5ccd637e96", "title": "MySQL 8.0.3 RC 版即将发布，看看有哪些变化", "url": "http://blog.jobbole.com/112407/", "create_date": "2017/09/11", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": 0, "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dev.mysql.com/doc/relnotes/mysql/8.0/en/\">MySQL</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/88499/mysql-8-0-3-rc-coming-soon\">老叶茶馆 微信公众号</a>   </div><p>MySQL 8.0.3 即将发布，一起看看有什么新变化吧</p>\n<p>MySQL 8.0.3 即将发布 RC 版本，这预示着 8.0 版本离 GA 越来越近了。</p>\n<p>下面分享一下 8.0.3 版本的一些重要新特性、新变化：</p>\n<ol class=\" list-paddingleft-2\">\n<li>直接<strong>废除 query cache</strong>（应该只是关闭入口，自行编译源码的话，还能再次启用）</li>\n<li>查询优化器支持直接在 SQL 中利用 <strong>SET_VAR</strong> 这个 HINT 语法修改某些会话级的选项，比如：- SELECT /*+ SET_VAR(sort_buffer_size = 16M) */ name FROM people ORDER BY name;- INSERT /*+ SET_VAR(foreign_key_checks=OFF) */ INTO t2 VALUES(2);\n<p>（这个功能超级实用啊，直接在 SQL 内可以修改了，都不用再写一个 SQL，而且还担心会影响别人）</p></li>\n<li>查询优化器现在支持将各个列统计结果直方图存储在 <strong>column_statistics</strong> 数据字典中，以便构造执行计划。有了这个直方图，就可用于该列和常量的比较判断</li>\n<li>查询优化器中新增标记位 <strong>use_invisible_indexes</strong>，用于控制在构造执行计划时是否考虑不可见索引（invisible indexes）因素</li>\n<li>InnoDB 新增<strong>备份专用锁</strong>，以前 InnoDB 表在线热备时若同时进行 DML 可能导致 InnoDB 文件的快照不一致，有了这个备份锁就不用担心了。备份锁用法是 <strong>LOCK INSTANCE FOR BACKUP、UNLOCK INSTANCE</strong>，需要有 <strong>BACKUP_ADMIN</strong> 权限</li>\n<li>InnoDB 现在支持<strong>表 DDL 的原子性</strong>，也就是 InnoDB 表上的 DDL 也可以实现事务完整性了，要么失败回滚，要么成功提交，不至于出现 DDL 时部分成功的问题，此外还<strong>支持 crash-safe 特性</strong>（这个功能大赞啊）</li>\n<li>若是延迟初始化组复制（GR，Group Replication），也就是在 single-primary 模式下，辅助节点上可以通过异步复制通道写入数据，这在正常初始化组复制插件时是不允许的（Bug #26314756，这是个内部 BUG ID，我们看不到的，别费劲了。不过还有万能的 github 啊，也能看到相关描述，参见：<a title=\"https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d\" href=\"https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d\" target=\"_blank\">https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d</a>）</li>\n<li>系统库 INFORMATION_SCHEMA 中的 <strong>FILES、PARTITIONS、REFERENTIAL_CONSTRAINTS </strong>等几个视图被重新实现了一番（这个没说太具体，可能和所有的 DDL 都放入 InnoDB 有关系，不再使用 FRM 文件存储 DDL 信息）</li>\n<li>由于外键约束锁功能改造，涉及到外键约束的父表上的列改名功能将暂时被禁用一段时间（估计过几个小版本就能正常用了）</li>\n<li>InnoDB 通用表空间新增改名语法：<strong>ALTER TABLESPACE … RENAME TO</strong>（作为 MySQL DBA，貌似没什么人玩通用表空间，可能从 Oracle DBA 转过来更习惯使用吧）</li>\n<li>MySQL 复制的 slave 节点上，<strong>log_slave_updates </strong>选项默认值改为 ON（这个也是比较实用，方便将该 slave 直接作为中继节点使用）</li>\n<li>选项 <strong>sql_log_bin </strong>的全局作用域被改成回话级作用域，也就是修改本选项只影响本会话，不再影响全局（这个选项一般也是在会话级使用）</li>\n<li>选项 <strong>max_allowed_packet </strong>的默认值从 4M 提高到 64M（这个貌似比较实在）</li>\n<li>选项 <strong>event_scheduler </strong>的默认值由 OFF 改成 ON，使得默认启用 event scheduler 功能（我觉得 event 功能挺好的呀，不过貌似没几个人使用 event）</li>\n<li>选项 <strong>max_error_count </strong>的默认值从 64 提高到 1024（没感觉的说）</li>\n<li>最后一个，utf8mb4 字符集增加俄语的校验集（新增 utf8mb4_ru_0900_ai_ci、utf8mb4_ru_0900_as_cs 两种 collations set）</li>\n</ol>\n<p>一起期待 8.0.3 的发布吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112407\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112407votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112407\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"}
{"url_object_id": "6a460eaa67aa7e8ca87d0cb25e5f526a", "title": "惊叹！这个盲人程序员是这样写代码的", "url": "http://blog.jobbole.com/112473/", "create_date": "2017/09/14", "front_image_url": ["http://wx2.sinaimg.cn/mw690/6941baebly1fjj46lxsofj20sg0lc3zw.jpg"], "praise_nums": "4", "comment_nums": "3", "fav_nums": 0, "tags": "开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.vincit.fi/en/blog/software-development-450-words-per-minute/\">Tuukka Ojala</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fjj46lxsofj20sg0lc3zw.jpg\"></p>\n<p>我认为你第一次看到我的工作间肯定这样想 —— “总感觉少些什么”。没有显示器和鼠标，却有个人敲打着键盘，不知注视着哪里。</p>\n<p>这就是我，我同事可以证明我没问题。我是位于坦佩雷（芬兰西南部一座城市）的 Vincit 写字楼中的一名软件开发者。我双目失明。这篇文章中我将讲述有关我工作中的事情。</p>\n<h2>你真的什么都看不到吗？</h2>\n<p>准确来说，我觉察到阳光和其他明亮的光线，不过也仅限这些。其实，这对我的工作也并没有什么帮助。</p>\n<h2>你工作内容是什么？</h2>\n<p>和大部分人一样：忙时写代码，闲时和同事吹逼。我做全栈项目，主攻后端。兼职访问顾问 – 或称监管，随你如何称呼。</p>\n<h2>你如何使用电脑？</h2>\n<p>我用的电脑是一台运行 Windows 10 的普通笔记本。是其中的软件让一切变得神奇。我使用一款叫做屏幕阅读器的程序来访问电脑。屏幕阅读器监听屏幕上的变化并通过盲文（需要单独的盲文设备）或合成的声音来展示给用户。这并不是你如今听到的各种智能助理的合成声音。我使用一种机械声音，每分钟能说 450 个单词。相比较而言，英语正常语速每分钟 120-150 个单词。我有一个怪癖：我既说英语也说芬兰语，我用芬兰语合成器读英语，因为老旧的屏幕阅读器在语言之间切换不够智能，所以我习惯这样做。下面是个例子是阅读这个段落，我能听懂。</p>\n<p><a href=\"https://www.vincit.fi/wp-content/uploads/2017/08/mpsample.mp3?_=1\">https://www.vincit.fi/wp-content/uploads/2017/08/mpsample.mp3?_=1</a></p>\n<p>下面是英语合成器发出的声音：</p>\n<p><a href=\"https://www.vincit.fi/wp-content/uploads/2017/08/essample.mp3?_=2\">https://www.vincit.fi/wp-content/uploads/2017/08/essample.mp3?_=2</a></p>\n<p>鼠标对于我来说并不是非常有用，所以我仅仅通过键盘工作。在座的各位应该十分熟悉我用到的命令：方向键和 tab 键控制窗口内的移动，alt+tab 切换窗口等等。屏幕阅读器也有很多自己的快捷键，比如阅读活动窗口的不同区域或开关一些功能特性。</p>\n<p>有趣的是阅读网页和其他格式化文档。你看，屏幕阅读器分块呈现信息。每一块可能是一行，也可能是一个单词、一个字母，亦或是文本的片段。举个例子，我在网页中按向下的方向键，我听到页面的下一行。我并不能像正常人一样用眼睛从屏幕上阅读内容。相反，我听到一块一块的内容，或跳过我不感兴趣的部分。</p>\n<p>语音或盲文并不能描绘出窗口的显示布局。信息以线性方式呈现给我。如果你把网页复制粘贴进记事本，你就能明白我看到的网页是什么样子的。就是剥离大部分格式的多行文本。然而屏幕阅读器可以获取网页上的 HTML 语法，所以我也能知道超链接、标题、表单等等。事实上，如果非复选框元素展示成复选框样式，我并不能知道这是复选框。我之后将写一篇文章详细讲述这些内容，记住我刚刚举的是个“反人类”例子。 （译者注：突然感到自责和羞愧，深深明白了一个道理：不要用各种有含意义的传统标签 hack 布局和样式，也不要因为 css 的强大而懒得使用各种有含义的传统标签。共勉）</p>\n<p>我花费大量时间工作在命令行上。事实上我通常用浏览器和编辑器，很少用其他图形应用程序。相比那些为鼠标用户打造的图形界面，我发现用命令行处理手边的工作更加高效。</p>\n<p>既然我如此热爱命令行，为什么我却要选择 Windows 这个并不以命令行出名的操作系统呢？答案很简单：Windows 是最方便的操作系统。<a href=\"https://www.nvaccess.org/\">NVDA</a>是我所选择的屏幕阅读器，它是开源的并且维护比其他阅读器更频繁。如果上天再我一次机会，我可能会选 Mac 系统，因为我认为它是易用性和功能性平衡的典范。不幸的是 Mac 系统上的屏幕阅读器 <a href=\"https://www.apple.com/accessibility/mac/vision/\">VoiceOver</a> 经历了漫长的发布周期从而被遗忘，并且它的导航模型和我独特的工作方式并不协调。当然这里也有一个 Gnome 桌面上的<a href=\"https://wiki.gnome.org/action/show/Projects/Orca?action=show&amp;redirect=Orca\">屏幕阅读器</a>，虽然用户很少，依然被很好地维护着，不过还有一些不完善的地方和我日常工作不协调。所以，我选择 Windows。由 GNU 诞生的 Git Bash 和其他命令行工具弥补了 Windows 内置命令行的缺陷。</p>\n<h2>你如何写代码？</h2>\n<p>我花费好长时间才明白为什么大家觉得这个问题是个很高深的问题。记得我上面说过一行一行地阅读文本吗？我也是通过这种方式读代码。通常我会跳过无用的行，或仅听半行来获取内容，但当我需要知道完整信息的时候，我不得不像读小说一样读完所有东西。我当然无法阅读整个代码库。这种情况下我会在脑中抽象一部分代码：这个组件输入 x 返回 y，并不用关心细节逻辑。</p>\n<p>这种阅读方式让我和正常同事的工作方式有些区别。举个例子，当代码审查时，我喜欢看原始 diff 输出，并列窗口显示 diff 对我并不适用，而且还容易让人分心。有修改的代码行上用符号 + 和 – 比用不同背景色标注也要好太多，并不是因为我不能获知颜色名字，而是因为在新增的一行中，读“加”这个字比读“带复杂阴影的高亮红色”用更短的时间。（嘿，我说你呢 Gerrit (一款代码审查工具)）</p>\n<p>你或许会认为缩进和其他代码格式和我无关，因为都是基本的视觉问题。并不是这样，正确的缩进对我的帮助和正常开发者一样。当我用盲文（比语音更加高效）读代码时，我像其他正常程序员一样清楚代码结构。当我进入一段有缩进或无缩进的代码时，我也会得到语音提醒。这些信息帮助我在脑中描绘代码结构。事实上我学的第一门语言就是 Python （PHP 不算），它强制使用代码缩进，这对我来说并不是问题。我有众多理由来强烈建议使用整洁统一的代码风格，其中之一就是不要让我的生活变得更加艰难了，好吗。</p>\n<h2>你喜欢哪款编辑器？</h2>\n<p>剧透一下：这个答案并不是以 V 或者 E 开头（我虽然通过命令行用 Vim 来写 git commit 信息和其他备注。我认为我在这场圣战中是中立的）（译者注：Vim 和 Emacs 梗）一年前我认为 Notepad++ 最棒，它是轻量级的做工精细的文本编辑器。然而一年前我还没有接触大规模 Java 项目，当我接触这种项目时，意味着我应该在 Notepad++ 和理智之间做个选择。最后我选择理智，抛弃 Notepad++ 转投 IntelliJ IDEA 的怀抱。从那之后 IntelliJ IDEA 便是我首选编辑器。我曾对各种 IDE 有深深怨念，它们大多数在纯键盘流操作下麻烦又低效。如果我视力没问题，我肯定早就跳到 IDE 阵营了。</p>\n<p>但你可能会问，为什么当初选 Notepad++。还有其他很多更先进的轻量级编辑器，比如 Sublime 或 Atom。原因很简单：屏幕阅读器无法访问它们。Vim 一类的文本编辑器也是如此，我使用的屏幕阅读器对命令行程序的支持有问题，在这些编辑器上无法处理多于 commit 信息的文本。很遗憾，可用性决定了我能够使用的工具。即使我不能高效工作，也不是什么大问题。</p>\n<h2>你编写过前端代码吗？</h2>\n<p>你应该认为前端开发和视觉有关，注定与盲人程序员无缘。基本上是这样。我从来不自己做概念原型，我做都是有界面，需要随后加入功能的项目。</p>\n<p>然而，我也做过 Angular 和 React 工作任务。怎么会这样？如今很多 APP 基于浏览器。举个例子，我曾花费两周时间为一个 Angular APP 增加国际化支持。我并不需要做任何视觉上的改动。</p>\n<p>我发现对于我这类开发者开说，像 Bootstrap 这类的库简直是上天的礼物。正因为栅格系统（Bootstrap的响应式布局解决方案），我可以自己构建一个粗糙的界面。尽管如此，我做的有关界面的改动在呈现给用户之前仍然要有一双眼睛检查。所以，总而言之，我可以在一定程度上做些前端开发，至少不是和表现层太相关。</p>\n<h2>有什么其他没有提到的东西？</h2>\n<p>其实这篇文章有很多东西没有表达出来。正如上文所承诺，我将全力以赴写一篇文章，有关制作易访问网页的艺术，因为一言未尽是我讨厌的事情之一。我不会半途而废的，敬请期待。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112473\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112473votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112473\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 23</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f99add302e9e9474ef727d93109a13d123869a36.jpg"}
{"url_object_id": "3dd0bd6e615cf2d18c22e1e52fa54c2f", "title": "漫谈传统的 Linux 初始化系统的运行级别", "url": "http://blog.jobbole.com/112479/", "create_date": "2017/09/14", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": 0, "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.networkworld.com/article/3222070/linux/maneuvering-around-run-levels-on-linux.html\">Sandra Henry-stocker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8857-1.html\">Linux中国/penghuster</a>   </div><blockquote><p>了解运行级别是如何配置的，如何改变系统运行级别以及修改对应状态下运行的服务。</p></blockquote>\n<p>在 Linux 系统中，运行级别run level是指运维的级别，用于描述一种表明什么服务是可用的系统运行状态。</p>\n<p>运行级别 1 是严格限制的，仅仅用于系统维护；该级别下，网络连接将不可操作，但是管理员可以通过控制台连接登录系统。</p>\n<p>其他运行级别的系统允许任何人登录和使用，但是不同级别中可使用的服务不同。本文将探索如何配置运行级别，如何交互式改变系统运行级别以及修改该状态下可用的服务。</p>\n<p>Linux 系统的默认运行状态是一个在系统开机时使用的运行级别（除非有其他的指示），它通常是在 <code>/etc/inittab</code> 文件中进行配置的，该文件内容通常如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9e7a56a8316633649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nid:3:initdefault\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56a8316633649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56a8316633649-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56a8316633649-1\"><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">initdefault</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56a8316633649-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>包括 Debian 系统在内的一些系统，默认运行级别为 2，而不是上述文件中的 3，甚至都没有 <code>/etc/inittab</code> 文件。</p>\n<p>运行级别在默认情况下是如何被配置，其配置依赖于你所运行的 Linux 操作系统的具体发行版本。 例如，在某些系统中， 运行级别 2 是多用户模式，运行级别 3 是多用户模式并支持 NFS （网络文件系统）。 在另外一些系统，运行级别 2 – 5 基本相同，运行级别 1 是单用户模式。例如，Debian 系统的所用运行级别如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9e7a56b3465901222\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n0 = 停机\r\n1 = 单用户（维护模式）\r\n2 = 多用户模式\r\n3-5 = 同 2 一样\r\n6 = 重启\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b3465901222-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b3465901222-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b3465901222-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b3465901222-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b3465901222-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b3465901222-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b3465901222-1\"><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>停机</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b3465901222-2\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>单用户（维护模式）</div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b3465901222-3\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>多用户模式</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b3465901222-4\"><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>同<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span>一样</div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b3465901222-5\"><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>重启</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b3465901222-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在 Linux 系统上，运行级别 3 用于共享文件系统给其它系统，可以方便地只通过改变系统的运行级别来启动和停止文件系统共享。系统从运行级别 2 改变到 3 系统将允许文件系统共享，反之从运行级别 3 改变到 2 则系统不支持文件系统共享。</p>\n<p>在某个运行级别中，系统运行哪些进程依赖于目录 <code>/etc/rc?.d</code> 目录的内容，其中 <code>?</code> 可以是 2、 3、 4 或 5 （对应于相应的运行级别）。</p>\n<p>在以下示例中（Ubuntu 系统），由于这些目录的配置是相同的，我们将看见上述 4 个级别对应的目录中的内容是一致的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9e7a56b7003944267\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/etc/rc2.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc2.d$ cd ../rc3.d\r\n/etc/rc3.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc3.d$ cd ../rc4.d\r\n/etc/rc4.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc4.d$ cd ../rc5.d\r\n/etc/rc5.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56b7003944267-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56b7003944267-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-2\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-3\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-4\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-6\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-7\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-8\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-9\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-10\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-11\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-12\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-13\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-14\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-15\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-16\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-17\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-18\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56b7003944267-19\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">local</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56b7003944267-20\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>这些都是什么文件？它们都是指向 <code>/etc/init.d</code> 目录下用于启动服务的脚本符号连接。 这些文件的文件名是至关重要的， 因为它们决定了这些脚本文件的执行顺序，例如, S20 脚本是在 S50 脚本前面运行的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9e7a56bb474596658\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls -l\r\ntotal 4\r\n-rw-r--r-- 1 root root 677 Feb 16  2016 README\r\nlrwxrwxrwx 1 root root  20 Aug 30 14:40 S20kerneloops -&gt; ../init.d/kerneloops\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 S20rsync -&gt; ../init.d/rsync\r\nlrwxrwxrwx 1 root root  23 Aug 30 16:10 S20smartmontools -&gt; ../init.d/smartmontools\r\nlrwxrwxrwx 1 root root  27 Aug 30 14:40 S20speech-dispatcher -&gt; ../init.d/speech-dispatcher\r\nlrwxrwxrwx 1 root root  17 Aug 31 14:12 S20sysstat -&gt; ../init.d/sysstat\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 S50saned -&gt; ../init.d/saned\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S70dns-clean -&gt; ../init.d/dns-clean\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S70pppd-dns -&gt; ../init.d/pppd-dns\r\nlrwxrwxrwx 1 root root  21 Aug 30 14:40 S99grub-common -&gt; ../init.d/grub-common\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S99ondemand -&gt; ../init.d/ondemand\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S99rc.local -&gt; ../init.d/rc.local\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bb474596658-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bb474596658-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bb474596658-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bb474596658-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bb474596658-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bb474596658-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bb474596658-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bb474596658-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bb474596658-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bb474596658-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bb474596658-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bb474596658-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bb474596658-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bb474596658-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bb474596658-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bb474596658-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bb474596658-2\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bb474596658-3\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">677</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">README</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bb474596658-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20kerneloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">kerneloops</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bb474596658-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20rsync</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">rsync</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bb474596658-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20smartmontools</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">smartmontools</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bb474596658-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bb474596658-8\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20sysstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sysstat</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bb474596658-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S50saned</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">saned</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bb474596658-10\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bb474596658-11\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bb474596658-12\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">common</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bb474596658-13\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99ondemand</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bb474596658-14\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">local</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bb474596658-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0076 seconds] -->\r\n<p>如你所想，目录 <code>/etc/rc1.d</code> 因运行级别 1 的特殊而不同。它包含的符号链接指向非常不同的一套脚本。 同样也要注意到其中一些脚本以 <code>K</code> 开头命名，而另一些与其它运行级别脚本一样以 <code>S</code> 开头命名。这是因为当系统进入单用户模式时， 一些服务需要<strong>停止</strong>。 然而这些 K 开头的符号链接指向了其它级别 S 开头的符号链接的同一文件时， K（kill）表示这个脚本将以指示其停止的参数执行，而不是以启动的参数执行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9e7a56bf749054796\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/etc/rc1.d$ ls -l\r\ntotal 4\r\nlrwxrwxrwx 1 root root  20 Aug 30 14:40 K20kerneloops -&gt; ../init.d/kerneloops\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 K20rsync -&gt; ../init.d/rsync\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 K20saned -&gt; ../init.d/saned\r\nlrwxrwxrwx 1 root root  23 Aug 30 16:10 K20smartmontools -&gt; ../init.d/smartmontools\r\nlrwxrwxrwx 1 root root  27 Aug 30 14:40 K20speech-dispatcher -&gt; ../init.d/speech-dispatcher\r\n-rw-r--r-- 1 root root 369 Mar 12  2014 README\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S30killprocs -&gt; ../init.d/killprocs\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S70dns-clean -&gt; ../init.d/dns-clean\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S70pppd-dns -&gt; ../init.d/pppd-dns\r\nlrwxrwxrwx 1 root root  16 Aug 30 14:40 S90single -&gt; ../init.d/single\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bf749054796-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bf749054796-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bf749054796-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bf749054796-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bf749054796-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bf749054796-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bf749054796-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bf749054796-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bf749054796-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bf749054796-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bf749054796-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56bf749054796-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56bf749054796-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bf749054796-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bf749054796-2\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bf749054796-3\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20kerneloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">kerneloops</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bf749054796-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20rsync</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">rsync</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bf749054796-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20saned</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">saned</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bf749054796-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20smartmontools</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">smartmontools</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bf749054796-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bf749054796-8\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">369</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Mar</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2014</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">README</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bf749054796-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S30killprocs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">killprocs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bf749054796-10\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bf749054796-11\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56bf749054796-12\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S90single</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">single</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56bf749054796-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0066 seconds] -->\r\n<p>你可以改变系统的默认运行级别，尽管这很少被用到。例如，通过修改前文中提到的 <code>/etc/inittab</code> 文件，你能够配置 Debian 系统的默认运行级别为 3 （而不是 2），以下是该文件示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9e7a56c3965982669\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nid:3:initdefault:\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56c3965982669-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56c3965982669-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56c3965982669-1\"><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">initdefault</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56c3965982669-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>一旦你修改完成并重启系统， <code>runlevel</code> 命令将显示如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9e7a56c6801069402\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ runlevel\r\nN 3\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56c6801069402-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56c6801069402-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56c6801069402-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56c6801069402-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">runlevel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56c6801069402-2\"><span class=\"crayon-i\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56c6801069402-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>另外一种可选方式，使用 <code>init 3</code> 命令，你也能改变系统运行级别（且无需重启立即生效）， <code>runlevel</code> 命令的输出为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9e7a56c9921120766\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ runlevel\r\n2 3\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56c9921120766-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9e7a56c9921120766-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9e7a56c9921120766-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56c9921120766-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">runlevel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9e7a56c9921120766-2\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9e7a56c9921120766-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当然，除非你修改了系统默认级别的 <code>/etc/rc?.d</code> 目录下的符号链接，使得系统默认运行在一个修改的运行级别之下，否则很少需要通过创建或修改 <code>/etc/inittab</code> 文件改变系统的运行级别。</p>\n<h3 id=\"toc_1\">在 Linux 系统中如何使用运行级别？</h3>\n<p>为了扼要重述在系统中如何使用运行级别，下面有几个关于运行级别的快速问答问题：</p>\n<p><strong>如何查询系统当前的运行级别？</strong></p>\n<p>使用 <code>runlevel</code> 命令。</p>\n<p><strong>如何查看特定运行级别所关联的服务进程？</strong></p>\n<p>查看与该运行级别关联的运行级别开始目录（例如， <code>/etc/rc2.d</code> 对应于运行级别 2）。</p>\n<p><strong>如何查看系统的默认运行级别？</strong></p>\n<p>首先，查看 <code>/etc/inittab</code> 文件是否存在。如果不存在，就执行 <code>runlevel</code> 命令查询，你一般就已经处在该运行级别。</p>\n<p><strong>如何改变系统运行级别？</strong></p>\n<p>用 <code>init</code> 命令（例如 <code>init 3</code>）临时改变运行级别，通过修改或创建 <code>/etc/inittab</code> 文件永久改变其运行级别。</p>\n<p><strong>能改变特定运行级别下运行的服务么？</strong></p>\n<p>当然，通过改变对应的 <code>/etc/rc?.d</code> 目录下的符号连接即可。</p>\n<p><strong>还有一些其他的什么需要考虑？</strong></p>\n<p>当改变系统运行级别时，你应该特别小心，确保不影响到系统上正在运行的服务或者正在使用的用户。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112479\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112479votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112479\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "f51b3da1c08181a6b90377ff717b844a", "title": "Linux 系统开机启动项清理", "url": "http://blog.jobbole.com/112384/", "create_date": "2017/09/07", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": "3", "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/cleaning-your-linux-startup-process\">David Both</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8835-1.html\">Linux中国/penghuster</a>   </div><p>一般情况下，常规用途的 Linux 发行版在开机启动时拉起各种相关服务进程，包括许多你可能无需使用的服务，例如蓝牙bluetooth、Avahi、 调制解调管理器ModemManager、ppp-dns（LCTT 译注：此处作者笔误 ppp-dns 应该为 pppd-dns) 等服务进程，这些都是什么东西？用于哪里，有何功能？</p>\n<p>Systemd 提供了许多很好的工具用于查看系统启动情况，也可以控制在系统启动时运行什么。在这篇文章中，我将说明在 Systemd 类发行版中如何关闭一些令人讨厌的进程。</p>\n<h3 id=\"toc_1\">查看开机启动项</h3>\n<p>在过去，你能很容易通过查看 <code>/etc/init.d</code> 了解到哪些服务进程会在引导时启动。Systemd 以不同的方式展现，你可以使用如下命令罗列允许开机启动的服务进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2d77797437041816522\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl list-unit-files --type=service | grep enabled\r\naccounts-daemon.service                    enabled\r\nanacron-resume.service                     enabled\r\nanacron.service                            enabled\r\nbluetooth.service                          enabled\r\nbrltty.service                             enabled\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2d77797437041816522-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797437041816522-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797437041816522-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797437041816522-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797437041816522-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797437041816522-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797437041816522-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797437041816522-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2d77797437041816522-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">unit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797437041816522-2\"><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                    </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797437041816522-3\"><span class=\"crayon-v\">anacron</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">resume</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                     </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797437041816522-4\"><span class=\"crayon-v\">anacron</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                            </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797437041816522-5\"><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                          </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797437041816522-6\"><span class=\"crayon-v\">brltty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                             </span><span class=\"crayon-i\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797437041816522-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797437041816522-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>在此列表顶部，对我来说，蓝牙服务是冗余项，因为在该电脑上我不需要使用蓝牙功能，故无需运行此服务。下面的命令将停止该服务进程，并且使其开机不启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2d77797441042073440\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo systemctl stop bluetooth.service\r\n$ sudo systemctl disable bluetooth.service\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2d77797441042073440-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797441042073440-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797441042073440-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2d77797441042073440-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">stop </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797441042073440-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">disable </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797441042073440-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你可以通过下面命令确定是否操作成功。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2d77797445674830085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl status bluetooth.service\r\n bluetooth.service - Bluetooth service\r\n  Loaded: loaded (/lib/systemd/system/bluetooth.service; disabled; vendor preset: enabled)\r\n  Active: inactive (dead)\r\n    Docs: man:bluetoothd(8)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2d77797445674830085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797445674830085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797445674830085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797445674830085-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797445674830085-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797445674830085-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2d77797445674830085-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">status </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797445674830085-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bluetooth </span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797445674830085-3\"><span class=\"crayon-e\">  </span><span class=\"crayon-v\">Loaded</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loaded</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">disabled</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">vendor </span><span class=\"crayon-v\">preset</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">enabled</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797445674830085-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">Active</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inactive</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dead</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797445674830085-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Docs</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">man</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">bluetoothd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797445674830085-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>停用的服务进程仍然能够被另外一个服务进程启动。如果你真的想在任何情况下系统启动时都不启动该进程，无需卸载该它，只需要把它掩盖起来就可以阻止该进程在任何情况下开机启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2d77797449926117100\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo systemctl mask bluetooth.service\r\n Created symlink from /etc/systemd/system/bluetooth.service to /dev/null.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2d77797449926117100-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797449926117100-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797449926117100-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2d77797449926117100-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">mask </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797449926117100-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Created </span><span class=\"crayon-e\">symlink </span><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797449926117100-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>一旦你对禁用该进程启动而没有出现负面作用感到满意，你也可以选择卸载该程序。</p>\n<p>通过执行命令可以获得如下服务列表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2d7779744c471392056\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl list-unit-files --type=service                       \r\nUNIT FILE                                  STATE   \r\naccounts-daemon.service                    enabled\r\nacpid.service                              disabled\r\nalsa-restore.service                       static    \r\nalsa-utils.service                         masked\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2d7779744c471392056-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d7779744c471392056-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2d7779744c471392056-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d7779744c471392056-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2d7779744c471392056-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d7779744c471392056-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2d7779744c471392056-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2d7779744c471392056-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">unit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">service                       </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d7779744c471392056-2\"><span class=\"crayon-e\">UNIT </span><span class=\"crayon-e\">FILE                                  </span><span class=\"crayon-e\">STATE   </span></div><div class=\"crayon-line\" id=\"crayon-59c2d7779744c471392056-3\"><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                    </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d7779744c471392056-4\"><span class=\"crayon-v\">acpid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                              </span><span class=\"crayon-e\">disabled</span></div><div class=\"crayon-line\" id=\"crayon-59c2d7779744c471392056-5\"><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">restore</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                       </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d7779744c471392056-6\"><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                         </span><span class=\"crayon-i\">masked</span></div><div class=\"crayon-line\" id=\"crayon-59c2d7779744c471392056-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>你不能启用或禁用静态服务，因为静态服务被其他的进程所依赖，并不意味着它们自己运行。</p>\n<h3 id=\"toc_2\">哪些服务能够禁止？</h3>\n<p>如何知道你需要哪些服务，而哪些又是可以安全地禁用的呢？它总是依赖于你的个性化需求。</p>\n<p>这里举例了几个服务进程的作用。许多服务进程都是发行版特定的，所以你应该看看你的发行版文档（比如通过 google 或 StackOverflow）。</p>\n<ul>\n<li><strong>accounts-daemon.service</strong> 是一个潜在的安全风险。它是 AccountsService 的一部分，AccountsService 允许程序获得或操作用户账户信息。我不认为有好的理由能使我允许这样的后台操作，所以我选择掩盖mask该服务进程。</li>\n<li><strong>avahi-daemon.service</strong> 用于零配置网络发现，使电脑超容易发现网络中打印机或其他的主机，我总是禁用它，别漏掉它。</li>\n<li><strong>brltty.service</strong> 提供布莱叶盲文设备支持，例如布莱叶盲文显示器。</li>\n<li><strong>debug-shell.service</strong> 开放了一个巨大的安全漏洞（该服务提供了一个无密码的 root shell ，用于帮助 调试 systemd 问题），除非你正在使用该服务，否则永远不要启动服务。</li>\n<li><strong>ModemManager.service</strong> 该服务是一个被 dbus 激活的守护进程，用于提供移动宽频broadband（2G/3G/4G）接口，如果你没有该接口，无论是内置接口，还是通过如蓝牙配对的电话，以及 USB 适配器，那么你也无需该服务。</li>\n<li><strong>pppd-dns.service</strong> 是一个计算机发展的遗物，如果你使用拨号接入互联网的话，保留它，否则你不需要它。</li>\n<li><strong>rtkit-daemon.service</strong> 听起来很可怕，听起来像是 rootkit。 但是你需要该服务，因为它是一个实时内核调度器real-time kernel scheduler。</li>\n<li><strong>whoopsie.service</strong> 是 Ubuntu 错误报告服务。它用于收集 Ubuntu 系统崩溃报告，并发送报告到 <a href=\"https://daisy.ubuntu.com\">https://daisy.ubuntu.com</a> 。 你可以放心地禁止其启动，或者永久的卸载它。</li>\n<li><strong>wpa_supplicant.service</strong> 仅在你使用 Wi-Fi 连接时需要。</li>\n</ul>\n<h3 id=\"toc_3\">系统启动时发生了什么？</h3>\n<p>Systemd 提供了一些命令帮助调试系统开机启动问题。该命令会重演你的系统启动的所有消息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2d77797451887808281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ journalctl -b\r\n\r\n-- Logs begin at Mon 2016-05-09 06:18:11 PDT,\r\nend at Mon 2016-05-09 10:17:01 PDT. --\r\nMay 16 06:18:11 studio systemd-journal[289]:\r\nRuntime journal (/run/log/journal/) is currently using 8.0M.\r\nMaximum allowed usage is set to 157.2M.\r\nLeaving at least 235.9M free (of currently available 1.5G of space).\r\nEnforced usage limit is thus 157.2M.\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2d77797451887808281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797451887808281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797451887808281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797451887808281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797451887808281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797451887808281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797451887808281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797451887808281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797451887808281-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797451887808281-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797451887808281-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2d77797451887808281-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">journalctl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797451887808281-2\"> </div><div class=\"crayon-line\" id=\"crayon-59c2d77797451887808281-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Logs </span><span class=\"crayon-e\">begin </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">Mon</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PDT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797451887808281-4\"><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">Mon</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PDT</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797451887808281-5\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">journal</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">289</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797451887808281-6\"><span class=\"crayon-e\">Runtime </span><span class=\"crayon-e\">journal</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">journal</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currently </span><span class=\"crayon-i\">using</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.0M.</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797451887808281-7\"><span class=\"crayon-e\">Maximum </span><span class=\"crayon-e\">allowed </span><span class=\"crayon-e\">usage </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">157.2M.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797451887808281-8\"><span class=\"crayon-e\">Leaving </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">least</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">235.9M</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">currently </span><span class=\"crayon-i\">available</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.5G</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">space</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797451887808281-9\"><span class=\"crayon-e\">Enforced </span><span class=\"crayon-e\">usage </span><span class=\"crayon-e\">limit </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">thus</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">157.2M.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797451887808281-10\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797451887808281-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>通过命令 <code>journalctl -b -1</code> 可以复审前一次启动，<code>journalctl -b -2</code> 可以复审倒数第 2 次启动，以此类推。</p>\n<p>该命令会打印出大量的信息，你可能并不关注所有信息，只是关注其中问题相关部分。为此，系统提供了几个过滤器，用于帮助你锁定目标。让我们以进程号为 1 的进程为例，该进程是所有其它进程的父进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2d7779745f666378197\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ journalctl _PID=1\r\n\r\nMay 08 06:18:17 studio systemd[1]: Starting LSB: Raise network interfaces....\r\nMay 08 06:18:17 studio systemd[1]: Started LSB: Raise network interfaces..\r\nMay 08 06:18:17 studio systemd[1]: Reached target System Initialization.\r\nMay 08 06:18:17 studio systemd[1]: Started CUPS Scheduler.\r\nMay 08 06:18:17 studio systemd[1]: Listening on D-Bus System Message Bus Socket\r\nMay 08 06:18:17 studio systemd[1]: Listening on CUPS Scheduler.\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2d7779745f666378197-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d7779745f666378197-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2d7779745f666378197-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d7779745f666378197-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2d7779745f666378197-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d7779745f666378197-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2d7779745f666378197-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d7779745f666378197-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2d7779745f666378197-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d7779745f666378197-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2d7779745f666378197-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">journalctl </span><span class=\"crayon-v\">_PID</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d7779745f666378197-2\"> </div><div class=\"crayon-line\" id=\"crayon-59c2d7779745f666378197-3\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Starting </span><span class=\"crayon-v\">LSB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Raise </span><span class=\"crayon-e\">network </span><span class=\"crayon-v\">interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d7779745f666378197-4\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-v\">LSB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Raise </span><span class=\"crayon-e\">network </span><span class=\"crayon-v\">interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59c2d7779745f666378197-5\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Reached </span><span class=\"crayon-e\">target </span><span class=\"crayon-e\">System </span><span class=\"crayon-v\">Initialization</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d7779745f666378197-6\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-e\">CUPS </span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59c2d7779745f666378197-7\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listening </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">D</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Bus </span><span class=\"crayon-e\">System </span><span class=\"crayon-e\">Message </span><span class=\"crayon-e\">Bus </span><span class=\"crayon-e\">Socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d7779745f666378197-8\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listening </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">CUPS </span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59c2d7779745f666378197-9\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d7779745f666378197-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>这些打印消息显示了什么被启动，或者是正在尝试启动。</p>\n<p>一个最有用的命令工具之一 <code>systemd-analyze blame</code>，用于帮助查看哪个服务进程启动耗时最长。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2d77797464022949787\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemd-analyze blame\r\n         8.708s gpu-manager.service\r\n         8.002s NetworkManager-wait-online.service\r\n         5.791s mysql.service\r\n         2.975s dev-sda3.device\r\n         1.810s alsa-restore.service\r\n         1.806s systemd-logind.service\r\n         1.803s irqbalance.service\r\n         1.800s lm-sensors.service\r\n         1.800s grub-common.service\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2d77797464022949787-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797464022949787-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797464022949787-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797464022949787-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797464022949787-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797464022949787-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797464022949787-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797464022949787-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797464022949787-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2d77797464022949787-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2d77797464022949787-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2d77797464022949787-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">analyze </span><span class=\"crayon-i\">blame</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797464022949787-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8.708s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gpu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">manager</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797464022949787-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8.002s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NetworkManager</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">wait</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">online</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797464022949787-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">5.791s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797464022949787-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">2.975s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sda3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">device</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797464022949787-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.810s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">restore</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797464022949787-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.806s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">logind</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797464022949787-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.803s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">irqbalance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797464022949787-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.800s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lm</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sensors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2d77797464022949787-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.800s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59c2d77797464022949787-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>这个特定的例子没有出现任何异常，但是如果存在系统启动瓶颈，则该命令将能发现它。</p>\n<p>你也能通过如下资源了解 Systemd 如何工作：</p>\n<ul>\n<li><a href=\"https://www.linux.com/learn/understanding-and-using-systemd\">理解和使用 Systemd</a></li>\n<li><a href=\"https://www.linux.com/learn/intro-systemd-runlevels-and-service-management-commands\">介绍 Systemd 运行级别和服务管理命令</a></li>\n<li><a href=\"https://www.linux.com/learn/here-we-go-again-another-linux-init-intro-systemd\">再次前行，另一个 Linux 初始化系统：Systemd 介绍</a></li>\n</ul>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112384\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112384votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112384\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg"}
{"url_object_id": "f56f9e29820a99ea2c92f3d18fcc89d5", "title": "React 许可证的五宗罪", "url": "http://blog.jobbole.com/112503/", "create_date": "2017/09/18", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/09/a7d76e2b76679ff9b1827452d44218fc.png"], "praise_nums": "1", "comment_nums": "1", "fav_nums": 0, "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/9/5-reasons-facebooks-react-license-was-mistake\">Simon Phipps</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8876-1.html\">Linux中国/薛亮</a>   </div><blockquote><p>Facebook 公司的 BSD+专利许可证失败的原因不是因为许可证本身，而是因为它忽略了开源软件更深层次的本质。</p></blockquote>\n<p>2017 年 7 月，Facebook 公司应用于 react 等项目的许可证组合<a href=\"https://meshedinsights.com/2017/07/16/apache-bans-facebooks-license-combo/\">被 Apache 软件基金会禁止使用</a>。该许可证组合曾被 Facebook 应用于其所有作为开源软件发布的项目，它使用了被 OSI 批准的广泛使用的<a href=\"https://meshedinsights.com/2017/04/04/permissive-and-copyleft-are-not-antonyms/\">非互惠</a>许可证 BSD 3-Clause，并且加入了宽泛的、非互惠的专利授权条款，但为了应对挑衅者，该许可证组合的终止规则同样宽泛。这种组合代表了一种新的开源许可证，我称之为“Facebook BSD+专利许可证”（FB + PL），在我看来，该许可证试图与 GPL v2 和 Apache v2 许可证保持兼容，以规避这些许可证所指称的不兼容性。</p>\n<p><a href=\"https://meshedinsights.com/2017/07/16/apache-bans-facebooks-license-combo/\">使用 FB + PL 许可证的 Apache 项目仍在发挥作用</a>，但是我认为 Facebook 所犯错误的原因可能不会立即被一贯秉持实用主义态度的软件开发人员们所注意到。例如，<a href=\"https://medium.com/@dwalsh.sdlr/react-facebook-and-the-revokable-patent-license-why-its-a-paper-25c40c50b562\">由律师转行做程序员的 Dennis Walsh 针对这个问题表示</a>：“它没有什么实质意义”。他的观点是，FB + PL 许可证仅对你所使用的适用该许可证的特定软件项目产生影响，专利授权撤回的后果对另一个专利持有者来说并不严重。他得出结论说：</p>\n<blockquote><p>“Facebook 想要推广开源软件同时不被起诉——这是一个崇高的目标。为此，它可以使用一些苛刻的条款。但在这种情况下，由于上述实践和法律方面的原因，很难在被攻击之后发现是谁干的。”</p></blockquote>\n<p>Dennis 也许是对的，但这并不重要。Facebook 自出机杼地发明自己的开源许可证是一个坏主意。有一系列非直接风险或具体情境的重要因素需要考虑，Facebook 的许可证几乎将它们完全忽略了。</p>\n<ol>\n<li>许可证审批很重要<br>\n使用非 OSI 批准的许可证意味着，就像任何专有许可证一样，将其应用于企业用途时总是需要法律审查。<a href=\"https://meshedinsights.com/2017/07/12/why-osi-license-approval-matters/\">OSI 许可证审批之所以重要</a>，是因为它为开发人员提供了一种指示，即社区评估已经认可了该许可证，并认为它以不会产生不可接受风险的方式提供了软件自由。如果 Facebook 采取了寻求 OSI 批准的路线，那么很有可能一开始就会发现并且回避了他造成的问题。实际上有一种 OSI 批准的许可证能够实现 Facebook 的明确目标（<a href=\"https://opensource.org/licenses/BSDplusPatent\">BSD + 专利许可证</a>）。该许可证最近刚被提交和批准，这看起来是 Facebook 可以考虑采用的合理替代方案。</li>\n<li>较少的提前许可<br>\n不仅仅是许可证批准很重要。任何有关创新自由的不确定性都会阻碍开发人员使用代码。与使用相关的含糊条款在使用前需要消除歧义——该步骤相当于为了继续推进而寻求许可。出于同样的原因，<a href=\"https://meshedinsights.com/2017/03/16/public-domain-is-not-open-source/\">公共领域对于软件开发者来说是不利的</a>，因为使用条款规定了在采用之前需要寻求许可。由于需要向项目添加一个与 Facebook 相关的法律文件，每个企业开发人员现在都需要与法律顾问联系，才能继续推进。即使答案是“是的，可以”，他们仍然不得不停下来寻求许可。<a href=\"https://github.com/facebook/react/issues/10191#issuecomment-316380810\">正如 Aaron Williamson 指出的那样</a>，这可能不是他们的反应。</li>\n<li>不公平的比赛场<br>\nFacebook 使用的专利授权条款为其提供了特殊权利和保护，而项目中的其他人并不享有。这使得开源开发人员感到紧张，原因与<a href=\"https://webmink.com/2010/09/01/copyright-aggregation/\">贡献者协议</a>（contributor agreements）一样。开源项目的软件自由的全部价值在于它创造了一个<a href=\"https://meshedinsights.com/2017/05/03/is-the-gpl-really-declining/#safe\">安全的空间</a>，在其中每个人都是平等的，它保护每个人免受他人动机的影响。刻意为自己设置额外权利是反社会的行为，可悲的是，开源社区有很多不平等权利最终被滥用的例子。</li>\n<li>隐含的授权无效<br>\n许多开源法律机构认为，通过对用于任何目的的软件使用授予许可，即使没有提及专利的许可证也隐含授予专利许可。通过添加任意形式的外部专利授权，Facebook 表示它不认为隐含授权足够（最好的情形）或存在（最差的情形）。专注于开源软件的律师们认为，这是 Facebook 毫无根据的扩大化解释。这也是<a href=\"https://opensource.org/faq#cc-zero\">为什么 OSI 放弃了对 CC0 许可协议批准的原因</a>。</li>\n<li>Apache 基金会的规则<br>\n虽然我没有找到清晰和完整的理由，但 Apache 基金会似乎已经对 Facebook 的许可证组合做出了裁定，因为 Apache 基金会认为，Facebook 的专利授权比 Apache v2 许可证中的专利条款限制性更强。Apache 基金会希望自身是一个中立的软件来源——一个“万能供血者”，而对此产生妨害的条款很有可能违背其规则。对于旨在成为 Apache 生态系统一部分的组件，与 Apache 的许可证产生混乱的做法看起来不太明智。</li>\n</ol>\n<p>所以争论这个问题没有什么意义，因为风险很小，问题微不足道。以一种忽视我上面列出的五个社区规范的方式行动无益于任何人，甚至也帮不了 Facebook。虽然 <a href=\"https://code.facebook.com/posts/112130496157735/explaining-react-s-license/\">Facebook 目前正在坚持己见</a>，但我希望它能够改正，我愿意提供帮助。</p>\n<hr>\n<p>作者简介：Simon Phipps 是“公开软件”（Public Software）开源项目的发起人，以志愿者身份担任 OSI 和文档基金会（The Document Foundation）的理事。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112503\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112503votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112503\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/df06ccaa34ea3c46bdf50c4d4fd0348685508f79.jpg"}
{"url_object_id": "149aabb38c863d753923c7f320a4a6ff", "title": "HttpClient 获取 Cookie 的一次踩坑实录", "url": "http://blog.jobbole.com/112469/", "create_date": "2017/09/14", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/b133aed073d8d50b86dc17cd62408b91.jpg"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": "1", "tags": "开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>在使用HttpClient进行抓取一些网页的时候，经常会保留从服务器端发回的Cookie信息，以便发起其他需要这些Cookie的请求。大多数情况下，我们使用内置的cookie策略，便能够方便直接地获取这些cookie。</p>\n<p>下面的一小段代码，就是访问<a href=\"http://www.baidu.com\">http://www.baidu.com</a>，并获取对应的cookie：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e93b96b5d754615103\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@ Test\r\npublic void getCookie(){\r\n    CloseableHttpClient httpClient = HttpClients.createDefault();\r\n    HttpGet get=new HttpGet(\"http://www.baidu.com\");\r\n    HttpClientContext context = HttpClientContext.create();\r\n    try {\r\n        CloseableHttpResponse response = httpClient.execute(get, context);\r\n        try{\r\n            System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\");\r\n            Arrays.stream(response.getAllHeaders()).forEach(System.out::println);\r\n            System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\");\r\n            context.getCookieStore().getCookies().forEach(System.out::println);\r\n        }\r\n        finally {\r\n            response.close();\r\n        }\r\n    } catch (IOException e) {\r\n        e.printStackTrace();\r\n    }finally {\r\n        try {\r\n            httpClient.close();\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b5d754615103-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b5d754615103-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">CloseableHttpClient </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createDefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">HttpGet </span><span class=\"crayon-v\">get</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpGet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://www.baidu.com\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">HttpClientContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientContext</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">CloseableHttpResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAllHeaders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookieStore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookies</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b5d754615103-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b5d754615103-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>打印结果</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e93b96b69895898649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nServer: bfe/1.0.8.18\r\nDate: Tue, 12 Sep 2017 06:19:06 GMT\r\nContent-Type: text/html\r\nLast-Modified: Mon, 23 Jan 2017 13:28:24 GMT\r\nTransfer-Encoding: chunked\r\nConnection: Keep-Alive\r\nCache-Control: private, no-cache, no-store, proxy-revalidate, no-transform\r\nPragma: no-cache\r\nSet-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:\r\n[version: 0][name: BDORZ][value: 27315][domain: baidu.com][path: /][expiry: null]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b69895898649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b69895898649-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b69895898649-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b69895898649-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b69895898649-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b69895898649-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b69895898649-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b69895898649-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b69895898649-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b69895898649-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b69895898649-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b69895898649-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e93b96b69895898649-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b69895898649-2\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bfe</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.0.8.18</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b69895898649-3\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b69895898649-4\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b69895898649-5\"><span class=\"crayon-v\">Last</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Modified</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mon</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b69895898649-6\"><span class=\"crayon-v\">Transfer</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Encoding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chunked</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b69895898649-7\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Alive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b69895898649-8\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">private</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">store</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proxy</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">revalidate</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">transform</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b69895898649-9\"><span class=\"crayon-v\">Pragma</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b69895898649-10\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BDORZ</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">27315</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">86400</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">baidu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b69895898649-11\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b69895898649-12\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BDORZ</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27315</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">baidu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expiry</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>但是也有一些网站返回的cookie并不一定完全符合规范，例如下面这个例子，从打印出的header中可以看到，这个cookie中的Expires属性是时间戳形式，并不符合标准的时间格式，因此，httpclient对于cookie的处理失效，最终无法获取到cookie，并且发出了一条警告信息：“Invalid ‘expires’ attribute: 1505204523”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e93b96b6d268773661\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n警告: Invalid cookie header: \"Set-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\". Invalid 'expires' attribute: 1505204523\r\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nDate: Tue, 12 Sep 2017 06:22:03 GMT\r\nContent-Type: text/html\r\nConnection: keep-alive\r\nSet-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\r\nCache-Control: no-cache, no-store\r\nServer: WAF/2.4-12.1\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b6d268773661-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b6d268773661-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b6d268773661-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b6d268773661-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b6d268773661-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b6d268773661-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b6d268773661-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b6d268773661-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b6d268773661-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e93b96b6d268773661-1\">警告<span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Invalid </span><span class=\"crayon-e\">cookie </span><span class=\"crayon-v\">header</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Set-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Invalid</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'expires'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">attribute</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1505204523</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b6d268773661-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b6d268773661-3\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">03</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b6d268773661-4\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b6d268773661-5\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">alive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b6d268773661-6\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">90236a64</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8650</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">494b332a285dbd886e5981965fc4a93f023d</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Expires</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1505204523</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpOnly</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b6d268773661-7\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">store</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b6d268773661-8\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WAF</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2.4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12.1</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b6d268773661-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>虽然我们可以利用header的数据，重新构造一个cookie出来，也有很多人确实也是这么做的，但这种方法不够优雅，那么如何解决这个问题？网上相关的资料又很少，所以就只能先从官方文档入手。在官方文档3.4小节custom cookie policy中讲到允许自定义的cookie策略，自定义的方法是实现CookieSpec接口，并通过CookieSpecProvider来完成在httpclient中的初始化和注册策略实例的工作。好了，关键的线索在于CookieSpec接口，我们来看一下它的源码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e93b96b72947604027\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic interface CookieSpec {\r\n……\r\n    /**\r\n      * Parse the {@ code \"Set-Cookie\"} Header into an array of Cookies.\r\n      *\r\n      * &lt;p&gt; This method will not perform the validation of the resultant&lt;code&gt;\r\n      * {@link Cookie}s&lt;/p&gt;\r\n      *\r\n      * @ see #validate\r\n      *\r\n      * @param header the {@ code Set-Cookie} received from the server\r\n      * @param origin details of the cookie origin\r\n      * @ return an array of {@ code Cookie}s parsed from the header\r\n      * @throws MalformedCookieException if an exception occurs during parsing\r\n      */\r\n    List parse(Header header, CookieOrigin origin) throws MalformedCookieException;\r\n……\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b72947604027-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b72947604027-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-2\">……</div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-4\"><span class=\"crayon-c\">      * Parse the {@ code \"Set-Cookie\"} Header into an array of Cookies.</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-5\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-6\"><span class=\"crayon-c\">      * &lt;p&gt; This method will not perform the validation of the resultant&lt;code&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-7\"><span class=\"crayon-c\">      * {@link Cookie}s&lt;/p&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-8\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-9\"><span class=\"crayon-c\">      * @ see #validate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-10\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-11\"><span class=\"crayon-c\">      * @param header the {@ code Set-Cookie} received from the server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-12\"><span class=\"crayon-c\">      * @param origin details of the cookie origin</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-13\"><span class=\"crayon-c\">      * @ return an array of {@ code Cookie}s parsed from the header</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-14\"><span class=\"crayon-c\">      * @throws MalformedCookieException if an exception occurs during parsing</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-15\"><span class=\"crayon-c\">      */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Header </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieOrigin </span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws </span><span class=\"crayon-v\">MalformedCookieException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b72947604027-17\">……</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b72947604027-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>在源码中我们发现了一个parse方法，看注释就知道正是这个方法，将Set-Cookie的header信息解析为Cookie对象，自然地再了解一下在httplcient中的默认实现DefaultCookieSpec，限于篇幅，源码就不贴了。在默认的实现中，DefaultCookieSpec主要的工作是判断header中Cookie规范的类型，然后再调用具体的某一个实现。像上述这种Cookie，最终是交由NetscapeDraftSpec的实例来做解析，而在NetscapeDraftSpec的源码中，定义了默认的expires时间格式为“EEE, dd-MMM-yy HH:mm:ss z”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e93b96b75833538536\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class NetscapeDraftSpec extends CookieSpecBase {\r\n\r\n    protected static final String EXPIRES_PATTERN = \"EEE, dd-MMM-yy HH:mm:ss z\";\r\n\r\n    /** Default constructor */\r\n    public NetscapeDraftSpec(final String[] datepatterns) {\r\n        super(new BasicPathHandler(),\r\n                new NetscapeDomainHandler(),\r\n                new BasicSecureHandler(),\r\n                new BasicCommentHandler(),\r\n                new BasicExpiresHandler(\r\n                        datepatterns != null ? datepatterns.clone() : new String[]{EXPIRES_PATTERN}));\r\n    }\r\n\r\n    NetscapeDraftSpec(final CommonCookieAttributeHandler... handlers) {\r\n        super(handlers);\r\n    }\r\n\r\n    public NetscapeDraftSpec() {\r\n        this((String[]) null);\r\n    }\r\n……\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b75833538536-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b75833538536-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieSpecBase</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-2\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EXPIRES_PATTERN</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"EEE, dd-MMM-yy HH:mm:ss z\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-4\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Default constructor */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicPathHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDomainHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicSecureHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicCommentHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicExpiresHandler</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-12\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">EXPIRES_PATTERN</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-14\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CommonCookieAttributeHandler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handlers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">handlers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-18\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b75833538536-22\">……</div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b75833538536-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>到这里已经比较清楚了，我们只需要将Cookie中expires的时间转换为正确的格式，然后再送入默认的解析器就可以了。</p>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>自定义一个CookieSpec类，继承DefaultCookieSpec</li>\n<li>重写parser方法</li>\n<li>将Cookie中的expires转换为正确的时间格式</li>\n<li>调用默认的解析方法</li>\n</ol>\n<p>实现如下（URL就不公开了，已经隐去）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e93b96b79217798151\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class TestHttpClient {\r\n    \r\n    String url = sth;\r\n\r\n    class MyCookieSpec extends DefaultCookieSpec {\r\n        @ Override\r\n        public List parse(Header header, CookieOrigin cookieOrigin) throws MalformedCookieException {\r\n            String value = header.getValue();\r\n            String prefix = \"Expires=\";\r\n            if (value.contains(prefix)) {\r\n                String expires = value.substring(value.indexOf(prefix) + prefix.length());\r\n                expires = expires.substring(0, expires.indexOf(\";\"));\r\n                String date = DateUtils.formatDate(new Date(Long.parseLong(expires) * 1000L),\"EEE, dd-MMM-yy HH:mm:ss z\");\r\n                value = value.replaceAll(prefix + \"\\\\d{10};\", prefix + date + \";\");\r\n            }\r\n            header = new BasicHeader(header.getName(), value);\r\n            return super.parse(header, cookieOrigin);\r\n        }\r\n    }\r\n\r\n    @ Test\r\n    public void getCookie() {\r\n\r\n        CloseableHttpClient httpClient = HttpClients.createDefault();\r\n\r\n        Registry cookieSpecProviderRegistry = RegistryBuilder.create()\r\n                .register(\"myCookieSpec\", context -&gt; new MyCookieSpec()).build();//注册自定义CookieSpec\r\n\r\n        HttpClientContext context = HttpClientContext.create();\r\n        context.setCookieSpecRegistry(cookieSpecProviderRegistry);\r\n\r\n        HttpGet get = new HttpGet(url);\r\n        get.setConfig(RequestConfig.custom().setCookieSpec(\"myCookieSpec\").build());\r\n\r\n        try {\r\n            CloseableHttpResponse response = httpClient.execute(get, context);\r\n            try{\r\n                System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\");\r\n                Arrays.stream(response.getAllHeaders()).forEach(System.out::println);\r\n                System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\");\r\n                context.getCookieStore().getCookies().forEach(System.out::println);\r\n            }\r\n            finally {\r\n                response.close();\r\n            }\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }finally {\r\n            try {\r\n                httpClient.close();\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b79217798151-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b79217798151-56\">56</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TestHttpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-2\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sth</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-4\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyCookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DefaultCookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Header </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieOrigin </span><span class=\"crayon-v\">cookieOrigin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MalformedCookieException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Expires=\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">contains</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\";\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DateUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">formatDate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parseLong</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000L</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"EEE, dd-MMM-yy HH:mm:ss z\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replaceAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\\\d{10};\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\";\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">header</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookieOrigin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-20\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-22\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">CloseableHttpClient </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createDefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Registry </span><span class=\"crayon-v\">cookieSpecProviderRegistry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RegistryBuilder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"myCookieSpec\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyCookieSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//注册自定义CookieSpec</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-28\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">HttpClientContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientContext</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setCookieSpecRegistry</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cookieSpecProviderRegistry</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">HttpGet </span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpGet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RequestConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">custom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setCookieSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"myCookieSpec\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-34\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">CloseableHttpResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-39\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAllHeaders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookieStore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookies</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-50\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b79217798151-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b79217798151-56\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0109 seconds] -->\r\n<p>再次运行，顺利地打印出正确的结果，完美！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e93b96b7e875015308\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nDate: Tue, 12 Sep 2017 07:24:10 GMT\r\nContent-Type: text/html\r\nConnection: keep-alive\r\nSet-Cookie: yd_cookie=9f521fc5-0248-4ab3ee650ca50b1c7abb1cd2526b830e620f; Expires=1505208250; Path=/; HttpOnly\r\nCache-Control: no-cache, no-store\r\nServer: WAF/2.4-12.1\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:\r\n[version: 0][name: yd_cookie][value: 9f521fc5-0248-4ab3ee650ca50b1c7abb1cd2526b830e620f][domain: www.sth.com][path: /][expiry: Tue Sep 12 17:24:10 CST 2017]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b7e875015308-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b7e875015308-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b7e875015308-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b7e875015308-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b7e875015308-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b7e875015308-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b7e875015308-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e93b96b7e875015308-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e93b96b7e875015308-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e93b96b7e875015308-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b7e875015308-2\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b7e875015308-3\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b7e875015308-4\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">alive</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b7e875015308-5\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9f521fc5</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0248</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4ab3ee650ca50b1c7abb1cd2526b830e620f</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Expires</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1505208250</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpOnly</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b7e875015308-6\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">store</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b7e875015308-7\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WAF</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2.4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e93b96b7e875015308-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59c2e93b96b7e875015308-9\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9f521fc5</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0248</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4ab3ee650ca50b1c7abb1cd2526b830e620f</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expiry</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">CST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>本文也发我的个人博客：<a href=\"http://www.fullstackyang.com/archives/416.html\">fullstackyang</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112469\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112469votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112469\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">\r\n\t\t\t<img src=\"http://tp2.sinaimg.cn/2233098320/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            会当凌绝顶，一览众山小——全栈之路        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2653yy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2653yy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 3</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.fullstackyang.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2653yy\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/400ad67cf4361f1937db9bb746d2b7f0b34d3af6.jpg"}
{"url_object_id": "cfaf090cb48b0f211a6912344d6ea9b9", "title": "基于 Redis 实现分布式应用限流", "url": "http://blog.jobbole.com/112381/", "create_date": "2017/09/07", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": "2", "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/giegie/blog/1525931\">冷冷gg</a>   </div><p>限流的目的是通过对并发访问/请求进行限速或者一个时间窗口内的的请求进行限速来保护系统，一旦达到限制速率则可以拒绝服务。</p>\n<p>前几天在DD的公众号，看了一篇关于使用 瓜娃 实现单应用限流的方案，参考《redis in action》 实现了一个jedis版本的，都属于业务层次限制。 实际场景中常用的限流策略：</p>\n<ul>\n<li>Nginx接入层限流<br>\n按照一定的规则如帐号、IP、系统调用逻辑等在Nginx层面做限流</li>\n<li>业务应用系统限流<br>\n通过业务代码控制流量这个流量可以被称为信号量，可以理解成是一种锁，它可以限制一项资源最多能同时被多少进程访问。</li>\n</ul>\n<h3>代码实现</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2f3210609d705714315\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport redis.clients.jedis.Jedis;\r\nimport redis.clients.jedis.Transaction;\r\nimport redis.clients.jedis.ZParams;\r\n\r\nimport java.util.List;\r\nimport java.util.UUID;\r\n\r\n/**\r\n * email wangiegie@gmail.com\r\n * @data 2017-08\r\n */\r\npublic class RedisRateLimiter {\r\n    private static final String BUCKET = \"BUCKET\";\r\n    private static final String BUCKET_COUNT = \"BUCKET_COUNT\";\r\n    private static final String BUCKET_MONITOR = \"BUCKET_MONITOR\";\r\n\r\n    static String acquireTokenFromBucket(\r\n            Jedis jedis, int limit, long timeout) {\r\n        String identifier = UUID.randomUUID().toString();\r\n        long now = System.currentTimeMillis();\r\n        Transaction transaction = jedis.multi();\r\n\r\n        //删除信号量\r\n        transaction.zremrangeByScore(BUCKET_MONITOR.getBytes(), \"-inf\".getBytes(), String.valueOf(now - timeout).getBytes());\r\n        ZParams params = new ZParams();\r\n        params.weightsByDouble(1.0,0.0);\r\n        transaction.zinterstore(BUCKET, params, BUCKET, BUCKET_MONITOR);\r\n\r\n        //计数器自增\r\n        transaction.incr(BUCKET_COUNT);\r\n        List&lt;Object&gt; results = transaction.exec();\r\n        long counter = (Long) results.get(results.size() - 1);\r\n\r\n        transaction = jedis.multi();\r\n        transaction.zadd(BUCKET_MONITOR, now, identifier);\r\n        transaction.zadd(BUCKET, counter, identifier);\r\n        transaction.zrank(BUCKET, identifier);\r\n        results = transaction.exec();\r\n        //获取排名，判断请求是否取得了信号量\r\n        long rank = (Long) results.get(results.size() - 1);\r\n        if (rank &lt; limit) {\r\n            return identifier;\r\n        } else {//没有获取到信号量，清理之前放入redis 中垃圾数据\r\n            transaction = jedis.multi();\r\n            transaction.zrem(BUCKET_MONITOR, identifier);\r\n            transaction.zrem(BUCKET, identifier);\r\n            transaction.exec();\r\n        }\r\n        return null;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f3210609d705714315-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59c2f3210609d705714315-51\">51</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Jedis</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Transaction</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ZParams</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-4\"> </div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-8\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-9\"><span class=\"crayon-c\"> * email wangiegie@gmail.com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-10\"><span class=\"crayon-c\"> * @data 2017-08</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-11\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-12\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisRateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET_COUNT\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET_MONITOR\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-16\"> </div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">randomUUID</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Transaction </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-22\"> </div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//删除信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zremrangeByScore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-inf\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ZParams </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZParams</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weightsByDouble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zinterstore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-28\"> </div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//计数器自增</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">incr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_COUNT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Object</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//获取排名，判断请求是否取得了信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-c\">//没有获取到信号量，清理之前放入redis 中垃圾数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f3210609d705714315-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2f3210609d705714315-51\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0092 seconds] -->\r\n<p></p>\n<h3>调用</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2f321060a9367155704\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n测试接口调用\r\n@GetMapping(\"/\")\r\npublic void index(HttpServletResponse response) throws IOException {\r\n    Jedis jedis = jedisPool.getResource();\r\n    String token = RedisRateLimiter.acquireTokenFromBucket(jedis, LIMIT, TIMEOUT);\r\n    if (token == null) {\r\n        response.sendError(500);\r\n    }else{\r\n        //TODO 你的业务逻辑\r\n    }\r\n    jedisPool.returnResource(jedis);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2f321060a9367155704-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060a9367155704-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060a9367155704-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060a9367155704-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060a9367155704-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060a9367155704-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060a9367155704-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060a9367155704-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060a9367155704-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060a9367155704-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060a9367155704-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060a9367155704-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060a9367155704-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2f321060a9367155704-1\">测试接口调用</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060a9367155704-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">GetMapping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060a9367155704-3\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060a9367155704-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060a9367155704-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisRateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LIMIT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TIMEOUT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060a9367155704-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060a9367155704-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060a9367155704-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060a9367155704-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//TODO 你的业务逻辑</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060a9367155704-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060a9367155704-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">returnResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060a9367155704-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060a9367155704-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p></p>\n<h2>优化</h2>\n<p>使用拦截器 + 注解优化代码</p>\n<h3>拦截器</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2f321060ad388185836\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@Configuration\r\nstatic class WebMvcConfigurer extends WebMvcConfigurerAdapter {\r\n    private Logger logger = LoggerFactory.getLogger(WebMvcConfigurer.class);\r\n    @Autowired\r\n    private JedisPool jedisPool;\r\n\r\n    public void addInterceptors(InterceptorRegistry registry) {\r\n        registry.addInterceptor(new HandlerInterceptorAdapter() {\r\n            public boolean preHandle(HttpServletRequest request, HttpServletResponse response,\r\n                                     Object handler) throws Exception {\r\n                HandlerMethod handlerMethod = (HandlerMethod) handler;\r\n                Method method = handlerMethod.getMethod();\r\n                RateLimiter rateLimiter = method.getAnnotation(RateLimiter.class);\r\n\r\n                if (rateLimiter != null){\r\n                    int limit = rateLimiter.limit();\r\n                    int timeout = rateLimiter.timeout();\r\n                    Jedis jedis = jedisPool.getResource();\r\n                    String token = RedisRateLimiter.acquireTokenFromBucket(jedis, limit, timeout);\r\n                    if (token == null) {\r\n                        response.sendError(500);\r\n                        return false;\r\n                    }\r\n                    logger.debug(\"token -&gt; {}\",token);\r\n                    jedis.close();\r\n                }\r\n                return true;\r\n            }\r\n        }).addPathPatterns(\"/*\");\r\n    }\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060ad388185836-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060ad388185836-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Configuration</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-2\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebMvcConfigurer</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebMvcConfigurerAdapter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Logger </span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LoggerFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">WebMvcConfigurer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Autowired</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-6\"> </div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addInterceptors</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">InterceptorRegistry </span><span class=\"crayon-v\">registry</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">registry</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addInterceptor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HandlerInterceptorAdapter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preHandle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletRequest </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-10\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">HandlerMethod </span><span class=\"crayon-v\">handlerMethod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HandlerMethod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Method </span><span class=\"crayon-v\">method</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handlerMethod</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getMethod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">RateLimiter </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">method</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAnnotation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-14\"> </div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-16\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-17\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-18\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-19\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisRateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-20\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-21\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-22\"><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-23\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-24\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"token -&gt; {}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-25\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-26\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addPathPatterns</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/*\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060ad388185836-31\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060ad388185836-32\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p></p>\n<h3>定义注解</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2f321060b2736472414\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/**\r\n * email wangiegie@gmail.com\r\n * @data 2017-08\r\n * 限流注解\r\n */\r\n\r\n@Target(ElementType.METHOD)\r\n@Retention(RetentionPolicy.RUNTIME)\r\n@Documented\r\npublic @interface RateLimiter {\r\n    int limit() default 5;\r\n    int timeout() default 1000;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b2736472414-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b2736472414-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b2736472414-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b2736472414-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b2736472414-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b2736472414-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b2736472414-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b2736472414-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b2736472414-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b2736472414-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b2736472414-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b2736472414-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b2736472414-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b2736472414-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2f321060b2736472414-1\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b2736472414-2\"><span class=\"crayon-c\"> * email wangiegie@gmail.com</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060b2736472414-3\"><span class=\"crayon-c\"> * @data 2017-08</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b2736472414-4\"><span class=\"crayon-c\"> * 限流注解</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060b2736472414-5\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b2736472414-6\"> </div><div class=\"crayon-line\" id=\"crayon-59c2f321060b2736472414-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Target</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ElementType</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">METHOD</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b2736472414-8\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Retention</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RetentionPolicy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RUNTIME</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060b2736472414-9\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Documented</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b2736472414-10\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060b2736472414-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b2736472414-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060b2736472414-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b2736472414-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h3>使用</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2f321060b5081839790\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@RateLimiter(limit = 2, timeout = 5000)\r\n@GetMapping(\"/test\")\r\npublic void test() {\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b5081839790-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b5081839790-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b5081839790-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f321060b5081839790-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2f321060b5081839790-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2f321060b5081839790-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">RateLimiter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b5081839790-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">GetMapping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/test\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060b5081839790-3\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f321060b5081839790-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2f321060b5081839790-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h2>并发测试</h2>\n<p>工具：apache-jmeter-3.2<br>\n说明： 没有获取到信号量的接口返回500，status是红色，获取到信号量的接口返回200，status是绿色。<br>\n当限制请求信号量为2，并发5个线程： <img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/88fe4ce72def9cd9bcb4ddcc1185200e.png\" alt=\"image\"><br>\n当限制请求信号量为5，并发10个线程：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d92c4624c99f43a7093aa4fe92b7a112.png\" alt=\"image\"></p>\n<h2>资料</h2>\n<p><a href=\"https://github.com/tangaiyun/RedisRateLimiter\">基于reids + lua的实现</a></p>\n<h2>总结</h2>\n<ol>\n<li>对于信号量的操作，使用事务操作。</li>\n<li>不要使用时间戳作为信号量的排序分数，因为在分布式环境中，各个节点的时间差的原因，会出现不公平信号量的现象。</li>\n<li>可以使用把这块代码抽成@rateLimiter注解，然后再方法上使用就会很方便啦</li>\n<li>不同接口的流控，可以参考源码的里面RedisRateLimiterPlus,无非是每个接口生成一个监控参数</li>\n<li>源码<a href=\"http://git.oschina.net/boding1/pig-cloud\">http://git.oschina.net/boding1/pig-cloud</a></li>\n</ol>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112381\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112381votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112381\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"}
{"url_object_id": "7070d04f4a541626ef95b5e9985670fc", "title": "C# 最佳工具集合： IDE 、分析、自动化工具等", "url": "http://blog.jobbole.com/112411/", "create_date": "2017/09/11", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/08/297e7ca127d2eef674c119331fe30dff1.jpg"], "praise_nums": "2", "comment_nums": "1", "fav_nums": "4", "tags": "工具与资源", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/tdfblog/p/best-csharp-tools.html\">Sweet-Tang</a>   </div><p>C#是企业中广泛使用的编程语言，特别是那些依赖微软的程序语言。如果您使用C#构建应用程序，则最有可能使用Visual Studio，并且已经寻找了一些扩展来对您的开发进行管理。但是，这个工具列表可能会改变您编写C#代码的方式。</p>\n<h1 id=\"c编程的最佳工具有以下几类\">C#编程的最佳工具有以下几类：</h1>\n<ul>\n<li><a href=\"#IDEs\">IDE</a></li>\n<li><a href=\"#Extensions\">VS扩展</a></li>\n<li><a href=\"#Compilers\">编译器、编辑器和序列化</a></li>\n<li><a href=\"#Decompilers\">反编译和代码转换工具</a></li>\n<li><a href=\"#Automation\">构建自动化和合并工具</a></li>\n<li><a href=\"#VersionControl\">版本控制</a></li>\n<li><a href=\"#Testing\">测试工具和VS扩展</a></li>\n<li><a href=\"#Profilers\">性能分析</a></li>\n<li><a href=\"#APM\">APM</a></li>\n<li><a href=\"#Deployment\">部署自动化</a></li>\n<li><a href=\"#Containerization\">容器</a></li>\n</ul>\n<p>使用上面的链接直接跳转到特定工具，或继续阅读以浏览完整列表。</p>\n<h1>IDE</h1>\n<h2 id=\"visual-studio-code\">1. <a href=\"https://code.visualstudio.com/\">Visual Studio Code</a></h2>\n<h2><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/ab7cd9d2dc2e1643611ad6d6dc17a94b.jpg\"><img class=\"aligncenter size-full wp-image-112412\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ab7cd9d2dc2e1643611ad6d6dc17a94b.jpg\" alt=\"162090-20170910205052272-559220882\"></a></h2>\n<p>Visual Studio Code是C#开发人员最受欢迎的代码编辑器。您可以使用Visual Studio Code与C#扩展功能实现强大的编辑功能，并完全支持C# IntelliSense和调试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>优秀的自动完成与上下文感知提示</li>\n<li>内置Git集成，实现更好的版本控制</li>\n<li>大量的扩展进一步增强平台</li>\n</ul>\n<h2 id=\"monodevelop\">2. <a href=\"http://www.monodevelop.com/\">MonoDevelop</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/cdbf06f5a31bed35d6e8e99501364c76.jpg\"><img class=\"aligncenter size-full wp-image-112413\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/cdbf06f5a31bed35d6e8e99501364c76.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由Xamarin开发，MonoDevelop具有许多与VS Code相似的功能，也是跨平台的。使用MonoDevelop，您可以在Windows，Linux和Mac OS X上快速编写桌面和Web应用程序。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>标准功能，如代码提示和调试</li>\n<li>还配有<a href=\"https://unity3d.com/\">Unity</a>，一个游戏引擎，可以为视频游戏等应用程序实现高级C#编程</li>\n<li>支持C#代码提示</li>\n<li>代码模板和代码折叠</li>\n<li>多语言支持</li>\n</ul>\n<h2 id=\"sharpdevelop\">3. <a href=\"http://www.icsharpcode.net/\">SharpDevelop</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/56e59653b98d56cb5a410d98cb7bedf7.jpg\"><img class=\"aligncenter size-full wp-image-112414\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/56e59653b98d56cb5a410d98cb7bedf7.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个用于C#、VB.net和Boo项目的免费开源IDE，#develop（SharpDevelop）是VS Code的轻量级替代品。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>Visual Studio提供的通常功能，包括代码编辑，编译和调试</li>\n<li>一些高级功能包括上下文操作和后台语法检查</li>\n</ul>\n<h2 id=\"rider\">4. <a href=\"https://www.jetbrains.com/rider/\">Rider</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/9d3f920744876bd8d1a24134838ba714.jpg\"><img class=\"aligncenter size-full wp-image-112415\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9d3f920744876bd8d1a24134838ba714.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Jet Brains产品套件中一个成员，Rider是基于IntelliJ平台和ReSharper的跨平台.NET IDE。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>与其他JetBrains产品无缝集成</li>\n<li>2000多种代码检查</li>\n<li>上下文操作</li>\n<li>支持Unity游戏引擎</li>\n<li>支持.NET Framework和.NET Core</li>\n</ul>\n<h1 id=\"visual-studio-扩展\">Visual Studio 扩展</h1>\n<h2 id=\"productivity-power-tools-2017\">5. <a href=\"https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.ProductivityPowerPack2017\">Productivity Power Tools 2017</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6ea07eb5999a3e0136e07a09f122f49.jpg\"><img class=\"aligncenter size-full wp-image-112416\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6ea07eb5999a3e0136e07a09f122f49.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由Microsoft提供，这是一个很好的扩展，以加快Visual Studio的开发。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>中间点击滚动</li>\n<li>快速查找</li>\n<li>解决方案错误可视化</li>\n<li>直观的界面</li>\n<li>其它版本可用于旧版Visual Studio版本</li>\n</ul>\n<h2 id=\"jquery-code-snippets\">6. <a href=\"https://github.com/kspearrin/Visual-Studio-jQuery-Code-Snippets\">jQuery Code Snippets</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/3e8c0688d1b43afcb054ae41872c6ed4.jpg\"><img class=\"aligncenter size-full wp-image-112417\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3e8c0688d1b43afcb054ae41872c6ed4.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>简化jQuery框架编码，jQuery Code Snippets为Visual Studio 2012，2013，2015和2017提供了超过130个代码段。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>130多种jQuery代码片段</li>\n<li>支持所有版本的Visual Studio</li>\n<li>对于那些刚入门jQuery开发人员来说非常棒，可以使用这个扩展来学习jQuery的门道</li>\n</ul>\n<h2 id=\"codemaid\">7. <a href=\"http://www.codemaid.net/\">CodeMaid</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/2864e73047c391392c93c64b6f0e91cd.jpg\"><img class=\"aligncenter size-full wp-image-112418\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2864e73047c391392c93c64b6f0e91cd.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>CodeMaid是一个开源的VS扩展，可以帮助您清理和简化除C#之外各种支持语言的代码。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>从代码中删除不必要的字符，如空格</li>\n<li>代码整理</li>\n<li>使用树型结构视图轻松浏览代码</li>\n<li>支持多种语言</li>\n<li>注释格式</li>\n</ul>\n<h2 id=\"refactoring-essentials\">8. <a href=\"http://vsrefactoringessentials.com/\">Refactoring Essentials</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/9c0f0877240c4e938221ed3b681237e4.jpg\"><img class=\"aligncenter size-full wp-image-112419\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9c0f0877240c4e938221ed3b681237e4.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>使用Refactoring Essentials，一个具有内置的C#和VB代码转换器的VS扩展，使您的C#代码更容易阅读和修复常见错误。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>修复常见的错字和编码错误</li>\n<li>在代码库中找到每种不匹配的样式</li>\n<li>开源代码，您可以扩展或改进它</li>\n</ul>\n<h1 id=\"编译器编辑器和序列化\">编译器、编辑器和序列化</h1>\n<h3 id=\"slickedit\">9. <a href=\"https://www.slickedit.com/\">SlickEdit</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/a1333c638778be745f8795863f76f2b9.jpg\"><img class=\"aligncenter size-full wp-image-112420\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a1333c638778be745f8795863f76f2b9.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SlickEdit是一个代码编辑工具，可以提高生产力并提高代码质量。它是一个跨平台的代码编辑器，可在九个平台上支持超过60种语言（包括C#）。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>编译并调试您的代码，显示所有错误以便行快速访问</li>\n<li>可以处理非常大的代码文件，大到2TB</li>\n<li>语法扩展和缩进</li>\n<li>按键模拟</li>\n<li>备份历史记录</li>\n<li>多个光标和选择</li>\n<li>标准和专业版可用于满足您的需求</li>\n</ul>\n<h2 id=\"rextester\">10. <a href=\"http://rextester.com/\">Rextester</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/aa72d6d1d2d6d850b8bc04e757da51dc.jpg\"><img class=\"aligncenter size-full wp-image-112421\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/aa72d6d1d2d6d850b8bc04e757da51dc.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Rextester（代表正则表达式测试器）是C#的简单在线编译器。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>每段代码运行CPU时间最多为5秒</li>\n<li>每段代码最多可以占用150MB内存</li>\n<li>代码在应用程序域中运行，具有基本的执行、反射、线程控制和web权限</li>\n</ul>\n<h2 id=\"c-pad\">11. <a href=\"https://csharppad.com/\">C# Pad</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/4fac2d2f11390ea2e6dd24c61717f926.jpg\"><img class=\"aligncenter size-full wp-image-112422\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4fac2d2f11390ea2e6dd24c61717f926.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C# Pad是C#的一个方便的REPL工具。使用起来很简单：输入代码，点击“Go”执行。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在线快速测试C#代码</li>\n<li>包括代码自动完成</li>\n<li>可嵌入其它网站</li>\n</ul>\n<h2 id=\"jdoodle\">12. <a href=\"https://www.jdoodle.com/\">Jdoodle</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/085e042ba82da71329d3f2acc3a697b8.jpg\"><img class=\"aligncenter size-full wp-image-112423\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/085e042ba82da71329d3f2acc3a697b8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>另一个轻量级代码编译器，Jdoodle支持63种语言（包括C#），并允许您保存程序并与其他人共享URL。您可以将Jdoodle中创建的代码嵌入到您的网站，用于协作，在线访问等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在线快速测试一小段代码，而无需打开IDE</li>\n<li>轻松地与他人分享您的代码</li>\n<li>API即将推出</li>\n</ul>\n<h2 id=\"net-fiddle\">13. <a href=\"https://dotnetfiddle.net/\">.NET Fiddle</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/c1c4f3caf8dc79a543e7fc07eb0431b9.jpg\"><img class=\"aligncenter size-full wp-image-112424\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c1c4f3caf8dc79a543e7fc07eb0431b9.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C#的一个流行的调试工具，.NET Fiddle的灵感来自于JSFiddle.net，旨在快速，简单的代码测试，而无需打开Visual Studio并创建一个新的项目。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>让您编写，保存和协作C#代码</li>\n<li>支持4种项目类型：控制台，Script，MVC，Nancy</li>\n<li>还支持VB.NET和F＃</li>\n</ul>\n<h2 id=\"telerik-fiddler\">14. <a href=\"http://www.telerik.com/fiddler\">Telerik Fiddler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/1ba1c74d48a3197be5ea9a54663bf102.jpg\"><img class=\"aligncenter size-full wp-image-112425\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1ba1c74d48a3197be5ea9a54663bf102.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Telerik Fiddler允许您在线执行代码。它提供了一系列功能，包括Web调试、Web会话操作、性能测试、安全测试等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>运行一系列测试，如性能测试、Web调试和安全测试</li>\n<li>FiddlerCore可让您将Fiddler应用程序嵌入到您自己的应用程序中，以便您可以避免整个Fiddler UI，还可以获得Fiddler的所有功能</li>\n</ul>\n<h2 id=\"json.net\">15. <a href=\"http://www.newtonsoft.com/json\">Json.NET</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/00105e5bd3b3bcdbfe502aaacf9526dc.jpg\"><img class=\"aligncenter size-full wp-image-112426\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/00105e5bd3b3bcdbfe502aaacf9526dc.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Json.NET是一个流行的JSON框架。使用它，您可以在任何地方（Windows，Windows Store，Windows Phone，Mono和Xamarin）运行它时，创建、解析、查询和修改JSON，在XML和JSON之间进行转换。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>对.NET对象进行序列化和反序列化</li>\n<li>查询JSON数据库</li>\n<li>使用JObject，JArray和JValue对象创建、解析、查询和修改JSON</li>\n<li>开源</li>\n</ul>\n<h2 id=\"scriptcs\">16. <a href=\"http://scriptcs.net/\">Scriptcs</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb23c062ff12d10ad60fb4e3e65407be.jpg\"><img class=\"aligncenter size-full wp-image-112427\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb23c062ff12d10ad60fb4e3e65407be.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个简单的在线编辑器，编写和执行C#代码，Scriptcs被设计为非常简单，以避免使用过于复杂的工具和解决方案阻碍您的工作效率。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>避免完整IDE的臃肿</li>\n<li>为您提供简单的C#编码任务的灵活性和速度</li>\n<li>管理与NuGet的依赖关系</li>\n<li>优雅的C#脚本语法</li>\n</ul>\n<h1 id=\"反编译和代码转换工具\">反编译和代码转换工具</h1>\n<h2 id=\"dotpeek\">17. <a href=\"https://www.jetbrains.com/decompiler/\">dotPeek</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/5d1169da0b608f78a20702bff1909a77.jpg\"><img class=\"aligncenter size-full wp-image-112428\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5d1169da0b608f78a20702bff1909a77.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>dotPeek允许您将.NET程序集反编译为C#。dotBeek是JetBrains提供的免费独立工具，基于ReSharper捆绑的反编译器。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>强大的搜索和导航功能</li>\n<li>将任何.NET程序集解码为等效的C#或IL代码</li>\n<li>支持多种格式（.dll、.exe、.winmd）</li>\n<li>将反编译的程序集保存为Visual Studio项目</li>\n</ul>\n<h2 id=\"ilspy\">18. <a href=\"http://ilspy.net/\">ILspy</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b14c6254b53a1eef405a965f7e857a35.jpg\"><img class=\"aligncenter size-full wp-image-112429\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b14c6254b53a1eef405a965f7e857a35.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>基于Red Gate的.NET Reflector开源反编译器，在2011年停止维护，ILspy需要.NET Framework 4.0。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>浏览程序集并将其反编译为C#</li>\n<li>将程序集保存为C#项目</li>\n<li>直观的搜索和导航功能</li>\n<li>导航历史</li>\n<li>支持C#5.0 “async”</li>\n<li>反编译为VB和C#</li>\n</ul>\n<h2 id=\"justdecompile\">19. <a href=\"http://www.telerik.com/products/decompiler.aspx\">JustDecompile</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d93095d5cb7fe7a91e8e683a757068d8.jpg\"><img class=\"aligncenter size-full wp-image-112430\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d93095d5cb7fe7a91e8e683a757068d8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个来自Telerik的反编译器，JustDecompile是一个免费的开源反编译引擎。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>可扩展的开放API</li>\n<li>快速代码导航</li>\n<li>轻松地在标签页中切换方法和程序集</li>\n<li>在加载程序集中使用书签</li>\n<li>从反编译的程序集创建一个Visual Studio项目</li>\n<li>Visual Studio扩展在VS项目中进行反编译</li>\n</ul>\n<h2 id=\"telerik-code-converter\">20. <a href=\"http://converter.telerik.com/\">Telerik Code Converter</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/55f1c5759c01a823a8cd152e67e9fa28.jpg\"><img class=\"aligncenter size-full wp-image-112431\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/55f1c5759c01a823a8cd152e67e9fa28.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Telerik代码转换器将VB代码转换为C#，反之亦然。一个简单而强大的工具，Telerik代码转换器易于使用，具有直观的界面。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>基于云的转换，快速和轻松的</li>\n<li>使用NRefactory库进行复杂的代码转换</li>\n<li>使用ASP.NET AJAX的Telerik UI</li>\n</ul>\n<h1 id=\"构建自动化和合并工具\">构建自动化和合并工具</h1>\n<h3 id=\"cake-build\">21. <a href=\"http://cakebuild.net/\">Cake Build</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/710b109b667b0a2a4c754815d85c73b8.jpg\"><img class=\"aligncenter size-full wp-image-112432\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/710b109b667b0a2a4c754815d85c73b8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Cake（C#Make）是C#版的开源Make Build自动化工具。一个跨平台构建自动化系统，Cake使用C# DSL来编写代码，运行单元测试，复制文件和文件夹，压缩文件和构建NuGet软件包等任务。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在Windows，Linux和OS X上可用</li>\n<li>建立与其他CI系统相同的方式</li>\n<li>支持构建工具，包括MSBuild，MSTest，xUnit，NUnit，NuGet，ILMerge，WiX和SignTool</li>\n<li>高可扩展</li>\n</ul>\n<h2 id=\"msbuild\">22. <a href=\"https://www.visualstudio.com/en-us/docs/build/steps/build/msbuild\">MSBuild</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/dc18c33a85da75cdb5e9e497dfc15020.jpg\"><img class=\"aligncenter size-full wp-image-112433\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/dc18c33a85da75cdb5e9e497dfc15020.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>MSBuild是由Microsoft于2008年推出的。它不是Visual Studio平台的一部分，但它是您的C#开发工具包的一个很好的资源，例如在您构建代码项目时，除了解决方案之外。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>来自微软，它被许多MS商店广泛使用</li>\n<li>微软把它放到了Visual Studio中确保它不会成单独存</li>\n<li>构建多个项目</li>\n<li>构建Win32，x86，x64或任何cpu平台</li>\n<li>为多个平台构建多个配置</li>\n</ul>\n<h2 id=\"finalbuilder\">23. <a href=\"https://www.finalbuilder.com/finalbuilder\">FinalBuilder</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/76cc136d56bf28d5f660a00e8dd0f20c.jpg\"><img class=\"aligncenter size-full wp-image-112434\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/76cc136d56bf28d5f660a00e8dd0f20c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>FinalBuilder是构建自动化工具的一个很好的商业选择。使用FinalBuilder，您不需要编辑XML或编写脚本来自动完成构建过程。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>通过包括可视化调试，使构建变得容易</li>\n<li>可视地定义和调试构建脚本</li>\n<li>使用Windows调度程序安排脚本</li>\n<li>与Continua CI，Jenkins或任何其它CI服务器集成</li>\n</ul>\n<h2 id=\"semanticmerge\">24. <a href=\"http://www.semanticmerge.com/\">SemanticMerge</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/27c5f88a28199621439e8d5f121cf978.jpg\"><img class=\"aligncenter size-full wp-image-112435\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/27c5f88a28199621439e8d5f121cf978.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SemanticMerge分析您的代码，旨在处理已被移动或修改的代码，使其成为团队协作的强大工具。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>实现协作和分布式开发</li>\n<li>从结构合并开始，然后在发生冲突时移动到更具体的基于文本的合并</li>\n<li>基于结构而不是位置合并</li>\n<li>处理特定于语言的冲突</li>\n<li>避免错误地识别自动合并</li>\n<li>保持清洁的代码并分析更改</li>\n</ul>\n<h1 id=\"版本控制\">版本控制</h1>\n<h2 id=\"git\">25. <a href=\"https://git-scm.com/\">Git</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/2ebd63d78a68b858493da22210f0a2bb.jpg\"><img class=\"aligncenter size-full wp-image-112436\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2ebd63d78a68b858493da22210f0a2bb.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Git就不需要介绍了。这是一个免费的开源版本控制系统，也是当今最流行的版本控制系统。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>现代版本控制工具，适用于当今地理位置分布的团队</li>\n<li>包括强大的默认值，用于解决冲突，自动恢复等</li>\n<li>便宜的本地分支</li>\n<li>方便的暂存区</li>\n<li>多个工作流程</li>\n</ul>\n<h2 id=\"team-foundation-version-control\">26. <a href=\"https://www.visualstudio.com/team-services/tfvc/\">Team Foundation Version Control</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/328f6f58124bcf89625bc7bc2aa43639.jpg\"><img class=\"aligncenter size-full wp-image-112437\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/328f6f58124bcf89625bc7bc2aa43639.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>TFS版本控制是Microsoft替代Git的一种，它集成到Visual Studio中。它是企业准备的，所以对于使用VS项目的任何规模的团队来说，这是一个不错的选择。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>利用Visual Studio功能提供本地体验</li>\n<li>跟踪分支机构的代码更改</li>\n<li>在代码签入之前提供反馈</li>\n<li>集成最流行的CI和自动化构建工具</li>\n</ul>\n<h2 id=\"bitbucket\">27. <a href=\"https://bitbucket.org/\">BitBucket</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/83bb4073ba4ba43ec8f09f7221898316.jpg\"><img class=\"aligncenter size-full wp-image-112438\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/83bb4073ba4ba43ec8f09f7221898316.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>BitBucket是Jira的Git替代品，也是一个有能力的版本控制工具——“唯一一个大规模的协作的Git解决方案。”</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使用内联注释选项更快地协作</li>\n<li>由于代码是开源的，还是让Jira为您管理代码</li>\n<li>拉请求允许更有效的代码审查批准</li>\n<li>使用BitBucket数据中心进行不间断的访问</li>\n<li>无限私有存储库</li>\n</ul>\n<h2 id=\"sourcetree\">28. <a href=\"https://www.sourcetreeapp.com/\">SourceTree</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/6dbc13b3a314cec4fe0c7366d37abb2c.jpg\"><img class=\"aligncenter size-full wp-image-112439\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6dbc13b3a314cec4fe0c7366d37abb2c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SourceTree是另一个Jira产品，一个用于Windows和Mac的免费Git客户端，具有简单的Git GUI来管理您的仓库。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>支持Windows和Mac</li>\n<li>与您的存储库进行视觉交互</li>\n<li>简化分布式版本控制</li>\n<li>对初学者来说足够简单 足够强大的专家</li>\n</ul>\n<h1 id=\"测试工具和vs扩展\">测试工具和VS扩展</h1>\n<h3 id=\"linqpad\">29. <a href=\"http://www.linqpad.net/\">LINQPad</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/8b84ef5c25005a19e0d25f7e19706ac6.jpg\"><img class=\"aligncenter size-full wp-image-112440\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8b84ef5c25005a19e0d25f7e19706ac6.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个用于即时测试C#，F#和VB中的代码片段的工具，LINQPad可以让您以交互方式查询数据库。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>有自己的查询语言 – LINQ，这是一个强大的查询数据库的方法</li>\n<li>非常适合学习C#，因为它为您提供了IDE的许多功能，而不臃肿</li>\n<li>在LINQ（或SQL） – SQL/CE/Azure、Oracle、SQLite和MySQL中查询数据库</li>\n<li>丰富的输出格式</li>\n<li>脚本并以您首选的.NET语言自动化</li>\n</ul>\n<h2 id=\"selenium\">30. <a href=\"http://www.seleniumhq.org/\">Selenium</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/30d2148445af4f7ae6568772fc5ccae8.jpg\"><img class=\"aligncenter size-full wp-image-112441\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/30d2148445af4f7ae6568772fc5ccae8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Selenium是目前最流行的测试工具之一。它可以自动化Web浏览器，以便您可以在规模和精度上运行测试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>自动化的基于Web的管理任务</li>\n<li>创建强大的回归自动化套件和测试</li>\n<li>跨环境和脚本分发</li>\n<li>构建您自己的Selenium服务器或使用供应商提供的托管选项</li>\n</ul>\n<h2 id=\"resharper\">31. <a href=\"https://www.jetbrains.com/resharper/\">ReSharper</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/e0d310155483608ebc407ab9a28c6fda.jpg\"><img class=\"aligncenter size-full wp-image-112442\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e0d310155483608ebc407ab9a28c6fda.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由JetBrains创建的，ReSharper是.NET开发人员的Visual Studio扩展。使用它来即时分析代码质量，消除错误，安全地更改代码库等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供即时代码分析</li>\n<li>快速修复错误</li>\n<li>帮助复杂重构</li>\n<li>多个代码编辑助手</li>\n</ul>\n<h2 id=\"ozcode\">32. <a href=\"https://oz-code.com/\">OzCode</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/5aad95b7d82740b30d92429af2aa9bcb.jpg\"><img class=\"aligncenter size-full wp-image-112443\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5aad95b7d82740b30d92429af2aa9bcb.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>OzCode是C#的Visual Studio扩展，提供强大的调试工具，因此您可以花更多的时间开发和更少的时间调试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使Visual Studio中更容易找到并修复错误</li>\n<li>与ReSharper合作</li>\n<li>用Magic Glance来绘制出复杂的表达式</li>\n<li>强大的搜索，显示和比较功能</li>\n</ul>\n<h2 id=\"coderush\">33. <a href=\"https://www.devexpress.com/products/coderush/\">CodeRush</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/afb8749eb07de32dd5886f8121b86baf.jpg\"><img class=\"aligncenter size-full wp-image-112444\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/afb8749eb07de32dd5886f8121b86baf.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>CodeRush可以帮助您轻松找到并修复问题，像本节中的其它测试工具一样，是一个VS扩展。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>视觉突出显示代码库中的问题，并帮助您快速发现问题</li>\n<li>快速创建新的测试和测试套件与快捷方式</li>\n<li>容易重构</li>\n</ul>\n<h1 id=\"性能分析\">性能分析</h1>\n<h3 id=\"prefix\">34. <a href=\"https://stackify.com/prefix/\">Prefix</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/03b06f5d1cb589306d5795789ad8d54d.png\"><img class=\"aligncenter size-full wp-image-112445\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/03b06f5d1cb589306d5795789ad8d54d.png\" alt=\"162090-20170910211007866-1263253556\"></a></p>\n<p>一个用于.NET和Java的轻量级开发工具，Prefix会实时显示日志、错误、查询等。它可以在您现有的工作站内使用 – 它是免费的。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供每个Web请求的详细跟踪</li>\n<li>没有凌乱的配置或代码更改</li>\n<li>立即下载; 立即获得代码分析结果</li>\n<li>按要求查看日志</li>\n<li>查找隐藏的异常</li>\n<li>查看SQL查询</li>\n<li>快速找出可疑行为</li>\n</ul>\n<h2 id=\"dottrace\">35. <a href=\"https://www.jetbrains.com/profiler/\">dotTrace</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d305e83fd3ff97da47bbcbd688abb102.jpg\"><img class=\"aligncenter size-full wp-image-112446\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d305e83fd3ff97da47bbcbd688abb102.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>来自JetBrains，dotTrace是一个分析器，可帮助排除性能问题并加快应用程序的速度。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>了解SQL查询和HTTP请求如何影响应用程序性能</li>\n<li>查看逐行剖析数据并获取特定的绩效指标</li>\n<li>获取调用执行时间的数据</li>\n<li>配置文件SQL查询和HTTP请求</li>\n<li>简介静态方法和单元测试</li>\n<li>在Visual Studio中配置和可视化结果</li>\n</ul>\n<h2 id=\"ants-performance-profiler\">36. <a href=\"https://www.red-gate.com/products/dotnet-development/ants-performance-profiler/\">ANTS Performance Profiler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/421d2c22e18956d4c7d759d2189ddb2a.jpg\"><img class=\"aligncenter size-full wp-image-112447\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/421d2c22e18956d4c7d759d2189ddb2a.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>ANTS性能分析器是.NET代码的分析工具，包括提供逐行分析统计信息。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>查看SQL查询和HTTP请求的性能数据</li>\n<li>提供逐行结果</li>\n<li>显示历史性的表现</li>\n<li>深入了解长期分析结果</li>\n</ul>\n<h2 id=\"n-profiler\">37.<a href=\"https://www.nprofiler.com/\">N Profiler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/193d29df37f2c0a6de25bb5f83b8c30c.jpg\"><img class=\"aligncenter size-full wp-image-112448\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/193d29df37f2c0a6de25bb5f83b8c30c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个分析工具声称比任何其培训分析器更快，N Profiler提供丰富的.NET性能数据，可以节省90%的优化时间。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>了解性能问题的真实原因 – 数据库查询或I/O时间</li>\n<li>性能指标组织在调用树中，可以在概述或细节级别查看</li>\n</ul>\n<h1 id=\"apm\">APM</h1>\n<h2 id=\"retrace\">38. <a href=\"https://stackify.com/retrace/\">Retrace</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/54b4463f786af4d51a64b9624ce703e3.png\"><img class=\"aligncenter size-full wp-image-112450\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/54b4463f786af4d51a64b9624ce703e3.png\" alt=\"162090-20170910211007866-1263253556\"></a></p>\n<p>Retrace是唯一将APM、日志、错误、指标和监控结合在一个平台上的开发者工具，可帮助您更好地构建。它专为生产和预生产服务器而设计，每月只需10美元。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在代码级收集性能数据</li>\n<li>应用程序和服务器记录</li>\n<li>各种来源的应用指标</li>\n<li>错误跟踪和监控</li>\n<li>与现有堆栈一起工作</li>\n<li>免费试用</li>\n</ul>\n<h1 id=\"部署自动化\">部署自动化</h1>\n<h2 id=\"octopus\">39. <a href=\"https://octopus.com/\">Octopus</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/1143dc56d334c82c08d0e6e076190eb0.jpg\"><img class=\"aligncenter size-full wp-image-112451\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1143dc56d334c82c08d0e6e076190eb0.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C#主要部署自动化工具，这使得自动化复杂的应用程序部署成为可能。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供和配置新机器来部署您的应用程序</li>\n<li>与CI服务器集成，将构建自动化和CI进程扩展到部署中</li>\n<li>精简各环境之间的版本</li>\n<li>可重复，可靠的部署</li>\n</ul>\n<h2 id=\"appveyor\">40. <a href=\"https://www.appveyor.com/\">Appveyor</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/541566723eb5308d235dcfc63e057987.jpg\"><img class=\"aligncenter size-full wp-image-112452\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/541566723eb5308d235dcfc63e057987.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个CI构建服务器，不仅可以处理构建，而且还可以进行部署，Appveyor非常强大，安全，并且无需设置即可开始使用。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>用于构建，测试和部署端到端解决方案</li>\n<li>易于使用，无需设置</li>\n<li>隔离构建环境</li>\n<li>使用UI或YAML的开发人员友好的构建配置</li>\n<li>内置部署和NuGet服务器</li>\n<li>多分支构建</li>\n</ul>\n<h2 id=\"appharbor\">41.<a href=\"https://appharbor.com/\">AppHarbor</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/38343a06fc098841a183e68f8dc5c71e.jpg\"><img class=\"aligncenter size-full wp-image-112453\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/38343a06fc098841a183e68f8dc5c71e.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>AppHarbor不仅仅是部署：它是一个完全托管的.NET 平台服务。它用于托管从个人博客到高流量网络应用程序的所有内容。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>从源代码存储库获取代码，并将其部署在自己的托管平台上</li>\n<li>使用您最喜欢的版本控制工具即时部署和扩展.NET应用程序</li>\n<li>不用担心扩展您的基础架构来跟上负载，AppHarbor会为您处理这一切</li>\n</ul>\n<h2 id=\"jenkins\">42. <a href=\"https://jenkins.io/\">Jenkins</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/74f7d0aa59c2d8ac0aad93e8ef7cfe4a.jpg\"><img class=\"aligncenter size-full wp-image-112454\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/74f7d0aa59c2d8ac0aad93e8ef7cfe4a.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Jenkins不仅仅是部署自动化工具，也是最受欢迎的CI服务器，它将其覆盖面扩展到部署和交付阶段。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>丰富的收集扩展，以适应每个堆栈</li>\n<li>从构建到部署的端到端解决方案</li>\n<li>数以百计的插件来支持构建，部署和自动化</li>\n</ul>\n<h1 id=\"容器\">容器</h1>\n<h2 id=\"docker.dotnet\">43. <a href=\"https://www.nuget.org/packages/Docker.DotNet/\">Docker.DotNet</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/15f470b4e14bc30557d58f71c8372b3f.jpg\"><img class=\"aligncenter size-full wp-image-112458\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/15f470b4e14bc30557d58f71c8372b3f.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Docker.DotNet是Docker API的C#客户端库。通过它，您可以通过编程方式与Docker Remote API进行交互。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>可以通过Visual Studio的NuGet库管理器进行安装</li>\n<li>在.NET中启用完全异步，非阻塞，面向对象的代码</li>\n</ul>\n<h2 id=\"distelli\">44. <a href=\"https://www.distelli.com/\">Distelli</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/34cc483c247ca99f52ba7cb37d0c2f07.jpg\"><img class=\"aligncenter size-full wp-image-112459\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/34cc483c247ca99f52ba7cb37d0c2f07.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个强大的工具来集中化C#应用程序，Distelli帮助您从头到尾自动化您的容器工作流程。有关如何使用Distelli构建和部署C#应用程序，请参阅<a href=\"https://www.distelli.com/docs/tutorials/build-and-deploy-c-sharp-application/\">此有用的教程</a> 。本教程提供了构建和部署Docker C#应用程序的分步说明。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使用Distelli自动化您的容器工作流端到端</li>\n<li>部署到Kubernetes，用于最先进的容器编排</li>\n</ul>\n<p>C#和.NET Core 将在2018年及以后的得到巨大的发展，磨练C#技能将在未来几年内为您服务。我们希望您已经找到了一两种可以使用的工具，并提高了C#开发的质量和生产力。如果有什么工具我们遗漏了，请告诉我们，这个工具应该在这个工具包中有一席之地。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112411\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112411votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112411\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/3a56199c6566a8aab31f53637473d3ac298f003f.jpg"}
{"url_object_id": "d4fbf46a6293738d6c74397edc88e231", "title": "自上而下，逐步揭开 PHP 解析大整数的面纱", "url": "http://blog.jobbole.com/112486/", "create_date": "2017/09/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/81fddcca1b7455ef27983ecf42a8502b.jpg"], "praise_nums": "1", "comment_nums": "2", "fav_nums": 0, "tags": "PHP", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hector\">hoohack</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>浮点数精度丢失是一个长久的问题，PHP中精度丢失并不是PHP的bug，是计算机表示范围导致的问题。精度，这个问题的原因看起来不太重要，虽然学这个对于实际上的业务开发也没什么用，不会让你的开发能力“duang”地一下上去几个level，但是了解了PHP对于大整数的处理，也是自己知识框架的一个小小积累。</p>\n<h2 id=\"遇到的问题\">遇到的问题</h2>\n<p>最近遇到一个PHP大整数的问题，问题代码是这样的</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f53211673913\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$shopId = 17978812896666957068;\r\nvar_dump($shopId);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f53211673913-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f53211673913-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f53211673913-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17978812896666957068</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f53211673913-2\"><span class=\"crayon-e\">var_dump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上面的代码输出，会把$shopId转换成float类型，且使用了科学计数法来表示，输出如下：</p>\n<blockquote><p>float(1.7978812896667E+19)</p></blockquote>\n<p>但在程序里需要的是完整的数字作为查找数据的参数，所以需要用的是完整的数字，当时以为只是因为数据被转换成科学计数法了，于是想到的解决方案是强制让它不使用科学计数法表示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f5d067774540\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$shopId= number_format(17978812896666957068);\r\nvar_dump($shopId);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f5d067774540-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f5d067774540-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f5d067774540-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">number_format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">17978812896666957068</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f5d067774540-2\"><span class=\"crayon-e\">var_dump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这时候奇怪的事情出现了，输出的是：</p>\n<blockquote><p>17978812896666957824</p></blockquote>\n<p>当时没有仔细看，对比了前十位就没有继续往下看，所以认为问题解决了，等到真正根据ID去找数据的时候才发现数据查不出来，这时候才发现是数据转换错误了。</p>\n<p>这里使用number_format失败的原因在后面会讲到，当时就想到将原来的数据转成字符串的，但是使用了以下方法仍然不行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f61843389362\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$shopId= strval(17978812896666957068);\r\nvar_dump($shopId);\r\n\r\n$shopId = 17978812896666957068 . '';\r\nvar_dump($shopId);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f61843389362-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f61843389362-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f61843389362-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f61843389362-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f61843389362-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f61843389362-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">17978812896666957068</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f61843389362-2\"><span class=\"crayon-e\">var_dump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9b480f61843389362-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f61843389362-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17978812896666957068</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9b480f61843389362-5\"><span class=\"crayon-e\">var_dump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>输出的结果都是</p>\n<blockquote><p>float(1.7978812896667E+19)</p></blockquote>\n<p>最后只有下面这种方案是可行的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f65549547053\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$shopId = '17978812896666957068';\r\nvar_dump($shopId);\r\n\r\n// 输出\r\n// string(20) \"17978812896666957068\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f65549547053-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f65549547053-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f65549547053-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f65549547053-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f65549547053-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f65549547053-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'17978812896666957068'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f65549547053-2\"><span class=\"crayon-e\">var_dump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">shopId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9b480f65549547053-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f65549547053-4\"><span class=\"crayon-c\">// 输出</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9b480f65549547053-5\"><span class=\"crayon-c\">// string(20) \"17978812896666957068\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>众所周知，PHP是一门解释型语言，所以当时就大胆地猜测PHP是在编译期间就将数字的字面量常量转换成float类型，并用科学计数法表示。但仅仅猜测不能满足自己的好奇心，想要看到真正实现代码才愿意相信。于是就逐步分析、探索，直到找到背后的实现。</p>\n<p>刚开始根据这个问题直接上网搜“PHP大整数解析过程”，并没有搜到答案，因此只能自己去追查。一开始对PHP的执行过程不熟悉，出发点就只能是一步一步地调试，然后</p>\n<p>示例代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f6a116704352\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// test.php\r\n$var = 17978812896666957068;\r\nvar_dump($var);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f6a116704352-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f6a116704352-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f6a116704352-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f6a116704352-1\"><span class=\"crayon-c\">// test.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f6a116704352-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17978812896666957068</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9b480f6a116704352-3\"><span class=\"crayon-e\">var_dump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">var</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"追查过程\">追查过程</h2>\n<p>1、查看opcode 通过vld查看PHP执行代码的opcode，可以看到，赋值的是一个ASSIGN的opcode操作 <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%281%29.png\" alt=\"php整数01\"></p>\n<p>接下来就想看看ASSIGN是在哪里执行的。</p>\n<p>2、gdb调试 2-1、用list查看有什么地方可以进行断点 <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%282%29.png\" alt=\"php整数02\"></p>\n<p>2-2、暂时没有头绪，在1186断点试试 <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%283%29.png\" alt=\"php整数03\"></p>\n<p>结果程序走到sapi/cli/php_cli.c文件的1200行了，按n不断下一步执行，一直到这里就走到了程序输出结果了： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%284%29.png\" alt=\"php整数04\"></p>\n<p>2-4、于是可以猜测，ASSIGN操作是在do_cli函数里面进行的，因此对do_cli函数做断点：break do_cli。 输入n，不断回车，在sapi/cli/php_cli.c文件的993行之后就走到程序输出结果了： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%285%29.png\" alt=\"php整数05\"></p>\n<p>2-5、再对php_execute_script函数做断点：break php_execute_script 不断逐步执行，发现在main/main.c文件的2537行就走到程序输出结果了： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%286%29.png\" alt=\"php整数06\"></p>\n<p>2-6、继续断点的步骤：break zend_execute_scripts 重复之前的步骤，发现在zend/Zend.c文件的1476行走到了程序输出结果的步骤： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%287%29.png\" alt=\"php整数07\"></p>\n<p>看到这里的时候，第1475行里有一个op_array，就猜测会不会是在op_array的时候就已经有值了，于是开始打印op_array的值： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%288%29.png\" alt=\"php整数08\"></p>\n<p>打印之后并没有看到有用的信息，但是其实这里包含有很大的信息量，比如opcode的handler: <strong>ZEND_ASSIGN_SPEC_CV_RETVAL_CV_CONST_RETVAL_UNUSED_HANDLER</strong>，但是当时没注意到，因为就想着看看op_array是怎么被赋值的，相关步骤做了什么，忽略了这个重要的信息，之后还是会回到这个handler。</p>\n<p>2-7、重新从2-5的断点开始，让程序逐步执行，看到op_array的赋值如下： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%289%29.png\" alt=\"php整数09\"></p>\n<p>将zend_compile_file函数运行的结果赋值给op_array了，于是break zend_compile_file，被告知zend_compile_file未定义，通过源码工具追踪到zend_compile_file指向的是compile_file，于是break zend_compile</p>\n<p>发现是在Zend/zend_language_scanner.l 文件断点了，逐步执行，看到这行pass_two(op_array)，猜测可能会在这里就有值，所以打印看看： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2810%29.png\" alt=\"php整数10\"></p>\n<p>结果发现还是跟之前的一样，但是此时看到有一个opcodes的值，打印看看 <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2811%29.png\" alt=\"php整数11\"></p>\n<p><img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2812%29.png\" alt=\"php整数12\"></p>\n<p>看到opcode = 38，网上查到38代表赋值</p>\n<p><img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2813%29.png\" alt=\"php整数13\"></p>\n<p>2-8、于是可以知道，在这一步之前就已得到了ASSIGN的opcode，因此，不断的往前找，从op_array开始初始化时就开始，逐步打印op_array-&gt;opcodes的值，一直都是null： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2814%29.png\" alt=\"php整数14\"></p>\n<p>直到执行了CG(zend_lineno) = last_lineno;才得到opcode = 38 的值： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2815%29.png\" alt=\"php整数15\"></p>\n<p>因为这一句：CG(zend_lineno) = last_lineno;是一个宏，所以也没头绪，接近放弃状态。。。</p>\n<p>于是先去了解opcode的数据结构，在<a href=\"http://www.php-internals.com/book/\">深入理解PHP内核</a>书里找到opcode处理函数查找这一章，给了我一些继续下去的思路。</p>\n<p>引用里面的内容： 在PHP内部有一个函数用来快速的返回特定opcode对应的opcode处理函数指针：zend_vm_get_opcode_handler()函数： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2816%29.png\" alt=\"php整数16\"></p>\n<p>知道其实opcode处理函数的命名是有以下规律的</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f71081445912\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nZEND_[opcode]_SPEC_(变量类型1)_(变量类型2)_HANDLER</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f71081445912-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f71081445912-1\"><span class=\"crayon-v\">ZEND_</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">opcode</span><span class=\"crayon-sy\">]</span><span class=\"crayon-e\">_SPEC_</span><span class=\"crayon-sy\">(</span>变量类型<span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">_</span><span class=\"crayon-sy\">(</span>变量类型<span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">_HANDLER</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>根据之前调试打印出来的内容，在2-6的时候就看到了一个handler的值： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2817%29.png\" alt=\"php整数17\"></p>\n<p>是 <strong>ZEND_ASSIGN_SPEC_CV_CONST_RETVAL_UNUSED_HANDLER</strong>，</p>\n<p>找出函数的定义如下： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2818%29.png\" alt=\"php整数18\"></p>\n<p>可以看到，opcode操作的时候，值是从EX_CONSTANT获取的，根据定义展开这个宏，那就是</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f77872111174\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nopline-&gt;op2-&gt;execute_data-&gt;literals</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f77872111174-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f77872111174-1\"><span class=\"crayon-v\">opline</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">op2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">execute_data</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">literals</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这里可以得到两个信息： 1、参数的转换在opcode执行前就做好了 2、赋值过程取值时是在op2-&gt;execute_data-&gt;literals，如果猜想没错的话，op2-&gt;execute_data-&gt;literals此时保存的就是格式转换后的值，可以打印出来验证一下</p>\n<p>打印结果如下： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2819%29.png\" alt=\"php整数19\"></p>\n<p>猜想验证正确，但是没有看到真正做转换的地方，还是不死心，继续找PHP的Zend底层做编译的逻辑代码。</p>\n<p>参考开源的<a href=\"https://github.com/pangudashu/php7-internal\">GitHub项目</a>，PHP编译阶段如下图： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2820%29.png\" alt=\"php整数20\"></p>\n<p>猜测最有可能的是在zendparse、zend_compile_top_stmt这两个阶段完成转换，因为这个两个阶段做的事情就是将PHP代码转换成opcode数组。</p>\n<p>上网搜索了PHP语法分析相关的文章，有一篇里面讲到了解析整数的过程，因此找到了PHP真正将大整数做转换的地方：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f7b914584451\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{LNUM} {\r\n    char *end;\r\nif (yyleng</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f7b914584451-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f7b914584451-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f7b914584451-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f7b914584451-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">LNUM</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f7b914584451-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e9b480f7b914584451-3\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">yyleng</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>可以看到，zend引擎在对PHP代码在对纯数字的表达式做词法分析的时候，先判断数字是否有可能会溢出，如果有可能溢出，先尝试将其用LONG类型保存，如果溢出，先用zend_strtod将其转换为double类型，然后用double类型的zval结构体保存之。</p>\n<h2 id=\"number_format失败的原因\">number_format失败的原因</h2>\n<p>通过gdb调试，追查到number_format函数，在PHP底层最终会调用php_conv_fp函数对数字进行转换： <img src=\"http://7u2eqw.com1.z0.glb.clouddn.com/PHP%E5%A4%A7%E6%95%B4%E6%95%B0%20%2821%29.png\" alt=\"php整数21\"></p>\n<p>函数原型如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f7e707697388\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPHPAPI char * php_conv_fp(register char format, register double num, boolean_e add_dp, int precision, char dec_point, bool_int * is_negative, char *buf, size_t *len);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f7e707697388-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f7e707697388-1\"><span class=\"crayon-e\">PHPAPI </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">php_conv_fp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">register </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">register </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">boolean_e </span><span class=\"crayon-v\">add_dp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">precision</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dec_point</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">bool_int *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_negative</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">size_t *</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这里接收的参数num是一个double类型，因此，如果传入的是字符串类型数字的话，number_format函数也会将其转成double类型传入到php_conf_fp函数里。而这个double类型的num最终之所以输出为17978812896666957824，是因为进行科学计数法之后的精度丢失了，重新转成double时就恢复不了原来的值。在C语言下验证：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f84195309308\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndouble local_dval = 1.7978812896666958E+19;\r\nprintf(\"%f\\n\", local_dval);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f84195309308-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e9b480f84195309308-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f84195309308-1\"><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_dval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.7978812896666958E</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">19</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e9b480f84195309308-2\"><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%f\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_dval</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输出的结果就是</p>\n<blockquote><p>17978812896666957824.000000</p></blockquote>\n<p>所以，这不是PHP的bug，它就是这样的。</p>\n<h2 id=\"此类问题解决方案\">此类问题解决方案</h2>\n<p>对于存储，超过PHP最大表示范围的纯整数，在MySQL中可以使用bigint/varchar保存，MySQL在查询出来的时候会将其使用string类型保存的。 对于赋值，在PHP里，如果遇到有大整数需要赋值的话，不要尝试用整型类型去赋值，比如，不要用以下这种：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f87387430297\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$var = 17978812896666957068;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f87387430297-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f87387430297-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17978812896666957068</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>而用这种：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e9b480f8a368139265\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$var = '17978812896666957068';</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e9b480f8a368139265-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e9b480f8a368139265-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'17978812896666957068'</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>而对于number_format，在64位操作系统下，它能解析的精度不会丢失的数，建议的最大值是这个：9007199254740991。参考鸟哥博客：<a href=\"http://www.laruence.com/2011/12/19/2399.html\">关于PHP浮点数你应该知道的</a></p>\n<h2 id=\"总结\">总结</h2>\n<p>这个问题的原因看起来不太重要，虽然学这个对于实际上的业务开发也没什么用，不会让你的开发能力“duang”地一下上去几个level，但是了解了PHP对于大整数的处理，也是自己知识框架的一个小小积累，知道了为什么之后，在日常开发中就会多加注意，比如从存储以及使用赋值的角度。了解这个细节还是很有好处的。</p>\n<p>回想整个解决问题的过程，个人感觉有点长，总共大约花了4个小时去定位这个问题。因为对PHP的内核只是一知半解，没有系统的把整个流程梳理下来，所以一开始也不知道从哪里开始下手，就开始根据自己的猜测来调试。现在回想起来，应该先学习PHP的编译、执行流程，然后再去猜测具体的步骤。</p>\n<p>原创文章，文笔有限，才疏学浅，文中若有不正之处，万望告知。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/7aa70eaa311d5a5dec82ca0d49624741.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/1a4b335ec981d013f4002205a23fedd0.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112486\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112486votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112486\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hector\">hoohack</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hector\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/df22a501f19a5bba1b3331e2001f8ec2.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个正在努力的菜鸟        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hector\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hector/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hector/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 27</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.hoohack.me\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/2388493434?is_all=1\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：914099943\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：hhq8307231\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/hoohack\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/fb5bc7aed8de99098d0e143ff7711b56f8cdae71.jpg"}
{"url_object_id": "3c3be9710ad6349b4226b28187cac799", "title": "Linux 大爆炸：一个内核，无数发行版", "url": "http://blog.jobbole.com/112517/", "create_date": "2017/09/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/08/2e327580770370cc02c696e176d4cb77.jpg"], "praise_nums": "1", "comment_nums": "1", "fav_nums": 0, "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxinsider.com/story/84489.html\">Jonathan Terrasi</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8628-1.html\">Linux中国/geekpi</a>   </div><p>即使你是一个 Linux 新人，你可能也已经知道它不是一个单一的、整体的操作系统，而是一群项目。这个星座中不同的“星”组成了“发行版”。每个都提供了自己的 Linux 模式。</p>\n<p>感谢这一系列发行版所提供的多种选择，这有助于了解 Linux 如何开始并随后激增的。因此，这里会简要介绍一下 Linux 的历史。</p>\n<h3 id=\"toc_1\">Linus Torvalds，内核构建者</h3>\n<p>大多数熟悉 Linux 的人都已经听说过它的创建者 Linus Torvalds （题图中的人），但是并不知道他最初为何创建它。在 1991 年，Torvalds 还是一名在芬兰学习计算机的大学生。作为一个独立的个人项目，他希望为他的独特硬件创建一个类 Unix 内核。</p>\n<p>“内核”是操作系统的一部分，它介乎于操作系统和硬件之间，通过其固件进行协调。本质上，它是系统的核心。开发内核不是一个小工程，但是 Torvalds 渴望挑战，并且发现他自己有这个罕见的技能。</p>\n<p>由于他刚接触内核，他希望得到其他人的帮助来确保他走在正确的轨道上，因此他通过在早期的互联网论坛 Usenet 发布他的内核代码，并征求了老牌的老手的经验。然后贡献者就涌来了。</p>\n<p>在建立了一个对论坛提交的补丁进行审查以及选择性地集成它们的流程后，Torvalds 意识到他聚集起了一个非正式的团队。在项目发展之后，它很快成为了一个比较正式的开发团队。</p>\n<h3 id=\"toc_2\">Richard Stallman 的角色</h3>\n<p>虽然 Torvalds 以及他的团建创造了 Linux 内核，但是没有 Richard Stallman 的工作也不会有随后 Linux 众多发行版的传播，Richard 在十年之前发起了一个自由软件运动。</p>\n<p>受到许多核心 Unix 程序和系统功能缺乏透明度的阻挠，Stallman 决定自己编写一个，与任何想要它的人自由共享源代码，并且开放提交。他创造了许多核心程序的主体，并在 1983 年发布，统称为 “GNU 项目”。</p>\n<p>没有它们，内核不会有那么多的用量。基于 Linux 的操作系统的早期设计人员很乐意将 GNU 工具集成到他们的项目中。</p>\n<p>不同的团队开始出现 – 每个团队都有自己的计算功能和架构的理念。他们将 Linux 内核、GNU 实用程序和他们自己的原始软件结合在一起，然而“发行”了 Linux 操作系统的变体。</p>\n<h3 id=\"toc_3\">服务器发行版</h3>\n<p>每个发行版有它自己的设计逻辑和目的，但是要了解它们的细微差别，需要了解上游和下游开发人员之间的区别。“上游开发人员”负责实际创建项目并发布，以供个人下载或将其包含在其他项目中。相比之下，“下游开发人员”或“软件包维护人员”是指每个发布上游程序的人员，他们对每个上游程序的版本进行调整以适应下游项目的使用情况。</p>\n<p>虽然大多数 Linux 发行版包含一些（自己的）原生项目，但大部分发行版开发主要是对 Linux 内核、GNU 工具和庞大的用户程序生态系统的“下游”工作。</p>\n<p>许多发行通过优化特定使用场景来彰显它们的特征。例如，某些项目被设计作为服务器运行。为部署服务器而量身定制的发行版通常会避开上游项目中快速推出的最新功能，而倾向于发布一个经过彻底测试的、基础的基本软件，系统管理员可以依靠它来顺利运行。</p>\n<p>针对服务器的发行版的的开发团队经常很大，并且有富有经验的程序员可以为每个版本提供多年的支持。</p>\n<h3 id=\"toc_4\">桌面发行版</h3>\n<p>也有很多的发行版针对桌面用户。事实上，一些知名的发行版通过提供简单的安装以及直观的界面来与商业的操作系统竞争。这些发行版通常包含了大量的软件仓库，它包含了用户可以想到的每个软件，这样用户可以定制它们自己的系统。</p>\n<p>由于可用性是关键，他们可能会投入部门大量的员工来创建一个特征鲜明的、发行版特定的桌面，或调整已有的桌面以适应其设计理念。以用户为中心的发行版往往会加快其下游开发时间表，有助于及时为用户提供新功能。</p>\n<p>“滚动发布”项目，这是一种桌面发行版的子集，其被设计成紧跟潮流。滚动发布项目的包维护人员在为每个上游程序完成调整后分别发布其新版本，而不是等待所需的上游程序的开发达到某一特定的节点，然后将其集成到单个版本中。</p>\n<p>这种方法的一个优点是安全性，因为其关键补丁的发布将比非滚动发行版更快。另一个好处是新功能立即可用，不然用户需要等待才行。滚动发布的缺点是需要更多的人工干预和仔细维护，因为某些升级可能会与其他升级相冲突从而破坏系统。</p>\n<h3 id=\"toc_5\">嵌入式系统</h3>\n<p>另外一个 Linux 发行版类别是“嵌入式系统”，它被极致裁剪（相对与服务器和桌面发行版）来适应特定的使用情况。</p>\n<p>我们经常会忘记那些连接到因特网的任何东西，或者比一个简单的计算器复杂的东西，都是计算机。而计算机需要操作系统。因为 Linux 是自由的并且高度模块化，所以它通常是硬件厂商的选择。</p>\n<p>在大多数情况下，如果你看见一台智能电视、一台连接互联网的照相机、甚至是一辆车，你看到的都是 Linux 设备。特别是每部非 iPhone 的智能手机都运行着不同的嵌入式 Linux。</p>\n<h3 id=\"toc_6\">Linux 现场版</h3>\n<p>最后，有一些 Linux 发行版并不需要永久性地安装在计算机中，而是驻留在 USB 记忆棒上，并允许在其它的计算机上启动它们，而无需计算机硬盘。</p>\n<p>这些 “现场版（live）” 的系统可以被优化来执行一些任务。从修复损坏的系统到进行安全评估到高度安全地浏览因特网。</p>\n<p>由于这些 现场版 Linux 发行版通常针对解决特定的问题，因此它们一般都包含特定的工具，像磁盘分析和恢复程序、网络监控程序和加密工具。它们还占用很小的空间，因此它们可以快速启动。</p>\n<h3 id=\"toc_7\">你如何选择？</h3>\n<p>这绝不是 Linux 发行版类型的全面列表，但它应该可以让你大致了解 Linux 生态系统的范围和多样化了。</p>\n<p>在每个类别下都有许多选择，因此你会如何选择一个最能符合你需求的版本呢？</p>\n<p>一种方式是试验。在 Linux 社区中，来回尝试不同的发行版，或者为用户根据他们的需求在不同的机器上运行不同的发行版，这都很常见。</p>\n<p>在将来的文章中，我会展示每种类型发行版的几个例子，以便你可以自己尝试，并开始探索最喜欢的发行版的旅程。</p>\n<hr>\n<p>作者简介：</p>\n<p>自 2017 年以来 Jonathan Terrasi 一直是 ECT 新闻网的专栏作家。他的主要兴趣是计算机安全（特别是 Linux 桌面），加密和分析政治和时事。他是全职自由作家和音乐家。他的背景包括在芝加哥委员会发表的保卫人权法案文章中提供技术评论和分析。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112517\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112517votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112517\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/dd1cc9aabc819ded578b6acfe94b7f995ee5ea2d.jpg"}
{"url_object_id": "96e68d41a1e51a9614a929fce93c1d53", "title": "100:10:1方法 : 我是这样参与开源的", "url": "http://blog.jobbole.com/112320/", "create_date": "2017/09/08", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/f1a3d556b79a7fae23ad3ecc6f972164.jpg"], "praise_nums": "2", "comment_nums": "1", "fav_nums": "4", "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q1857502771\">暖日生烟</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://blog.fogus.me/2015/11/04/the-100101-method-my-approach-to-open-source/\">Michael Fogus</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：据本文作者 Michael Fogus 博客上的简介，他是一位 Clojure 开发者和狂热用户，并且是 Clojure 的贡献者（Clojure 本身也是一个开源项目）。平常在 Clojure 和 ClojureScript 花费时间很多。他喜欢棒球、象棋、哲学、恐怖电影、阅读和写作。出过两本书《Functional JavaScript》和《The joy of Clojure》。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjbxewni6rj206y06ymx6.jpg\" width=\"250\" height=\"250\"></p>\n<hr>\n<p>许多年里我一直全心投入于开源运动，不过那时候我很少在空闲时写代码，在 Sourceforge、GoogleCode、GitHub 之类的代码托管平台，也找不到我的项目（repo）。<sup>【1】</sup>然而随着时间流逝，我逐渐意识到向全球公开代码的责任，毫不夸张的说，这吸引住了我。</p>\n<p>除了很多“已发布”的代码是低水准的这一事实之外，无论<a href=\"https://en.wikipedia.org/wiki/Authorial_intent\">有意</a>与<a href=\"https://en.wikipedia.org/wiki/Reader-response_criticism\">否</a>，将代码公布于众的行为意味着与某些人签订契约<sup>【2】</sup>，这些人可以为自己的目的使用公开的代码。当然，我并不一定反对这种社会契约，相反，在发布代码的时候我最终改变了主意，以致于我在我的方法中变得更保守了。这个我现在正在使用的方法叫做“100:10:1 方法”，此术语是由开发者 Nick Bentley 创造。<sup>【3】</sup></p>\n<h3>100:10:1 方法究竟是什么？</h3>\n<p>我不会重复赘述此方法的细节，你可以通过阅读 《<a href=\"https://nickbentleygames.wordpress.com/2014/05/12/the-100-10-1-method-for-game-design/\" target=\"_blank\">The 100:10:1 method – the heart of my game design process</a>》来了解。但我会试着从我的开源软件开发方法这一背景下来概括它。</p>\n<p>具体操作分三部分，步骤如下：</p>\n<h3>写下 100 种疯狂的想法</h3>\n<p>首先，准备一本笔记本和一支笔，为开发有意思的开源项目写下 100 种想法即可。这些有关项目的想法可以涉及各种主题，深度和质量。我想过的有，野生语言的创意、已有项目的新功能、系统设计、协议、缺损文件、有趣的 forks、代码简化、游戏、原型、论文想法的实现、第二个系统等等。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/a17d6bb7gy1fisza9ufvoj208c03b3yl.jpg\"></p>\n<p>在使用 100:10:1 方法之前，我总是会用疯狂的想法填满我的笔记本。它们通常是东一点西一点，从不会聚集在一个地方。在几页纸上写下这 100个想法后，我的注意力立马集中在它们身上。这样我就可以好好筛选比较为第二步做准备。</p>\n<h3><span id=\"pos_placeholder\" style=\"width: 0px; height: 0px; margin: 0px; padding: 0px;\"></span>为这 10 个想法创造最小可行性产品（MVP）</h3>\n<p>我面前的这 100 个想法，让我了解到我不止当时对追求它们充满兴趣，并且我感觉它们可以使我和他人同时获益。<sup>【4】</sup>从原始的 100 个想法里，我挑出了确定想探索和专研下去的 10 个。在这 10 个项目里，我挑不出一个更好的了，因此我想同时为它们各自编写一个最小可行“项目”。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/a17d6bb7gy1fisza9oxcdj208c04pjrl.jpg\" width=\"300\" height=\"169\"></p>\n<p>你可能马上会想到同时开发 10 个项目这件事本身就是一个负担。这不能说是一个错误的评估。然而，我意识到对于我选择的大多数项目，要找到最可行的实现方式是非常难的，如果有也得耗费几个月甚至数年时间。你看，我曾一度认为发布开源软件是把潜在可用的工具给予他人的一种方法。很遗憾的是，随着时间推移，这个观点已经退化到能做到将代码公开就不错了。我现在的想法是，在业余时间写代码仅仅是一个探索，有没有结果也无所谓了。</p>\n<p>同时开发 10 个项目有个好处就是，当我在一个上遇到了瓶颈可以轻易的转移到另一个更有灵感的项目去。作为一个除编程外拥有丰富爱好、社区和家庭生活的人，用一堆选择来对抗我的三分钟热度无疑是非常有用的。拥有 10 个并行的项目意味着总有一个能让我在短时间内感兴趣。我知道当所有兴趣集中在一个任务上时，工作会变的更有效率。无论怎样最后总有一个项目会见到希望<sup>【5】</sup>，当它到来时我已经准备好了进入最后一个阶段。</p>\n<h3>全力开发选中的项目，使其成为一个可以合法发布的软件</h3>\n<p>在开发 10 个项目的过程中，其中一个不可避免会成为有价值的东西。<sup>【6】</sup>万事俱备后，我会将其变为一个高质量的软件产品。<sup>【7】</sup>这意味着要完成所有内容，确保一个健壮的系统，有可靠的例子、测试、文档、稳定的API、博客文章或演讲，甚至可能有网络。<sup>【8】</sup></p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/a17d6bb7gy1fiszaa656cj206004c3yj.jpg\" width=\"216\" height=\"156\"></p>\n<p>在此之前为了我自己而开发的项目，可能要经历大量的工作才能使其成为值得与他人分享的东西。这当然取决于软件本身的复杂度，很可能最后一步要花最长的时间来完成。同样最后阶段也是我最容易彻底放弃的时候。因为我发现了一个大麻烦，如果我不愿为我的代码写文档、例子和测试的话，在未来的数十年想要维护它是根本不可能的。</p>\n<h3>总结</h3>\n<p>这个方法我已经用了一段时间，在此之前，使用类似的方法同样取得了不错的成果。Zeder 和 Patagonia 也是用 100:10:1 方法或类似方法进行开发的。我现在有的一个叫 Tathata 的 Clojure 库，即将进入最后阶段。或许 10 个项目<sup>【9】</sup>里会有一个成功，不过即使失败了，我还会再挑选更多的 10 个去尝试。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/a17d6bb7gy1fiszaaj4n9j208c04rt9y.jpg\" width=\"300\" height=\"171\"></p>\n<p>我有足够的时间，准确的说是一辈子。:F</p>\n<p>感谢 Carin Meier、Rich Hickey、Justin Gehtland 和 Paul deGrandis 阅读，并为这篇文章提供修改意见。</p>\n<hr>\n<p>1.事实证明，我的其他爱好(游戏设计、Sabremetrics、写作等)在过去也有类似的趋势，但就像开源编码一样，它们也已经达到100:10:1的理想状态。</p>\n<p>2.不幸的是，人们似乎也倾向于将开源视为一种道德声明。</p>\n<p>3.“100:10:1 方法”这个名字来自尼克·本特利在他的一篇文章中所描述的游戏设计方法。虽然我自己对开源代码的看法已经有点类似于尼克的观点，但他的文章让我的方法有了一个名字和基本结构。无论你在哪儿，Mr. Bentley，谢谢你!</p>\n<p>4.如果我们不创建开源代码来造福他人，那又有什么意义呢？</p>\n<p>5.有时候一个项目会从根上就腐烂，在这种情况下，我会毫不犹豫的废弃它，并将其他替代品放进 100 的列表中。100 的链表是一个动态链表，所有东西可以随存随取。</p>\n<p>6.或者不一定？我担心个啥！</p>\n<p>7.当那一个已经浮出水面了，我仍然不会放弃其他 9 个，不过仅仅是在更表层，MVP 式的水平上开发。如果某个想法失败了，我还会从 100 个中挑选其他的代替。这个方法当然是没有任何硬性规定的。</p>\n<p>8.当然还有最终的名字和标志:p。</p>\n<p>9.如你所见，我将100:10:1 方法应用于其他的创造性的爱好。从编码、音乐、写作到游戏设计，它适用于任何创造性事情。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112320\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112320votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112320\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771\">暖日生烟</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/06EB1B2C5C7835017E628CFB8E25D68F/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q1857502771\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q1857502771/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"QQ：826672619\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：xzs826672619\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/NinoMiao\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/70c7b887c37d9154dc2b5636ed919464c716d375.jpg"}
{"url_object_id": "6c6b66c80fcd04dd9c516df9cd7f6eb4", "title": "微博爬虫“免登录”技巧详解及 Java 实现", "url": "http://blog.jobbole.com/112507/", "create_date": "2017/09/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/04/63b78db96b87489a5800bda3165b2689.jpg"], "praise_nums": "1", "comment_nums": "  评论", "fav_nums": "2", "tags": "开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h2>一、微博一定要登录才能抓取？</h2>\n<p>目前，对于微博的爬虫，大部分是基于模拟微博账号登录的方式实现的，这种方式如果真的运营起来，实际上是一件非常头疼痛苦的事，你可能每天都过得提心吊胆，生怕新浪爸爸把你的那些账号给封了，而且现在随着实名制的落地，获得账号的渠道估计也会变得越来越少。</p>\n<p>但是日子还得继续，在如此艰难的条件下，为了生存爬虫们必须寻求进化。好在上帝关门的同时会随手开窗，微博在其他诸如头条，一点等这类新媒体平台的冲击之下，逐步放开了信息流的查看权限。现在的微博即便在不登录的状态下，依然可以看到很多微博信息流，而我们的落脚点就在这里。</p>\n<p>作为前篇的重点内容，本文详细介绍如何获取相关的Cookie并重新封装Httpclient达到免登录的目的，以支持微博上的各项数据抓取任务。下面就从微博首页http://weibo.com开始。</p>\n<h2>二、准备工作</h2>\n<p>准备工作很简单，一个现代浏览器（你知道我为什么会写”现代”两个字），以及httpclient（我用的版本是4.5.3）</p>\n<p>跟登录爬虫一样，免登录爬虫也是需要装载Cookie。这里的Cookie是用来标明游客身份，利用这个Cookie就可以在微博平台中访问那些允许访问的内容了。</p>\n<p>这里我们可以使用浏览器的network工具来看一下，请求http://weibo.com之后服务器都返回哪些东西，当然事先清空一下浏览器的缓存。</p>\n<p>不出意外，应该可以看到下图中的内容</p>\n<p><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/network.jpg\" alt=\"\"></p>\n<p>第1次请求weibo.com的时候，其状态为302重定向，也就是说这时并没有真正地开始加载页面，而最后一个请求weibo.com的状态为200，表示了请求成功，对比两次请求的header：</p>\n<p><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/weibo_header.jpg\" alt=\"\"></p>\n<p>明显地，中间的这些过程给客户端加载了各种Cookie，从而使得可以顺利访问页面，接下来我们逐个进行分析。</p>\n<h2>三、抽丝剥茧</h2>\n<p>第2个请求是https://passport.weibo.com/visitor……，各位可以把这个url复制出来，用httpclient单独访问一下这个url，可以看到返回的是一个html页面，里面有一大段Javascript脚本，另外头部还引用一个JS文件mini_original.js，也就是第3个请求。脚本的功能比较多，就不一一叙述了，简单来说就是微博访问的入口控制，而值得我们注意的是其中的一个function：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e8f130fdb849446584\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">JavaScript</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 为用户赋予访客身份 。\r\n    var incarnate = function (tid, where, conficence) {\r\n        var gen&lt;em&gt;conf = \"\";\r\n        var from = \"weibo\";\r\n        var incarnate_intr = window.location.protocol + \"//\" + window.location.host + \"/visitor/visitor?a=incarnate&amp;t=\" + encodeURIComponent(tid) + \"&amp;w=\" + encodeURIComponent(where) + \"&amp;c=\" + encodeURIComponent(conficence) + \"&amp;gc=\" + encodeURIComponent(gen_conf) + \"&amp;cb=cross_domain&amp;from=\" + from + \"&amp;_rand=\" + Math.random();\r\n        url.l(incarnate_intr);\r\n    };&lt;/em&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fdb849446584-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fdb849446584-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fdb849446584-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fdb849446584-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fdb849446584-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fdb849446584-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fdb849446584-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e8f130fdb849446584-1\"><span class=\"crayon-c\">// 为用户赋予访客身份 。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fdb849446584-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">incarnate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">where</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">conficence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fdb849446584-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gen</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">em</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e \">conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fdb849446584-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"weibo\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fdb849446584-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">incarnate_intr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"//\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/visitor/visitor?a=incarnate&amp;t=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">encodeURIComponent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;w=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">encodeURIComponent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">where</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;c=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">encodeURIComponent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conficence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;gc=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">encodeURIComponent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gen_conf</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;cb=cross_domain&amp;from=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;_rand=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fdb849446584-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">l</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">incarnate_intr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fdb849446584-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">em</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>这里是为请求者赋予一个访客身份，而控制跳转的链接也是由一些参数拼接起来的，也就是上图中第6个请求。所以下面的工作就是获得这3个参数：tid，w（where），c（conficence，从下文来看应为confidence，大概是新浪工程师的手误）。继续阅读源码，可以看到该function是tid.get方法的回调函数，而这个tid则是定义在那个mini_original.js中的一个对象，其部分源码为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e8f130fe8742623443\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">JavaScript</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    var tid = {\r\n        key: 'tid',\r\n        value: '',\r\n        recover: 0,\r\n        confidence: '',\r\n        postInterface: postUrl,\r\n        fpCollectInterface: sendUrl,\r\n        callbackStack: [],\r\n        init: function () {\r\n            tid.get();\r\n        },\r\n        runstack: function () {\r\n            var f;\r\n            while (f = tid.callbackStack.pop()) {\r\n                f(tid.value, tid.recover, tid.confidence);//注意这里，对应上述的3个参数\r\n            }\r\n        },\r\n        get: function (callback) {\r\n            callback = callback || function () {\r\n            };\r\n            tid.callbackStack.push(callback);\r\n            if (tid.value) {\r\n                return tid.runstack();\r\n            }\r\n            Store.DB.get(tid.key, function (v) {\r\n                if (!v) {\r\n                    tid.getTidFromServer();\r\n                } else {\r\n                    ……\r\n                }\r\n            });\r\n        },\r\n    ……\r\n    }\r\n……\r\n getTidFromServer: function () {\r\n            tid.getTidFromServer = function () {\r\n            };\r\n            if (window.use&lt;em&gt;fp) {\r\n                getFp(function (data) {\r\n                    util.postData(window.location.protocol + '//' + window.location.host + '/' + tid.postInterface, \"cb=gen_callback&amp;fp=\" + encodeURIComponent(data), function (res) {\r\n                        if (res) {\r\n                            eval(res);\r\n                        }\r\n                    });\r\n                });\r\n            } else {\r\n                util.postData(window.location.protocol + '//' + window.location.host + '/' + tid.postInterface, \"cb=gen_callback\", function (res) {\r\n                    if (res) {\r\n                        eval(res);\r\n                    }\r\n                });\r\n            }\r\n        },\r\n……\r\n//获得参数\r\nwindow.gen_callback = function (fp) {\r\n        var value = false, confidence;\r\n        if (fp) {\r\n            if (fp.retcode == 20000000) {\r\n                confidence = typeof(fp.data.confidence) != 'undefined' ? '000' + fp.data.confidence : '100';\r\n                tid.recover = fp.data.new_tid ? 3 : 2;\r\n                tid.confidence = confidence = confidence.substring(confidence.length - 3);\r\n                value = fp.data.tid;\r\n                Store.DB.set(tid.key, value + '&lt;/em&gt;' + confidence);\r\n            }\r\n        }\r\n        tid.value = value;\r\n        tid.runstack();\r\n    };</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fe8742623443-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fe8742623443-70\">70</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tid'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">recover</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">confidence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">postInterface</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">postUrl</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fpCollectInterface</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sendUrl</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">callbackStack</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">init</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">runstack</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">callbackStack</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">recover</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">confidence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//注意这里，对应上述的3个参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">get</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">callback</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">callbackStack</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">callback</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">runstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Store</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DB</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-26\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-27\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getTidFromServer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-28\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-29\"><span class=\"crayon-h\">                    </span>……</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-33\"><span class=\"crayon-h\">    </span>……</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-35\">……</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-36\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">getTidFromServer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">getTidFromServer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">use</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">em</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">getFp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-41\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">postData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'//'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">postInterface</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cb=gen_callback&amp;fp=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">encodeURIComponent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-42\"><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-43\"><span class=\"crayon-h\">                            </span><span class=\"crayon-r\">eval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-44\"><span class=\"crayon-h\">                        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-45\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-46\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-48\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">postData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'//'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">postInterface</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cb=gen_callback\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-49\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-50\"><span class=\"crayon-h\">                        </span><span class=\"crayon-r\">eval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-51\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-55\">……</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-56\"><span class=\"crayon-c\">//获得参数</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-57\"><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gen_callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">confidence</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-60\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">retcode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20000000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-61\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">confidence</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">typeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">confidence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'undefined'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'000'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">confidence</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'100'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-62\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">recover</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">new</span><span class=\"crayon-sy\">_</span>tid<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-63\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">confidence</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">confidence</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">confidence</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">confidence</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-64\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">Store</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DB</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;/em&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">confidence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-66\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fe8742623443-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">runstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fe8742623443-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0129 seconds] -->\r\n<p>\n</p></div>\n<p>显然，tid.runstack()是真正执行回调函数的地方，这里就能看到传入的3个参数。在get方法中，当cookie为空时，tid会调用getTidFromServer，这时就产生了第5个请求https://passport.weibo.com/visitor/genvisitor，它需要两个参数cb和fp，其参数值可以作为常量：</p>\n<p><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/genvisitor.jpg\" alt=\"\"></p>\n<p>该请求的结果返回一串json</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e8f130fee215698761\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">JavaScript</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"msg\": \"succ\",\r\n  \"data\": {\r\n    \"new_tid\": false,\r\n    \"confidence\": 95,\r\n    \"tid\": \"kIRvLolhrCR5iSCc80tWqDYmwBvlRVlnY2+yvCQ1VVA=\"\r\n  },\r\n  \"retcode\": 20000000\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fee215698761-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fee215698761-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fee215698761-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fee215698761-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fee215698761-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fee215698761-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fee215698761-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130fee215698761-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130fee215698761-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e8f130fee215698761-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fee215698761-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"succ\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fee215698761-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"data\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fee215698761-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"new_tid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fee215698761-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"confidence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fee215698761-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"tid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"kIRvLolhrCR5iSCc80tWqDYmwBvlRVlnY2+yvCQ1VVA=\"</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fee215698761-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130fee215698761-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"retcode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20000000</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130fee215698761-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>其中就包含了tid和confidence，这个confidence，我猜大概是推测客户端是否真实的一个置信度，不一定出现，根据window.gen_callback方法，不出现时默认为100，另外当new_tid为真时参数where等于3，否则等于2。</p>\n<p>此时3个参数已经全部获得，现在就可以用httpclient发起上面第6个请求，返回得到另一串json：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e8f130ff5065619785\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">JavaScript</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"msg\": \"succ\",\r\n  \"data\": {\r\n    \"sub\": \"_2AkMu428tf8NxqwJRmPAcxWzmZYh_zQjEieKYv572JRMxHRl-yT83qnMGtRCnhyR4ezQQZQrBRO3gVMwM5ZB2hQ..\",\r\n    \"subp\": \"0033WrSXqPxfM72-Ws9jqgMF55529P9D9WWU2MgYnITksS2awP.AX-DQ\"\r\n  },\r\n  \"retcode\": 20000000\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ff5065619785-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ff5065619785-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ff5065619785-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ff5065619785-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ff5065619785-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ff5065619785-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ff5065619785-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ff5065619785-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e8f130ff5065619785-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ff5065619785-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"succ\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ff5065619785-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"data\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ff5065619785-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"sub\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"_2AkMu428tf8NxqwJRmPAcxWzmZYh_zQjEieKYv572JRMxHRl-yT83qnMGtRCnhyR4ezQQZQrBRO3gVMwM5ZB2hQ..\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ff5065619785-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"subp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0033WrSXqPxfM72-Ws9jqgMF55529P9D9WWU2MgYnITksS2awP.AX-DQ\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ff5065619785-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ff5065619785-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"retcode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ff5065619785-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<div>参考最后请求weibo.com的header，这里的sub和subp就是最终要获取的cookie值。大家或许有一个小疑问，第一个Cookie怎么来的，没用吗？是的，这个Cookie是第一次访问weibo.com产生的，经过测试可以不用装载。</div>\n<p><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/cookie-1.jpg\" alt=\"\"></p>\n<p>最后我们用上面两个Cookie装载到HttpClient中请求一次weibo.com，就可以获得完整的html页面了，下面就是见证奇迹的时刻：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e8f130ffa880815379\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">XHTML</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;!doctype html&gt;\r\n&lt;html&gt;\r\n&lt;head&gt;\r\n&lt;meta charset=\"utf-8\"&gt;\r\n&lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"&gt;\r\n&lt;meta name=\"viewport\" content=\"initial-scale=1,minimum-scale=1\" /&gt;\r\n&lt;meta content=\"随时随地发现新鲜事！微博带你欣赏世界上每一个精彩瞬间，了解每一个幕后故事。分享你想表达的，让全世界都能听到你的心声！\" name=\"description\" /&gt;\r\n&lt;link rel=\"mask-icon\" sizes=\"any\" href=\"//img.t.sinajs.cn/t6/style/images/apple/wbfont.svg\" color=\"black\" /&gt;\r\n&lt;link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"/favicon.ico\" /&gt;\r\n&lt;script type=\"text/javascript\"&gt;\r\ntry{document.execCommand(\"BackgroundImageCache\", false, true);}catch(e){}\r\n&lt;/script&gt;\r\n&lt;title&gt;微博-随时随地发现新鲜事&lt;/title&gt;\r\n&lt;link href=\"//img.t.sinajs.cn/t6/style/css/module/base/frame.css?version=6c9bf6ab3b33391f\" type=\"text/css\" rel=\"stylesheet\" charset=\"utf-8\" /&gt;\r\n&lt;link href=\"//img.t.sinajs.cn/t6/style/css/pages/growth/login_v5.css?version=6c9bf6ab3b33391f\" type=\"text/css\" rel=\"stylesheet\" charset=\"utf-8\"&gt;\r\n&lt;link href=\"//img.t.sinajs.cn/t6/skin/default/skin.css?version=6c9bf6ab3b33391f\" type=\"text/css\" rel=\"stylesheet\" id=\"skin_style\" /&gt;\r\n&lt;script type=\"text/javascript\"&gt;\r\nvar $CONFIG = {};\r\n$CONFIG['islogin'] = '0';\r\n$CONFIG['version'] = '6c9bf6ab3b33391f';\r\n$CONFIG['timeDiff'] = (new Date() - 1505746970000);\r\n$CONFIG['lang'] = 'zh-cn';\r\n$CONFIG['jsPath'] = '//js.t.sinajs.cn/t5/';\r\n$CONFIG['cssPath'] = '//img.t.sinajs.cn/t5/';\r\n$CONFIG['imgPath'] = '//img.t.sinajs.cn/t5/';\r\n$CONFIG['servertime'] = 1505746970;\r\n$CONFIG['location']='login';\r\n$CONFIG['bigpipe']='false';\r\n$CONFIG['bpType']='login';\r\n$CONFIG['mJsPath'] = ['//js{n}.t.sinajs.cn/t5/', 1, 2];\r\n$CONFIG['mCssPath'] = ['//img{n}.t.sinajs.cn/t5/', 1, 2];\r\n$CONFIG['redirect'] = '';\r\n$CONFIG['vid']='1008997495870';\r\n&lt;/script&gt;\r\n&lt;style&gt;#js_style_css_module_global_WB_outframe{height:42px;}&lt;/style&gt;\r\n&lt;/head&gt;\r\n……</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f130ffa880815379-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f130ffa880815379-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-1\"><span class=\"crayon-n\">&lt;!doctype html&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-2\"><span class=\"crayon-r \">&lt;html&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-3\"><span class=\"crayon-r \">&lt;head&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-4\"><span class=\"crayon-r \">&lt;meta </span><span class=\"crayon-e \">charset</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"utf-8\"</span><span class=\"crayon-r \">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-5\"><span class=\"crayon-r \">&lt;meta </span><span class=\"crayon-e \">http-equiv</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"X-UA-Compatible\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">content</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"IE=edge,chrome=1\"</span><span class=\"crayon-r \">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-6\"><span class=\"crayon-r \">&lt;meta </span><span class=\"crayon-e \">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"viewport\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">content</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"initial-scale=1,minimum-scale=1\"</span><span class=\"crayon-r \"> /&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-7\"><span class=\"crayon-r \">&lt;meta </span><span class=\"crayon-e \">content</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"随时随地发现新鲜事！微博带你欣赏世界上每一个精彩瞬间，了解每一个幕后故事。分享你想表达的，让全世界都能听到你的心声！\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"description\"</span><span class=\"crayon-r \"> /&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-8\"><span class=\"crayon-r \">&lt;link </span><span class=\"crayon-e \">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"mask-icon\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">sizes</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"any\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"//img.t.sinajs.cn/t6/style/images/apple/wbfont.svg\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"black\"</span><span class=\"crayon-r \"> /&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-9\"><span class=\"crayon-r \">&lt;link </span><span class=\"crayon-e \">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"shortcut icon\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"image/x-icon\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"/favicon.ico\"</span><span class=\"crayon-r \"> /&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-10\"><span class=\"crayon-i \"><span class=\"crayon-ta\">&lt;script </span><span class=\"crayon-e \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text/javascript\"</span><span class=\"crayon-o\">&gt;</span></span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-11\"><span class=\"crayon-st\">try</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execCommand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"BackgroundImageCache\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">catch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-12\"><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-13\"><span class=\"crayon-r \">&lt;title&gt;</span><span class=\"crayon-i \">微博-随时随地发现新鲜事</span><span class=\"crayon-r \">&lt;/title&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-14\"><span class=\"crayon-r \">&lt;link </span><span class=\"crayon-e \">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"//img.t.sinajs.cn/t6/style/css/module/base/frame.css?version=6c9bf6ab3b33391f\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"text/css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">charset</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"utf-8\"</span><span class=\"crayon-r \"> /&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-15\"><span class=\"crayon-r \">&lt;link </span><span class=\"crayon-e \">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"//img.t.sinajs.cn/t6/style/css/pages/growth/login_v5.css?version=6c9bf6ab3b33391f\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"text/css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">charset</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"utf-8\"</span><span class=\"crayon-r \">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-16\"><span class=\"crayon-r \">&lt;link </span><span class=\"crayon-e \">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"//img.t.sinajs.cn/t6/skin/default/skin.css?version=6c9bf6ab3b33391f\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"text/css\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"skin_style\"</span><span class=\"crayon-r \"> /&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-17\"><span class=\"crayon-i \"><span class=\"crayon-ta\">&lt;script </span><span class=\"crayon-e \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text/javascript\"</span><span class=\"crayon-o\">&gt;</span></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-18\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-19\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'islogin'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-20\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'version'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'6c9bf6ab3b33391f'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-21\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'timeDiff'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1505746970000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-22\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'lang'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zh-cn'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-23\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'jsPath'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'//js.t.sinajs.cn/t5/'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-24\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cssPath'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'//img.t.sinajs.cn/t5/'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-25\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'imgPath'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'//img.t.sinajs.cn/t5/'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-26\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'servertime'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1505746970</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-27\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'location'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'login'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-28\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'bigpipe'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'false'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-29\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'bpType'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'login'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-30\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'mJsPath'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'//js{n}.t.sinajs.cn/t5/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-31\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'mCssPath'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'//img{n}.t.sinajs.cn/t5/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-32\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'redirect'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-33\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">CONFIG</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'vid'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'1008997495870'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-34\"><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-35\"><span class=\"crayon-i \"><span class=\"crayon-ta\">&lt;style&gt;</span><span class=\"crayon-k \">#js_style_css_module_global_WB_outframe</span><span class=\"crayon-sy\">{</span><span class=\"crayon-e \">height</span><span class=\"crayon-sy\">:</span><span class=\"crayon-i \">42px</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-ta\">&lt;/style&gt;</span></span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f130ffa880815379-36\"><span class=\"crayon-r \">&lt;/head&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f130ffa880815379-37\">……</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0076 seconds] -->\r\n<p></p>\n<div title=\"纯文本显示代码\">如果之前有微博爬虫开发经验的小伙伴，看到这里，一定能想出来很多玩法了吧。</div>\n<h3>四、代码实现</h3>\n<p>下面附上我的源码，通过上面的详细介绍，应该已经比较好理解，因此这里就简单地说明一下：</p>\n<ol>\n<li>我把Cookie获取的过程做成了一个静态内部类，其中需要发起2次请求，一次是genvisitor获得3个参数，另一次是incarnate获得Cookie值；</li>\n<li>如果Cookie获取失败，会调用HttpClientInstance.changeProxy来改变代理IP，然后重新获取，直到获取成功为止；</li>\n<li>在使用时，出现了IP被封或无法正常获取页面等异常情况，外部可以通过调用cookieReset方法，重新获取一个新的Cookie。这里还是要声明一下，科学地使用爬虫，维护世界和平是程序员的基本素养；</li>\n<li>虽然加了一些锁的控制，但是还未在高并发场景实测过，不能保证百分百线程安全，如使用下面的代码，请根据需要自行修改，如有问题也请大神们及时指出，拜谢！</li>\n<li>HttpClientInstance是我用单例模式重新封装的httpclient，对于每个传进来的请求重新包装了一层RequestConfig，并且使用了代理IP；</li>\n<li>不是所有的微博页面都可以抓取得到，但是博文，评论，转发等基本的数据还是没有问题的；</li>\n<li>后续我也会把代码push到github上，请大家支持，谢谢！</li>\n</ol>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2e8f131000640373979\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport com.fullstackyang.httpclient.HttpClientInstance;\r\nimport com.fullstackyang.httpclient.HttpRequestUtils;\r\nimport com.google.common.base.Strings;\r\nimport com.google.common.collect.Maps;\r\nimport com.google.common.net.HttpHeaders;\r\nimport lombok.NoArgsConstructor;\r\nimport lombok.extern.slf4j.Slf4j;\r\nimport org.apache.commons.lang3.StringUtils;\r\nimport org.apache.http.client.config.CookieSpecs;\r\nimport org.apache.http.client.config.RequestConfig;\r\nimport org.apache.http.client.methods.HttpGet;\r\nimport org.apache.http.client.methods.HttpPost;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.UnsupportedEncodingException;\r\nimport java.math.BigDecimal;\r\nimport java.net.URLEncoder;\r\nimport java.util.Map;\r\nimport java.util.concurrent.locks.Lock;\r\nimport java.util.concurrent.locks.ReentrantLock;\r\n\r\n/**\r\n * 微博免登陆请求客户端\r\n *\r\n * @author fullstackyang\r\n */\r\n@Slf4j\r\npublic class WeiboClient {\r\n\r\n    private static CookieFetcher cookieFetcher = new CookieFetcher();\r\n\r\n    private volatile String cookie;\r\n\r\n    public WeiboClient() {\r\n        this.cookie = cookieFetcher.getCookie();\r\n    }\r\n\r\n    private static Lock lock = new ReentrantLock();\r\n\r\n    public void cookieReset() {\r\n        if (lock.tryLock()) {\r\n            try {\r\n                HttpClientInstance.instance().changeProxy();\r\n                this.cookie = cookieFetcher.getCookie();\r\n                log.info(\"cookie :\" + cookie);\r\n            } finally {\r\n                lock.unlock();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * get方法，获取微博平台的其他页面\r\n     * @param url\r\n     * &lt;a href=\"http://www.jobbole.com/members/wx1409399284\"&gt;@return&lt;/a&gt;\r\n     */\r\n    public String get(String url) {\r\n        if (Strings.isNullOrEmpty(url))\r\n            return \"\";\r\n\r\n        while (true) {\r\n            HttpGet httpGet = new HttpGet(url);\r\n            httpGet.addHeader(HttpHeaders.COOKIE, cookie);\r\n            httpGet.addHeader(HttpHeaders.HOST, \"weibo.com\");\r\n            httpGet.addHeader(\"Upgrade-Insecure-Requests\", \"1\");\r\n\r\n            httpGet.setConfig(RequestConfig.custom().setSocketTimeout(3000)\r\n                    .setConnectTimeout(3000).setConnectionRequestTimeout(3000).build());\r\n            String html = HttpClientInstance.instance().tryExecute(httpGet, null, null);\r\n            if (html == null)\r\n                cookieReset();\r\n            else return html;\r\n        }\r\n    }\r\n\r\n     /**\r\n     * 获取访问微博时必需的Cookie\r\n     */\r\n    @NoArgsConstructor\r\n    static class CookieFetcher {\r\n\r\n        static final String PASSPORT_URL = \"https://passport.weibo.com/visitor/visitor?entry=miniblog&amp;a=enter&amp;url=http://weibo.com/?category=2\"\r\n                + \"&amp;domain=.weibo.com&amp;ua=php-sso_sdk_client-0.6.23\";\r\n\r\n        static final String GEN_VISITOR_URL = \"https://passport.weibo.com/visitor/genvisitor\";\r\n\r\n        static final String VISITOR_URL = \"https://passport.weibo.com/visitor/visitor?a=incarnate\";\r\n\r\n        private String getCookie() {\r\n            Map&lt;String, String&gt; map;\r\n            while (true) {\r\n                map = getCookieParam();\r\n                if (map.containsKey(\"SUB\") &amp;&amp; map.containsKey(\"SUBP\") &amp;&amp;\r\n                        StringUtils.isNoneEmpty(map.get(\"SUB\"), map.get(\"SUBP\")))\r\n                    break;\r\n                HttpClientInstance.instance().changeProxy();\r\n            }\r\n            return \" YF-Page-G0=\" + \"; _s_tentry=-; SUB=\" + map.get(\"SUB\") + \"; SUBP=\" + map.get(\"SUBP\");\r\n        }\r\n\r\n        private Map&lt;String, String&gt; getCookieParam() {\r\n            String time = System.currentTimeMillis() + \"\";\r\n            time = time.substring(0, 9) + \".\" + time.substring(9, 13);\r\n            String passporturl = PASSPORT_URL + \"&amp;_rand=\" + time;\r\n\r\n            String tid = \"\";\r\n            String c = \"\";\r\n            String w = \"\";\r\n            {\r\n                String str = postGenvisitor(passporturl);\r\n                if (str.contains(\"\\\"retcode\\\":20000000\")) {\r\n                    JSONObject jsonObject = new JSONObject(str).getJSONObject(\"data\");\r\n                    tid = jsonObject.optString(\"tid\");\r\n                    try {\r\n                        tid = URLEncoder.encode(tid, \"utf-8\");\r\n                    } catch (UnsupportedEncodingException e) {\r\n                    }\r\n                    c = jsonObject.has(\"confidence\") ? \"000\" + jsonObject.getInt(\"confidence\") : \"100\";\r\n                    w = jsonObject.optBoolean(\"new_tid\") ? \"3\" : \"2\";\r\n                }\r\n            }\r\n            String s = \"\";\r\n            String sp = \"\";\r\n            {\r\n                if (StringUtils.isNoneEmpty(tid, w, c)) {\r\n                    String str = getVisitor(tid, w, c, passporturl);\r\n                    str = str.substring(str.indexOf(\"(\") + 1, str.indexOf(\")\"));\r\n                    if (str.contains(\"\\\"retcode\\\":20000000\")) {\r\n                        System.out.println(new JSONObject(str).toString(2));\r\n                        JSONObject jsonObject = new JSONObject(str).getJSONObject(\"data\");\r\n                        s = jsonObject.getString(\"sub\");\r\n                        sp = jsonObject.getString(\"subp\");\r\n                    }\r\n\r\n                }\r\n            }\r\n            Map&lt;String, String&gt; map = Maps.newHashMap();\r\n            map.put(\"SUB\", s);\r\n            map.put(\"SUBP\", sp);\r\n            return map;\r\n        }\r\n\r\n        private String postGenvisitor(String passporturl) {\r\n\r\n            Map&lt;String, String&gt; headers = Maps.newHashMap();\r\n            headers.put(HttpHeaders.ACCEPT, \"*/*\");\r\n            headers.put(HttpHeaders.ORIGIN, \"https://passport.weibo.com\");\r\n            headers.put(HttpHeaders.REFERER, passporturl);\r\n\r\n            Map&lt;String, String&gt; params = Maps.newHashMap();\r\n            params.put(\"cb\", \"gen_callback\");\r\n            params.put(\"fp\", fp());\r\n\r\n            HttpPost httpPost = HttpRequestUtils.createHttpPost(GEN_VISITOR_URL, headers, params);\r\n\r\n            String str = HttpClientInstance.instance().execute(httpPost, null);\r\n            return str.substring(str.indexOf(\"(\") + 1, str.lastIndexOf(\"\"));\r\n        }\r\n        private String getVisitor(String tid, String w, String c, String passporturl) {\r\n            String url = VISITOR_URL + \"&amp;t=\" + tid + \"&amp;w=\" + \"&amp;c=\" + c.substring(c.length() - 3)\r\n                    + \"&amp;gc=&amp;cb=cross_domain&amp;from=weibo&amp;_rand=0.\" + rand();\r\n\r\n            Map&lt;String, String&gt; headers = Maps.newHashMap();\r\n            headers.put(HttpHeaders.ACCEPT, \"*/*\");\r\n            headers.put(HttpHeaders.HOST, \"passport.weibo.com\");\r\n            headers.put(HttpHeaders.COOKIE, \"tid=\" + tid + \"__0\" + c);\r\n            headers.put(HttpHeaders.REFERER, passporturl);\r\n\r\n            HttpGet httpGet = HttpRequestUtils.createHttpGet(url, headers);\r\n            httpGet.setConfig(RequestConfig.custom().setCookieSpec(CookieSpecs.STANDARD).build());\r\n            return HttpClientInstance.instance().execute(httpGet, null);\r\n        }\r\n        private static String rand() {\r\n            return new BigDecimal(Math.floor(Math.random() * 10000000000000000L)).toString();\r\n        }\r\n        private static String fp() {\r\n            JSONObject jsonObject = new JSONObject();\r\n            jsonObject.put(\"os\", \"1\");\r\n            jsonObject.put(\"browser\", \"Chrome59,0,3071,115\");\r\n            jsonObject.put(\"fonts\", \"undefined\");\r\n            jsonObject.put(\"screenInfo\", \"1680*1050*24\");\r\n            jsonObject.put(\"plugins\",\r\n                    \"Enables Widevine licenses for playback of HTML audio/video content. (version: 1.4.8.984)::widevinecdmadapter.dll::Widevine Content Decryption Module|Shockwave Flash 26.0 r0::pepflashplayer.dll::Shockwave Flash|::mhjfbmdgcfjbbpaeojofohoefgiehjai::Chrome PDF Viewer|::internal-nacl-plugin::Native Client|Portable Document Format::internal-pdf-viewer::Chrome PDF Viewer\");\r\n            return jsonObject.toString();\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2e8f131000640373979-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-59c2e8f131000640373979-187\">187</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fullstackyang</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">httpclient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HttpClientInstance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fullstackyang</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">httpclient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HttpRequestUtils</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-3\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">base</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Strings</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">collect</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Maps</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lombok</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NoArgsConstructor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-7\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lombok</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">extern</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">slf4j</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Slf4j</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-8\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">apache</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">commons</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lang3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StringUtils</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-9\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">apache</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CookieSpecs</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-10\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">apache</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RequestConfig</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-11\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">apache</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">methods</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HttpGet</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-12\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">apache</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">methods</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HttpPost</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-13\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">JSONObject</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-14\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-15\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UnsupportedEncodingException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-16\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">BigDecimal</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-17\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">net</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">URLEncoder</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-18\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Map</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-19\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">concurrent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">locks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Lock</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-20\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">concurrent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">locks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ReentrantLock</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-22\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-23\"><span class=\"crayon-c\"> * 微博免登陆请求客户端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-24\"><span class=\"crayon-c\"> *</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-25\"><span class=\"crayon-c\"> * @author fullstackyang</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-26\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-27\"><span class=\"crayon-n\">@Slf4j</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-28\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WeiboClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieFetcher </span><span class=\"crayon-v\">cookieFetcher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieFetcher</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">volatile</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookie</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WeiboClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cookie</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookieFetcher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lock </span><span class=\"crayon-v\">lock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ReentrantLock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cookieReset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tryLock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-43\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">HttpClientInstance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">instance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">changeProxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cookie</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookieFetcher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-45\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"cookie :\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookie</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-47\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-53\"><span class=\"crayon-c\">     * get方法，获取微博平台的其他页面</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-54\"><span class=\"crayon-c\">     * @param url</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-55\"><span class=\"crayon-c\">     * &lt;a href=\"http://www.jobbole.com/members/wx1409399284\"&gt;@return&lt;/a&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-56\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Strings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isNullOrEmpty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-60\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-62\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">HttpGet </span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpGet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-63\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COOKIE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookie</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-64\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HOST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"weibo.com\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-65\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Upgrade-Insecure-Requests\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-66\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-67\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RequestConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">custom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setSocketTimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-68\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConnectTimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConnectionRequestTimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-69\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientInstance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">instance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tryExecute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-70\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-71\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">cookieReset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-72\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-75\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-76\"><span class=\"crayon-h\">     </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-77\"><span class=\"crayon-c\">     * 获取访问微博时必需的Cookie</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-78\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-n\">@NoArgsConstructor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieFetcher</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-81\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PASSPORT_URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://passport.weibo.com/visitor/visitor?entry=miniblog&amp;a=enter&amp;url=http://weibo.com/?category=2\"</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-83\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;domain=.weibo.com&amp;ua=php-sso_sdk_client-0.6.23\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-84\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GEN_VISITOR_URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://passport.weibo.com/visitor/genvisitor\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-86\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">VISITOR_URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://passport.weibo.com/visitor/visitor?a=incarnate\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-88\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-89\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-90\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-91\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-92\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookieParam</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-93\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">containsKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SUB\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">containsKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SUBP\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-94\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">StringUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isNoneEmpty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SUB\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SUBP\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-95\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-96\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">HttpClientInstance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">instance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">changeProxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" YF-Page-G0=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"; _s_tentry=-; SUB=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SUB\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"; SUBP=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SUBP\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-99\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-100\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-101\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookieParam</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-102\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-103\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-104\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">passporturl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PASSPORT_URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;_rand=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-105\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-106\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-107\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-108\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-109\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-110\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">postGenvisitor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">passporturl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-111\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">contains</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\\"retcode\\\":20000000\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-112\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">JSONObject </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JSONObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getJSONObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"data\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-113\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"tid\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-114\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-115\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">URLEncoder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-116\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">UnsupportedEncodingException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-117\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-118\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">has</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"confidence\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"000\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"confidence\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"100\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-119\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optBoolean</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"new_tid\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"3\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-120\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-121\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-122\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-123\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-124\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-125\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">StringUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isNoneEmpty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-126\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getVisitor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">passporturl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-127\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"(\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\")\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-128\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">contains</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\\"retcode\\\":20000000\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-129\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JSONObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-130\"><span class=\"crayon-h\">                        </span><span class=\"crayon-e\">JSONObject </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JSONObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getJSONObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"data\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-131\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"sub\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-132\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"subp\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-133\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-134\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-135\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-136\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-137\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Maps</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newHashMap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-138\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SUB\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-139\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SUBP\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-140\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-142\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-143\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">postGenvisitor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">passporturl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-144\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-145\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Maps</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newHashMap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-146\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ACCEPT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"*/*\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-147\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ORIGIN</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://passport.weibo.com\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-148\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">REFERER</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">passporturl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-149\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-150\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Maps</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newHashMap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-151\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"cb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"gen_callback\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-152\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fp\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-153\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-154\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">HttpPost </span><span class=\"crayon-v\">httpPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpRequestUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createHttpPost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">GEN_VISITOR_URL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-155\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientInstance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">instance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">httpPost</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-157\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"(\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lastIndexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-159\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getVisitor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">passporturl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-160\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">VISITOR_URL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;t=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;w=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;c=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-161\"><span class=\"crayon-h\">                    </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;gc=&amp;cb=cross_domain&amp;from=weibo&amp;_rand=0.\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-162\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Maps</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newHashMap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-164\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ACCEPT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"*/*\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HOST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"passport.weibo.com\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-166\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COOKIE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tid=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__0\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-167\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HttpHeaders</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">REFERER</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">passporturl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-168\"> </div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-169\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">HttpGet </span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpRequestUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createHttpGet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-170\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RequestConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">custom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setCookieSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CookieSpecs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">STANDARD</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-171\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientInstance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">instance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">httpGet</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-172\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-173\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-174\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BigDecimal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000000000000000L</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-175\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-176\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-177\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">JSONObject </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JSONObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-178\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"os\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-179\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"browser\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Chrome59,0,3071,115\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-180\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fonts\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"undefined\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-181\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"screenInfo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1680*1050*24\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"plugins\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-183\"><span class=\"crayon-h\">                    </span><span class=\"crayon-s\">\"Enables Widevine licenses for playback of HTML audio/video content. (version: 1.4.8.984)::widevinecdmadapter.dll::Widevine Content Decryption Module|Shockwave Flash 26.0 r0::pepflashplayer.dll::Shockwave Flash|::mhjfbmdgcfjbbpaeojofohoefgiehjai::Chrome PDF Viewer|::internal-nacl-plugin::Native Client|Portable Document Format::internal-pdf-viewer::Chrome PDF Viewer\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-184\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonObject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-185\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2e8f131000640373979-186\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2e8f131000640373979-187\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0334 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112507\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112507votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112507\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">\r\n\t\t\t<img src=\"http://tp2.sinaimg.cn/2233098320/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            会当凌绝顶，一览众山小——全栈之路        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2653yy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2653yy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 3</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.fullstackyang.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2653yy\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/dd8d6d643fed209184284cbaf7bb76344ee2dbb5.jpg"}
{"url_object_id": "3020491df0f8c0be11c80716e2019c4c", "title": "技术面试中常被问到是否参与开源，那如何清晰展示 GitHub 项目呢？", "url": "http://blog.jobbole.com/112322/", "create_date": "2017/09/10", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/124.jpg"], "praise_nums": "2", "comment_nums": "2", "fav_nums": "5", "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://thehftguy.com/2016/10/24/heres-how-to-make-a-good-github-project-for-your-resume/\">thehftguy</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>你面试的公司找你要 GitHub 链接，猎头找你要 GitHub 链接。“你参与过开源项目么？”是目前 IT 技术面试中的常见问题之一。</p>\n<p>既然他们要 GitHub，你就得给。本文将阐述如何在面试中展示你在 GitHub 上的项目。</p>\n<p>以下的建议有两个用途：应聘者可以学习怎么写软件的简介（不一定非要是GitHub）；招聘者（程序员）可以学习可以从哪些关键点来评价一个程序员的水平和软件的质量。</p>\n<figure id=\"attachment_3948\" class=\"wp-caption aligncenter\"><img class=\"aligncenter size-medium wp-image-3948\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-submit-application1.png?w=300&amp;h=239\" alt=\"submit application form with a GitHub link\" width=\"300\" height=\"239\">\n<figcaption class=\"wp-caption-text\">When having a GitHub is mandatory, just like having a name.</figcaption>\n</figure>\n<h3>链接一个特定的项目</h3>\n<p>在你的简历和每一份申请里面都放上你的GitHub链接。</p>\n<p>该链接要直链到一个项目。不要给你GitHub的主页地址，那个页面没有有用信息，很难让人继续浏览。</p>\n<p>你必须只展示一个项目。一个就够了，不需要更多。</p>\n<p>这个项目将是你的“登录页面”，是招聘者看到的第一个页面。他们很少去看其他页面（也没有这个必要）所以该页面本身就应该展示一切信息。如果他们去看了其他页面，说明这个主页成功引起了他们的兴趣，他们想知道更多项目细节。</p>\n<p>我们要写一个可以充分展示你的能力，并能给人留下好的第一印象的项目页面。</p>\n<h3>项目结构</h3>\n<p>用5秒时间看软件的架构就可以知道项目优劣。</p>\n<p>你一眼就能看出来一个程序员没有经验，他们的项目往往没有结构。项目文件要么在随便一个地方或者都在根目录。</p>\n<p><strong>一个好的项目结构必须将源代码，测试，库文件，可执行文件分开放在不同的文件夹中</strong>。</p>\n<p>命名的细节，例如是用‘doc’还是用‘docs’并不重要。这里是GitHub项目的<a href=\"https://GitHub.com/kriasoft/Folder-Structure-Conventions\">文件夹结构</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2f6d30295d790681591\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n.\r\n├── build                   # Compiled files (alternatively `dist`)\r\n├── docs                    # Documentation files (alternatively `doc`)\r\n├── src                     # Source files (alternatively `lib` or `app`)\r\n├── test                    # Automated tests (alternatively `spec` or `tests`)\r\n├── tools                   # Tools and utilities\r\n├── LICENSE\r\n└── README.md\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2f6d30295d790681591-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f6d30295d790681591-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2f6d30295d790681591-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f6d30295d790681591-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2f6d30295d790681591-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f6d30295d790681591-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2f6d30295d790681591-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2f6d30295d790681591-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2f6d30295d790681591-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2f6d30295d790681591-1\"><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f6d30295d790681591-2\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">build</span><span class=\"crayon-h\">                   </span><span class=\"crayon-p\"># Compiled files (alternatively `dist`)</span></div><div class=\"crayon-line\" id=\"crayon-59c2f6d30295d790681591-3\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">docs</span><span class=\"crayon-h\">                    </span><span class=\"crayon-p\"># Documentation files (alternatively `doc`)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f6d30295d790681591-4\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">src</span><span class=\"crayon-h\">                     </span><span class=\"crayon-p\"># Source files (alternatively `lib` or `app`)</span></div><div class=\"crayon-line\" id=\"crayon-59c2f6d30295d790681591-5\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\">                    </span><span class=\"crayon-p\"># Automated tests (alternatively `spec` or `tests`)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f6d30295d790681591-6\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">tools</span><span class=\"crayon-h\">                   </span><span class=\"crayon-p\"># Tools and utilities</span></div><div class=\"crayon-line\" id=\"crayon-59c2f6d30295d790681591-7\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">LICENSE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2f6d30295d790681591-8\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">md</span></div><div class=\"crayon-line\" id=\"crayon-59c2f6d30295d790681591-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<figure id=\"attachment_4111\" class=\"wp-caption alignnone\"><img class=\"alignnone size-full wp-image-4111\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-project-structure.png?w=809\" alt=\"software project structure\">\n<figcaption class=\"wp-caption-text\">A well-organized project</figcaption>\n</figure>\n<h3>有一个项目简介文件</h3>\n<p>项目简介文件可以提供：</p>\n<ul>\n<li>项目目标</li>\n<li>截屏或视频</li>\n<li>使用说明</li>\n<li>软件下载页面</li>\n</ul>\n<h3>在简介文件里面放软件界面截屏</h3>\n<p>一张图比一千个字更能说明问题。</p>\n<p>人们不会因为要看软件界面就去安装软件。请提供软件界面截图。</p>\n<h3>在简介中放视频</h3>\n<p>一张图能抵一千个字，那么一个视频顶一千张图。</p>\n<figure id=\"attachment_3846\" class=\"wp-caption alignnone\"><img class=\"alignnone size-full wp-image-3846\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-snake-gif.gif?w=809\" alt=\"snake game preview animated gif\" width=\"600\" height=\"370\">\n<figcaption class=\"wp-caption-text\">Great demo from <a href=\"https://GitHub.com/DyegoCosta/snake-game\" target=\"_blank\" rel=\"noopener\">a random snake project on GitHub</a></figcaption>\n</figure>\n<p><strong>注意</strong>：GitHub不允许插入视频，你可以使用动态图。</p>\n<h3>网页链接或安装文件链接</h3>\n<p>如果该项目是网络应用，请提供网页地址。当然，所有人都应该能访问该地址。</p>\n<p>如果该项目是单机程序，请提供安装文件下载地址。如果安装文件看上去不专业，用户是不会安装它的。很多时候，是否专业跟发布方式有关。</p>\n<h3>整合GitHub工具</h3>\n<p>GitHub提供了一整套免费工具用于编连，打包，测试和其他功能。这些工具在专业软件开发中都是必须的。</p>\n<p>以前想要实现这些功能非常困难，但如今通过GitHub一切都非常简单。你没有理由不用它们。</p>\n<p><img class=\" size-full wp-image-3871 aligncenter\" style=\"height: auto; max-width: 100%; clear: both; margin: 0.8em auto;\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-integration-icons.png?w=809\" alt=\"GitHub-integration-icons\"></p>\n<p>这是一个由C++实现的四子棋的例子。按钮从左到右代表：</p>\n<ol>\n<li>在Linux上编连（<a href=\"https://travis-ci.org/\" target=\"_blank\" rel=\"noopener\">Travis CI</a>）</li>\n<li>在Windows上编连（<a href=\"https://www.appveyor.com/\" target=\"_blank\" rel=\"noopener\">AppVeyor</a>）</li>\n<li>单元测试和测试覆盖分析（<a href=\"https://coveralls.io/\" target=\"_blank\" rel=\"noopener\">Coveralls</a>）</li>\n</ol>\n<h3>如何处理源代码？</h3>\n<p>“没人在乎你的源代码——得知这个事实的时候我也很吃惊。我在整理代码上花了不少时间，但发现没人在乎。重要的不是代码，而是产品” （<a href=\"https://mortoray.com/2015/04/20/nobody-cares-about-your-code/\">出处</a>）</p>\n<p>比起猜，读一段软件功能描述要快10倍。比起自己弄明白软件用法，观看一个介绍基本用法的视频可以快100倍。比起逆向工程，读设计图表要快1000倍。你可以通过读源代码来搞清楚一切，但这个过程要费事得多。读源代码（解码源代码）是非常耗时的。只有在走投无路的时候才应该用。</p>\n<p>经验教训1：没人在乎你的代码，也不会有人去读你的代码。</p>\n<p>经验教训2：别指望别人会去读你的代码，也别强迫别人去读代码。</p>\n<h3>如果我没有像样的大项目要怎么办？</h3>\n<p>挺好的。简单的项目更容易展示，更容易解释，面试官也更容易理解。比如大家都知道四子棋是怎么回事。</p>\n<p>即使第一眼看上去很简单，但每一个项目都包含了很多工作量：写一个好的用户界面，调整颜色，允许两个人一起游戏，加上对下一步棋的走子建议，加上 AI 选手等等。</p>\n<p>这个游戏规则很简单但是要把它做成好的软件要做很多工作。这些都是你在面对面的面试中可以跟面试官深入探讨的地方。</p>\n<p>你知道玩四子棋的时候先走的选手一定会赢么？【如果他不犯错的话】你知道如果第一个选手第一步棋不走中间的话，第二个选手一定可以将棋走成平局么？</p>\n<p>来源：<a href=\"http://www.informatik.uni-trier.de/~fernau/DSL0607/Masterthesis-Viergewinnt.pdf\" target=\"_blank\" rel=\"noopener\">A Knowledge-based Approach of Connect-Four</a>, <em>The Game is Solved: White Wins</em>, Victor Allis</p>\n<h3>面试官真的会去看GitHub么？</h3>\n<p>事实上<strong>他们不会</strong>。</p>\n<figure id=\"attachment_4010\" class=\"wp-caption aligncenter\"><img class=\" size-full wp-image-4010 aligncenter\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-traffic.png?w=809\" alt=\"GitHub traffic statistics\">\n<figcaption class=\"wp-caption-text\">GitHub Traffic Statistics</figcaption>\n</figure>\n<p>我们测试过了。这个图是我们发出一堆简历之后的数据统计。这三个点击是我自己点的。在写这篇文章的时候我没有登录就去点了GitHub。我的错。</p>\n<p>从我上次找工作的经验来说，经过十几个电话面试（每次电话有一个技术人员）和几个现场面试（4到7个技术人员），只有一个人去看了我的GitHub页面。</p>\n<p>结论：没人关心GitHub，没人会看GitHub。每人都会问，是因为别人也在这样做。</p>\n<p>好处：既然没有人真的去看，你也可以拒绝参加这场GitHub的假面舞会。你可以用这个<a href=\"https://GitHub.com/leachim6/hello-world\"> hello world 终极版本库</a> 去回应所有的GitHub要求。这个版本库包含用一百种语言实现的“Hello world”。</p>\n<h3>小抄</h3>\n<ol>\n<li>项目要有结构</li>\n<li>要有项目简介文件</li>\n<li>写一段说明软件功能的介绍</li>\n<li>放上软件界面截图和使用说明视频</li>\n<li>提供安装文件下载地址或者网络应用的网址</li>\n<li>整合发开工具（CI，单元测试，打包工具等等）</li>\n</ol>\n<p>这世上还有其他软件工程的好范例，不仅仅局限于GitHub。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/2ec965670e006b5d53c221a7cdcf0108.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/a5e36df34a1aea088f06fb503c7ce93d.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112322\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112322votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112322\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/5bfa690c5bc8a2dc2344cffdebf5f50b.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据科学进修中，Python小码农。不用QQ，有事站内信联系。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/buntamarui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/buntamarui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 30</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/ammie/\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/bchen4\"><i class=\"fa fa-github\"></i></a> <a title=\"Linked主页\" target=\"_blank\" href=\"https://www.linkedin.com/\"><i class=\"fa fa-linkedin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/4ccab0a38c3c13879135519b200e0c60ce7498bb.jpg"}
{"url_object_id": "fc531aa1eebe55fcb9eee070c03a6911", "title": "为提高用户体验，Yelp 是如何无损压缩图片的", "url": "http://blog.jobbole.com/112321/", "create_date": "2017/09/12", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjgtf2uq3bj218s0rdwot.jpg"], "praise_nums": "3", "comment_nums": "  评论", "fav_nums": "7", "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/fengzhuang19940106\">iScream</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://engineeringblog.yelp.com/2017/06/making-photos-smaller.html\">Yelp</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Yelp 拥有超过 1 亿张由用户生成的照片，这些照片从晚餐、理发，到我们最新的功能之一：yelfies。这些图像占据了用户 APP 和网站的大部分带宽，这意味着存储和传输的巨大成本。为了向用户提供最好的体验，我们努力优化这些图片并将其平均大小缩小了 30%。这样节省了用户的时间和带宽，并降低了为这些图像提供服务的成本。哦，我们这样做都没有降低图像的质量呢！</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjgtf2uq3bj218s0rdwot.jpg\" width=\"690\" height=\"422\"></p>\n<h3>背景</h3>\n<p>Yelp 已经帮用户存储上传的照片超过 12 年了。我们那些将无损格式的图片（PNG，GIF）保存成 PNG 格式，而所有其他的格式的图片则保存成 JPEG 格式。我们保存图片用的是 Python 和 Pillow，并使用如下代码片段，开启了我们照片上传的故事：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2ee3ba6bbf541054904\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# do a typical thumbnail, preserving aspect ratio\r\nnew_photo = photo.copy()\r\nnew_photo.thumbnail(\r\n    (width, height),\r\n    resample=PIL.Image.ANTIALIAS,\r\n)\r\nthumbfile = cStringIO.StringIO()\r\nsave_args = {'format': format}\r\nif format == 'JPEG':\r\n    save_args['quality'] = 85\r\nnew_photo.save(thumbfile, **save_args)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bbf541054904-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bbf541054904-1\"><span class=\"crayon-p\"># do a typical thumbnail, preserving aspect ratio</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bbf541054904-2\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bbf541054904-3\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">thumbnail</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bbf541054904-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bbf541054904-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resample</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ANTIALIAS</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bbf541054904-6\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bbf541054904-7\"><span class=\"crayon-v\">thumbfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cStringIO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bbf541054904-8\"><span class=\"crayon-v\">save_args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'format'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bbf541054904-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'JPEG'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bbf541054904-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">save_args</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'quality'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bbf541054904-11\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thumbfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">save_args</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>以此作为起点，我们开始研究潜在的文件大小优化方法，可以让我们在不损失质量的前提下使用。</p>\n<h3 id=\"optimizations\">优化</h3>\n<p>首先，我们不得不决定是自己来处理这个问题，还是让 CDN 提供商用他们的魔力来神奇地改变我们的照片。在优先保证高质量的内容前提下，去评估众多选项并使得潜在的尺寸与质量相互抵消是有意义的。我们先行调查了当前照片文件大小缩小的现状 – 可以做出什么改变，以及与每个改变相关联的大小/质量下降。随着这项调查的完成，我们决定从三大类方法来着手。这篇文章剩下的部分解释了我们做了什么，并在每项优化中获得了多少收益。</p>\n<p><strong>1.Pillow中的改变</strong></p>\n<ul>\n<li>优化标志</li>\n<li>渐进的JPEG</li>\n</ul>\n<p><strong>2.应用照片逻辑的更改</strong></p>\n<ul>\n<li>大型 PNG 格式图的检测</li>\n<li>动态 JPEG 质量</li>\n</ul>\n<p><strong>3.JPEG编码器更改</strong></p>\n<ul>\n<li>Mozjpeg（网格量化，自定义量化矩阵）</li>\n</ul>\n<h3 id=\"changes-in-pillow\">Pillow 中的改变</h3>\n<h3 id=\"optimize-flag\">标志位优化</h3>\n<p>这是我们最简单的更改之一：启用 Pillow 中的设置，以 CPU 耗时为代价（optimize = True）来节约更多的文件大小。 由于该权衡的本质，这样做并不会影响图像质量。</p>\n<p>对于 JPEG 格式的图片，该标志位会指示编码器，通过扫描每张图片做一次附加的遍历，来找到最佳霍夫曼编码。对每张图片的第一遍扫描，我们不是写入文件，而是计算每个值的出现统计，这是计算理想编码所需要信息。PNG 内部使用 zlib，因此在这种情况下，标志位优化能有效地指示编码器使用 gzip -9，而不是 gzip -6。</p>\n<p>这是一项简单的改进，但事实证明它并非灵丹妙药，只减少百分之几的文件大小。</p>\n<h3 id=\"progressive-jpeg\">渐进式 JPEG</h3>\n<p>将图像保存为 JPEG 格式时，你可以选择几种不同的类型：</p>\n<ul>\n<li>从上到下加载的 JPEG 标准图像。</li>\n<li>渐进式 JPEG 图像，从较模糊加载到较不模糊。Pillow（progressive = True）可以轻松地启用渐进式选项。 因而，人类肉眼可感知到性能有了提升（也就是说，当图像部分缺失时，更容易注意到它不是完全锐利的）。</li>\n</ul>\n<p>此外，渐进式文件打包方式通常会使得文件尺寸减少。如维基百科文章中所详尽解释的那样，JPEG 格式在 8×8 像素块上使用 Z 字形模式进行熵编码。当这些像素块的值被解包并按顺序排列时，我们通常首先得到的是非零数字，然后是 0 的序列，用该模式对于图像中的每个 8×8 块进行重复和交织。在使用渐进编码时，解开的像素块的顺序发生了改变。每个块值较高的数字会首先出现文件中（它给出了渐进式图像最早扫描到的不同阻塞），并且那些能增加出色细节的小数字（包括更多的 0），它们的跨度将更长，并一直持续到末位。图像数据的这种重新排序不会改变图像本身，而是增加了在一行中的可能存在的 0 的数量（这样可以更容易地压缩）。</p>\n<p>与由用户贡献的美味甜甜圈图像做比较（点击查看大图）：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/7f058d53944b33506d3375138eca77b4.gif\"><img class=\"alignnone wp-image-65555\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/7f058d53944b33506d3375138eca77b4.gif\" alt=\"baseline-tiny\" width=\"299\" height=\"220\"></a></p>\n<p>（1）标准 JPEG 格式图渲染的模拟</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f553920cd4b568166bdbbfb5c0a3b40.gif\"><img class=\"alignnone wp-image-65554\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f553920cd4b568166bdbbfb5c0a3b40.gif\" alt=\"progressive-tiny\" width=\"299\" height=\"220\"></a></p>\n<p>（2）渐进式 JPEG 格式图渲染的模拟。</p>\n<h3 id=\"changes-to-application-photo-logic\">应用照片逻辑的改变</h3>\n<h3 id=\"large-png-detection\">大型 PNG 格式图片的检测</h3>\n<p>Yelp 为用户生成的内容提供了两种图像格式 –  JPEG 和 PNG。JPEG 是一种很好的照片格式，但通常会与高对比度设计内容（如 logo）相结合。相比之下，PNG 是完全无损的，非常适合图形，但对于那些小失真不可见的照片来说占用的空间太大了。在用户上传实际照片是 PNG 格式的情况下，我们识别这些文件并将其另存为 JPEG 格式，可节省下大量的存储空间。Yelp 上一些常见的 PNG 照片来源于移动设备由和应用程序拍摄的截图，这些照片是通过添加特效或边框修饰了的。</p>\n<p><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/example-pngs.png\"></p>\n<p>（左）一个典型的具有 logo 和边框的复合 PNG 格式的上传图。 （右）一个典型的来自于屏幕截图的 PNG 格式的上传图。</p>\n<p>我们想减少这些不必要的 PNG 格式的图片数量，但重要的是要避免矫枉过正或降低了 logo 和图形等的质量。我们应该如何区分出一张图片中属于照片的部分呢？从像素层面可以做到吗？</p>\n<p>使用了 2500 张图片作为实验样本后，我们发现文件大小和独特像素的结合可以很好地区分照片。我们用我们最大的分辨率生成候选缩略图，看看输出PNG文件是否大于 300 KiB。如果是，我们还将检查图像内容，查看是否有超过 2^16 种独特颜色（Yelp 将 RGBA 格式的上传图片转成 RGB 格式，但如果没这样做的话，我们也会检查）。</p>\n<p>在实验数据集中，那些手动调整阈值来定义成“ bigness ”占了有可能缩小的文件大小的 88％（即如果我们要转换所有图像，我们预期的文件大小的缩小），这是在不会导致转换后图形的任何假阳性的前提下进行的。</p>\n<p id=\"dynamic-jpeg-quality\"><strong>动态的 JPEG 质量</strong></p>\n<p>缩小 JPEG 文件大小的第一个也是最为人所知的一种方式是称为质量的设置。许多能保存 JPEG 格式图片的应用程序会将质量指定为一个数字。</p>\n<p>质量这个词有点抽象。事实上，一幅 JPEG 格式的图像的每个颜色通道都有单独的质量。质量等级从 0 到 100 映射到颜色通道的不同量化表，取决于丢失了多少数据（通常是高频成分）。信号域中的量化是 JPEG 编码过程中丢失信息的步骤之一。</p>\n<p>减小文件大小的最简单的方法是降低图像的质量，这会引入更多的噪声。不是每张图片在一个给定的相同质量水平上都会丢失相同的信息量。</p>\n<p>我们可以为每张图片动态地选择一种质量优化设置，找到质量和存储大小之间的理想平衡。有两种方法可以做到这一点：</p>\n<ul>\n<li>自下而上：这些是通过处理 8 x 8 像素块级别的图像生成调谐量化表的算法。它们计算出丢失了多少理论上的质量，以及丢失的数据如何放大或消除，对人眼可见失真的多或少。</li>\n<li>自上而下的：这些算法是将整张图片与其原始无失真版本进行比较，检测丢失了多少信息。通过迭代生成具有不同质量设置的候选图像，我们可以选择其中一张图片，作为满足某种评估算法的最低评估水平的图像。</li>\n</ul>\n<p style=\"text-align: left;\">我们评估了一种自下而上的算法，在实验中，在我们希望使用的质量范围的上限内没有产生合适的结果（尽管它似乎仍然具有中档图像质量的潜力， 这时编码器可以开始更冒险地去丢弃它的字节）。关于这一策略的众多学术论文在90年代初就有发表，该方法对计算能力要求很高，并且走了选项 B 地址这类的捷径，例如不评估块之间的交互。</p>\n<p>所以我们采取了第二种方法：使用对分的算法生成不同质量水平的候选图像，并通过使用 pyssim 函数来计算其结构相似性度量（SSIM），来评估每个候选图像的质量下降，直到该值处于可配置但阈值也还处于静态。这允许我们选择性地降低文件的平均大小（和平均质量），仅仅针对那些已经开始产生肉眼可识别的质量下降的图像。</p>\n<p>在下图中，我们绘制了用3种不同质量方法生成的 2500 张图像的SSIM值的表。</p>\n<p>1、用一种质量为 85 的初始方法作出原始图像，使用蓝线来绘制。</p>\n<p><span style=\"font-weight: normal; text-align: center;\">2、一种能降低文件大小，质量改为 80 的替代方法，用红线来绘制。</span></p>\n<p><span style=\"font-weight: normal; text-align: center;\">3、</span><span style=\"font-weight: normal; text-align: center;\">我们在最后选用了一种方法，使用橙色绘制动态质量的 SSIM 为 80 – 85 的图，即选择质量为 80 到 85（含）的图像，这是基于一种满足或超过的 SSIM 比率：该比率是预先计算的、使转换发生在图像范围中间的某个静态值。这样我们可以降低文件的平均大小，而不会降低那些质量最差的图片的质量。</span><strong style=\"text-align: center;\"><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/ssims-strategies.png\"></strong></p>\n<p style=\"text-align: center;\">3 种不同质量策略下 2500 张图片的 SSIM 值图</p>\n<h5 id=\"ssim\">SSIM？</h5>\n<p>有不少图像质量算法试图模仿人类视觉系统。我们已经评估过其中的许多算法，并认为 SSIM 虽然较为古老，但基于以下几个特征是最适合于迭代优化的：</p>\n<p>1、对 JPEG 量化误差敏感<br>\n2、快速，简单的算法<br>\n3、可以直接对 PIL 原生图像对象进行计算，而不是将图像转换为 PNG 格式并将其传递给 CLI 应用程序（参见＃2）</p>\n<p>动态质量的代码示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2ee3ba6bd1361588821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport cStringIO\r\nimport PIL.Image\r\nfrom ssim import compute_ssim\r\n \r\n \r\ndef get_ssim_at_quality(photo, quality):\r\n    \"\"\"Return the ssim for this JPEG image saved at the specified quality\"\"\"\r\n    ssim_photo = cStringIO.StringIO()\r\n    # optimize is omitted here as it doesn't affect\r\n    # quality but requires additional memory and cpu\r\n    photo.save(ssim_photo, format=\"JPEG\", quality=quality, progressive=True)\r\n    ssim_photo.seek(0)\r\n    ssim_score = compute_ssim(photo, PIL.Image.open(ssim_photo))\r\n    return ssim_score\r\n \r\n \r\ndef _ssim_iteration_count(lo, hi):\r\n    \"\"\"Return the depth of the binary search tree for this range\"\"\"\r\n    if lo &gt;= hi:\r\n        return 0\r\n    else:\r\n        return int(log(hi - lo, 2)) + 1\r\n \r\n \r\ndef jpeg_dynamic_quality(original_photo):\r\n    \"\"\"Return an integer representing the quality that this JPEG image should be\r\n    saved at to attain the quality threshold specified for this photo class.\r\n \r\n    Args:\r\n        original_photo - a prepared PIL JPEG image (only JPEG is supported)\r\n    \"\"\"\r\n    ssim_goal = 0.95\r\n    hi = 85\r\n    lo = 80\r\n \r\n    # working on a smaller size image doesn't give worse results but is faster\r\n    # changing this value requires updating the calculated thresholds\r\n    photo = original_photo.resize((400, 400))\r\n \r\n    if not _should_use_dynamic_quality():\r\n        default_ssim = get_ssim_at_quality(photo, hi)\r\n        return hi, default_ssim\r\n \r\n    # 95 is the highest useful value for JPEG. Higher values cause different behavior\r\n    # Used to establish the image's intrinsic ssim without encoder artifacts\r\n    normalized_ssim = get_ssim_at_quality(photo, 95)\r\n    selected_quality = selected_ssim = None\r\n \r\n    # loop bisection. ssim function increases monotonically so this will converge\r\n    for i in xrange(_ssim_iteration_count(lo, hi)):\r\n        curr_quality = (lo + hi) // 2\r\n        curr_ssim = get_ssim_at_quality(photo, curr_quality)\r\n        ssim_ratio = curr_ssim / normalized_ssim\r\n \r\n        if ssim_ratio &gt;= ssim_goal:\r\n            # continue to check whether a lower quality level also exceeds the goal\r\n            selected_quality = curr_quality\r\n            selected_ssim = curr_ssim\r\n            hi = curr_quality\r\n        else:\r\n            lo = curr_quality\r\n \r\n    if selected_quality:\r\n        return selected_quality, selected_ssim\r\n    else:\r\n        default_ssim = get_ssim_at_quality(photo, hi)\r\n        return hi, default_ssim</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd1361588821-67\">67</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">cStringIO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Image</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">ssim </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">compute_ssim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-5\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">quality</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return the ssim for this JPEG image saved at the specified quality\"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cStringIO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># optimize is omitted here as it doesn't affect</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># quality but requires additional memory and cpu</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"JPEG\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">quality</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">quality</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">progressive</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compute_ssim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ssim_score</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-15\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-16\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-17\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_ssim_iteration_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return the depth of the binary search tree for this range\"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-23\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-24\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-25\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">jpeg_dynamic_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">original_photo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return an integer representing the quality that this JPEG image should be</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-27\"><span class=\"crayon-s\">    saved at to attain the quality threshold specified for this photo class.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-28\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-29\"><span class=\"crayon-s\">    Args:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-30\"><span class=\"crayon-s\">        original_photo - a prepared PIL JPEG image (only JPEG is supported)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-31\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_goal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-35\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># working on a smaller size image doesn't give worse results but is faster</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># changing this value requires updating the calculated thresholds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">original_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-39\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_should_use_dynamic_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">default_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">default_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-43\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 95 is the highest useful value for JPEG. Higher values cause different behavior</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Used to establish the image's intrinsic ssim without encoder artifacts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">normalized_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-48\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># loop bisection. ssim function increases monotonically so this will converge</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">_ssim_iteration_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">curr_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">curr_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr_quality</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ssim_ratio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">normalized_ssim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-54\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-55\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssim_ratio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssim_goal</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># continue to check whether a lower quality level also exceeds the goal</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-58\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">selected_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-59\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-60\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-61\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-62\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-63\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">selected_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-65\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd1361588821-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">default_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd1361588821-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">default_ssim</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0079 seconds] -->\r\n<p>还有一些关于这种技术的其他博客文章，这里是柯尔特·麦卡尼斯（Colt Mcanlis）的一篇博文。当我们发布这篇博客的时候，Etsy 已经发表了一篇了！击掌吧，更快的网络！</p>\n<h3 id=\"changes-to-jpeg-encoder\">JPEG 编码器的更改</h3>\n<p id=\"mozjpeg\">Mozjpeg 是 libjpeg-turbo 的一个开源分支，它采取以时间换空间的方法，通过更长时间的运算换取更加优化的文件尺寸。这种方法很好地与离线批处理方法结合以重新生成图像。一些更昂贵的算法用了比 libjpeg-turbo 多出 3 – 5 倍的时间，使得图像更小了一些！</p>\n<p>mozjpeg 的区别之一是使用一种替代量化表。如上所述，质量是用于每个颜色通道的量化表的抽象。所有符号都指向默认的 JPEG 量化表，因而它很容易被击败。用这个词来说，</p>\n<p><a href=\"https://www.w3.org/Graphics/JPEG/itu-t81.pdf\">JPEG spec</a>:</p>\n<blockquote><p>这些表仅作为示例，并不一定适用于任何特定应用。</p></blockquote>\n<p>那么自然地，不要惊讶于你知道这些表是大多数编码器使用的默认值…</p>\n<p>Mozjpeg 经历了为我们的替代表做基准测试的麻烦时期，并在之后成为了它所创建的图像中，能用到的性能最好的通用替代品。</p>\n<h3 id=\"mozjpeg--pillow\">Mozjpeg + Pillow</h3>\n<p>大多数的 Linux 发行版都默认安装了 libjpeg。所以在 Pillow 下使用 mozjpeg 在默认情况下不起作用，但配置起来也不是很困难。当您构建 mozjpeg 时，请使用–with-jpeg8 标志位，并确保可以通过 Pillow 链接到它。如果您使用Docker，您可能会有一个 Dockerfile，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59c2ee3ba6bd8272324750\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM ubuntu:xenial\r\n \r\nRUN apt-get update \r\n\t&amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends install \r\n\t# build tools\r\n\tnasm \r\n\tbuild-essential \r\n\tautoconf \r\n\tautomake \r\n\tlibtool \r\n\tpkg-config \r\n\t# python tools\r\n\tpython \r\n\tpython-dev \r\n\tpython-pip \r\n\tpython-setuptools \r\n\t# cleanup\r\n\t&amp;&amp; apt-get clean \r\n\t&amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\r\n \r\n# Download and compile mozjpeg\r\nADD https://github.com/mozilla/mozjpeg/archive/v3.2-pre.tar.gz /mozjpeg-src/v3.2-pre.tar.gz\r\nRUN tar -xzf /mozjpeg-src/v3.2-pre.tar.gz -C /mozjpeg-src/\r\nWORKDIR /mozjpeg-src/mozjpeg-3.2-pre\r\nRUN autoreconf -fiv \r\n\t&amp;&amp; ./configure --with-jpeg8 \r\n\t&amp;&amp; make install prefix=/usr libdir=/usr/lib64\r\nRUN echo \"/usr/lib64n\" &gt; /etc/ld.so.conf.d/mozjpeg.conf\r\nRUN ldconfig\r\n \r\n# Build Pillow\r\nRUN pip install virtualenv \r\n\t&amp;&amp; virtualenv /virtualenv_run \r\n\t&amp;&amp; /virtualenv_run/bin/pip install --upgrade pip \r\n\t&amp;&amp; /virtualenv_run/bin/pip install --no-binary=:all: Pillow==4.0.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59c2ee3ba6bd8272324750-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">xenial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-2\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">update</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBIAN_FRONTEND</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">noninteractive </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">install</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">recommends </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># build tools</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">nasm </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-7\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">build</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">essential </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">autoconf </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-9\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">automake </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-10\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">libtool </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-11\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">pkg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">config</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># python tools</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">python </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-14\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dev </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-15\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pip </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-16\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">setuptools</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># cleanup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-19\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lists</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-21\"><span class=\"crayon-p\"># Download and compile mozjpeg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-22\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/mozilla/mozjpeg/archive/v3.2-pre.tar.gz /mozjpeg-src/v3.2-pre.tar.gz</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-23\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xzf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">v3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pre</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gz</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-24\"><span class=\"crayon-v\">WORKDIR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.2</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pre</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-25\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">autoreconf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fiv</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-26\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">configure</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">with</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">jpeg8</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-27\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">usr </span><span class=\"crayon-v\">libdir</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">lib64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-28\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/lib64n\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf</span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-29\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">ldconfig</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-30\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-31\"><span class=\"crayon-p\"># Build Pillow</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-32\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-33\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59c2ee3ba6bd8272324750-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">upgrade </span><span class=\"crayon-v\">pip</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59c2ee3ba6bd8272324750-35\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">binary</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">all</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Pillow</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">4.0.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0054 seconds] -->\r\n<p>以上！使用它，您将可以在正常图片工作流程中，使用由 mozjpeg 支持的 Pillow。</p>\n<h3 id=\"impact\">影响</h3>\n<p>这些改进中的每一项对我们的提升分别是多少呢？我们随机抽取 2,500 张 Yelp 上的商业照片开始了此项研究，测试照片大小在经过我们的处理流程后有怎样的变化。</p>\n<p>1、通过改变 Pillow 的设置，可以将图片大小减小 4.5%<br>\n2、大型 PNG 格式图片检测可以将图片大小减小 6.2%<br>\n3、动态质量可以将图片大小减小 4.5%<br>\n4、切换到 mozjpeg 编码器可以将图片大小减小 13.8%</p>\n<p>这些改进使得图像文件的平均大小减少了约 30％，并被我们应用到我们最大和最常见的图像分辨率上，使网站能为用户提供更快速的服务，并且每天在数据传输上节省了 TB 级别的容量。按照 CDN 来衡量：</p>\n<p><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/Filesize-over-time.png\"></p>\n<p style=\"text-align: center;\">从 CDN（结合非图像静态内容）测量的平均文件大小。</p>\n<h3 id=\"what-we-didnt-do\">我们还没做的</h3>\n<p>本节旨在向您介绍可能能够做出的一些常见改进，有的是因为它们和 Yelp 使用的工具并无关系，有些是因为我们权衡后决定不做。</p>\n<h3 id=\"subsampling\">子采样</h3>\n<p>子采样是决定网页图像的质量和文件大小的主要因素。对于子抽样的更详尽的描述可以在网上找到，但在这个博客文章我们只要说以 4：1：1（这是 Pillow 的默认值，没有指定任何其他内容）进行子采样就够了，所以我们无法了解能进一步缩小多少。</p>\n<h3 id=\"lossy-png-encoding\">有损的 PNG 编码</h3>\n<p>在了解我们对 PNG 格式图片做了什么之后，用例如 pngmini 这样的有损编码器，选择将这些图片中一部分保留为 PNG 格式，可能是有意义的，但是我们选择将其重新保存成 JPEG 格式。这是一个结果看来合理的替代选项，根据作者的说法，未修改的 PNG 格式图片的文件大小缩小了 72-85 ％。</p>\n<h3 id=\"dynamic-content-types\">动态内容类型</h3>\n<p>为更多的现代化内容类型提供支持，如 WebP 或 JPEG2k 肯定是我们的未来要做的。而一旦这个假设的项目实行了，就会有大量的用户要求为现有已优化的 JPEG / PNG 图像做这些，这将继续使该项工作非常值得做。</p>\n<h3 id=\"svg\">SVG</h3>\n<p>我们在网站上的许多地方使用 SVG，就像我们设计师创建的静态资产，这已成为我们的指导风格。虽然这种格式和优化工具（如 svgo）有助于减少网站页面的开销，但它与我们在这里所做的工作无关。</p>\n<h3 id=\"vendor-magic\">供应商的魔术</h3>\n<p>能提供图像传送/调整大小/裁剪/转码服务的供应商太多，包括开源的 thumbor。也许这是支持响应式图像，动态内容类型的最简单方法，并且在将来仍然能让我们保持在技术前沿。而现在我们的解决方案仍然是独立的。</p>\n<h3 id=\"further-reading\">拓展阅读</h3>\n<p>这里列出的两本书在这个领域历史上是绝对能站稳脚跟的，强烈建议您进一步阅读这些书籍。</p>\n<ul>\n<li><a href=\"https://content.akamai.com/pg6293-high-performance-images-ebook.html\">High Performance Images</a></li>\n<li><a href=\"http://designingforperformance.com/\">Designing for Performance</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112321\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112321votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112321\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106\">iScream</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/91B5C8EB0B449C2B9F52CCED48C6B4CD/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个大的学生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/fengzhuang19940106\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/fengzhuang19940106/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 16</a> · <a title=\"QQ：295039571\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/b0c88078f0ce26552ba79f72b93aa170e681bc91.jpg"}
{"url_object_id": "233263be1f318d541c7ac561d840ec1d", "title": "每个程序员都该知道的五大定律", "url": "http://blog.jobbole.com/112474/", "create_date": "2017/09/15", "front_image_url": ["http://blog.ippon.tech/content/images/2017/08/Murphys-law.jpg"], "praise_nums": "3", "comment_nums": "  评论", "fav_nums": "8", "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://blog.ippon.tech/5-laws-every-developer-should-know/\">Raphael Brugier</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>定律-或称法则，可以指导我们并让我们在同伴的错误中学习。这篇文章中，我将介绍我每次设计或实现软件时出现在我脑海的五大定律。其中有些和开发有关，有些和系统组织有关。它们可以帮助你成为合格的软件工程师。</p>\n<h2>墨菲定律</h2>\n<blockquote><p>“凡是可能出错，就一定出错。”</p></blockquote>\n<p><a href=\"https://en.wikipedia.org/wiki/Murphy%27s_law\">这条定律</a>来源于 Edward Murphy —— 一名航天工程师在 50 年代初对火箭测试失败的回应。这条定律给我们的启示是永远在系统关键地方使用防御性设计，因为系统某些地方总会出错！</p>\n<p>这条定律很容易引入软件工程领域。当你将软件暴露给终端用户，他们会创造性地输入一些出人意料的内容，使系统宕机。所以你需要让你的软件足够健壮，能够检测并警告非预期行为。</p>\n<p>当你在机器上运行软件时，任何地方都有可能发生问题 —— 从硬盘上的系统到数据中心的电力供应。所以你必须确保你设计的架构在每个层级都可以应对故障。</p>\n<p>我曾经有机会领略过几次墨菲定律。 举个例子，我曾经在一个批处理框架中使用字符串“null”来表示空值，我并不认为这有问题，直到有个名字叫“Null”的用户提交了一个交易订单，我们的报表流程中断了几个小时…… 还有一次，在另一个项目中。当所有东西都准备好部署到生产环境了，突然 Azure 基础设施故障导致我们运行自动化脚本的服务器宕机了。</p>\n<p>现实世界中的经验教训提醒着我生活的艰难 —— “凡事可能出错，就一定出错”。 所以，心中牢记墨菲定律，设计健壮的软件。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/Murphys-law.jpg\" alt=\"\"></p>\n<h2>Knuth定律</h2>\n<blockquote><p>“在（至少大部分）编程中，过早优化是万恶之源。”</p></blockquote>\n<p><a href=\"https://en.wikiquote.org/wiki/Donald_Knuth#Quotes\">这条定律</a>也是 Donald Knuth 的经典语录之一，它告诫我们不要过早优化应用程序中的代码，直到必须优化时再优化。</p>\n<p>的确，简单易读的源码可以满足 99% 的性能需要，并能提高应用的可维护性。最开始使用简单的解决方案也让后期性能出现问题时更容易迭代和改进。</p>\n<p>垃圾自动回收的编程语言中，字符串的连接常常是过早优化的例子。在 Java 或 C# 中，String 对象是不可变的，我们学会使用其他结构动态创建字符串，比如 <a href=\"https://docs.oracle.com/javase/8/docs/api/java/lang/StringBuilder.html\">StringBuilder</a>。但事实上直到你分析完个应用程序前，你并不知道 String 对象创建了多少次并对性能的产生多大影响。所以首先编写尽可能整洁的代码，之后在必须的时候再优化，往往这样做更有意义。</p>\n<p>然而，这条规则并不应该阻止你去学习编程语言的性能权衡和正确的数据结构。并且，正如所有其他性能问题，你在优化前要测量开销。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/performance-timer.jpg\" alt=\"\"></p>\n<h2>North定律</h2>\n<blockquote><p>“每一个决定都是一次权衡”</p></blockquote>\n<p>好吧，我承认这是取自 Dan North 的演讲 <a href=\"https://www.youtube.com/watch?v=EauykEv_2iA\">Decisions,Decisions</a>，它目前还不是公认的定律。 但这条语录影响了我做的每个决定，所以我把它放在这。</p>\n<p>开发者日复一日的生活中，我们每天都做无数个大大小小的决定。从命名变量到自动化（手动）任务，再到定义平台架构。</p>\n<p>这条语录强调无论你做的选择是什么，你总会放弃一个或多个选项</p>\n<p>但这不是最重要的。 最重要的是理智地做出决定，了解其他选项，清楚你为什么不选择它们。你要始终根据当前你掌握的信息来权衡并做出决定。</p>\n<p>但是如果后来你了解到新的信息，并发现之前的决定是错误的，这也没关系。关键是记清楚你为什么做出那个决定，重新评估新的选项之后再做出新的理智的决定。</p>\n<p>重复一遍</p>\n<blockquote><p>“每一个决定都是一次权衡”</p></blockquote>\n<p>所以，做出选择并对所有选项心知肚明。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/balance.png\" alt=\"\"></p>\n<h2>Conway定律</h2>\n<blockquote><p>“系统设计的架构受限于生产设计，反映出公司组织的沟通架构”</p></blockquote>\n<p>在 60 年代，一位名叫 Melvin Conway 的工程师注意到公司组织结构影响到他们开发的系统的设计。他用一篇论文描述了这个观点，并命名为“<a href=\"https://en.wikipedia.org/wiki/Conway%27s_law\">Conway定律</a>”。</p>\n<p>这条定律很适用于软件开发领域，甚至体现到代码层面上。交付软件组件的各个团队组织结构直接影响到组件的设计。</p>\n<p>举个例子，一个集中式的开发者团队会开发出各组件耦合的整体应用。另一方面，分布式的团队会开发出单独的（微）服务，每一部分关注点分离清晰。</p>\n<p>这些设计没有好坏之分，但它们都是受到团队沟通方式的影响。在全球有大量独立开发者的开源项目，通常是模块化和可重用库，这就是很有说服力的例子。</p>\n<p>如今，将大的集成应用解耦成微服务已成趋势。这很棒，因为这可以加速交付使用项目。但你也应该牢记 Conway定律，在公司组织构建中投入与技术开发同样多的工作。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/PreferFunctionalStaffOrganization.png\" alt=\"\"></p>\n<h2>琐碎定律（帕金森琐碎定律）</h2>\n<blockquote><p>“组织成员投入大量精力到琐碎的事情上。”</p></blockquote>\n<p><a href=\"https://en.wikipedia.org/wiki/Law_of_triviality\">这条定律</a>论点是在会议中花费的时间与事情的价值成反比。的确是这样，人们更愿意把注意力和观点放在他们熟悉的事物上，而不是复杂的问题上。</p>\n<p>帕金森给出一个例子，一场会议中，成员们讨论两件事：为公司建核反应堆和为员工建车棚。建反应堆是一件巨大而复杂的任务，没有人能完全掌控全局。他们完全信赖流程和系统专家，并很快接受了项目。</p>\n<p>另一边，建车棚是一般人都可以做的，每个人都可以对颜色有意见。事实上，每个会议成员都会表达自己的意见，使得建车棚的决议所花费的时间远远超过建反应堆的。</p>\n<p>这条定律在软件行业十分出名，这个故事随后也被称为<a href=\"https://en.wiktionary.org/wiki/bikeshedding\">车棚效应</a></p>\n<p>举个例子，开发者会花费更多时间到讨论正确缩进或函数命名，而不是讨论类的职责或应用架构。这是因为每个人都能认知几个字符的变动，但项目架构的变动则需要巨大的<a href=\"https://en.wikipedia.org/wiki/Cognitive_load\">认知负载</a></p>\n<p>你能注意到的车棚效应的另一个例子是 Scrum 演示。不要误会我，我喜欢演示，我认为这是一个很好的机会来面对用户并获得对应用程序的反馈。但通常 Scrum 演示过程中的讨论会转向琐碎问题，而不是审视全局。这些讨论也很重要，但你应该注意权衡更重要更复杂的问题。</p>\n<p>一旦你了解这种规律，你将在会议和交流中发觉这种行为。 我并不是让你在每次讨论中避免“小”问题，提高你的意识可以帮助你关注真正的问题，并为这些会议做好准备。</p>\n<p><img src=\"http://blog.ippon.tech/content/images/2017/08/pink-bikeshed.jpeg\" alt=\"\"></p>\n<h2>结论</h2>\n<p>这五条定律只是我们行业中总结出的教训中一些例子。随着软件开发经验的增长，我们将会学会更多。 尽管其中某些定律现在看起来是常识，我始终坚信了解这些原则可以帮助你识别这些模式并做出反应。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112474\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112474votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112474\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 23</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/194f7f0606cdb082fda231298934a209f24699c4.jpg"}
